var Buddies=Backbone.Model.extend({urlRoot:"/api/v1/buddies",url:function(){return this.urlRoot}}),PendingBuddies=Backbone.Model.extend({urlRoot:"/api/v1/buddies/pendingRequests",url:function(){return this.urlRoot}}),FindBuddies=Backbone.Model.extend({urlRoot:"/api/v1/buddies/find",url:function(){return this.urlRoot}}),Invites=Backbone.Model.extend({urlRoot:"/api/v1/invites",url:function(){return this.urlRoot}}),AllBuddiesController=function(){var e=new Buddies;console.log("All buddies controller!"),e.fetch().done(function(t){ReactDOM.render(React.createElement(AuthBuddies,{buddies:e.toJSON().buddies}),document.getElementById(window.APP.mounts.buddiesMount))})},FindBuddiesController=function(){ReactDOM.render(React.createElement(FindBuddiesR,null),document.getElementById(window.APP.mounts.buddiesMount))},InviteController=function(){ReactDOM.render(React.createElement(InviteBuddiesR,null),document.getElementById(window.APP.mounts.buddiesMount))},PendingInvitesController=function(){"use strict";ReactDOM.render(React.createElement(PendingInvitesR,{upcoming:[],pendingBuddyRequests:[]}),document.getElementById(window.APP.mounts.buddiesMount));var e=new Invites,t=new PendingBuddies;t.fetch().done(function(e){events.publish("buddies/pendingRequests",e.buddies)}),e.fetch().done(function(e){events.publish("buddies/upcomingInvites",e.invites)})},AuthNav=React.createClass({updateController:function(e){console.log(this),window.location.hash=e},render:function(){return React.createElement("div",null,React.createElement("button",{className:"btn btn-default",onClick:this.updateController.bind(this,"invites")},"Pending"),React.createElement("button",{className:"btn btn-default",onClick:this.updateController.bind(this,"buddies")},"My Buddies"),React.createElement("button",{className:"btn btn-default",onClick:this.updateController.bind(this,"invite")},"Invite"),React.createElement("button",{className:"btn btn-default",onClick:this.updateController.bind(this,"find")},"Find a Buddy"))}}),AuthBuddies=React.createClass({getInitialState:function(){return{buddies:this.props.buddies,buddiesPresent:this.props.buddies.length>0,inviteTemplate:"undefined"!=typeof this.props.requestType&&"find"===this.props.requestType}},componentDidMount:function(){var e=this;events.subscribe("findBuddies/result",function(t){e.setState({buddies:t.buddies,buddiesPresent:t.buddies.length>0,inviteTemplate:"find"===t.requestType})})},handleBuddiesChange:function(){return{buddies:this.props.buddies}},render:function(){var e=this;return React.createElement("div",{className:"buddies-main"},e.state.inviteTemplate?React.createElement("h2",null):React.createElement("h2",null,"Your Buddies"),this.state.buddiesPresent?this.state.buddies.map(function(t,n){return React.createElement("div",{className:"BuddiesWrapper"},e.state.inviteTemplate?React.createElement(BuddyInvite,{key:n,buddy:t}):React.createElement(BuddyRow,{key:n,buddy:t}))}):React.createElement("div",{className:"no-buddies"}))}}),FindBuddiesR=React.createClass({getInitialState:function(){return{buddies:{}}},findBuddies:function(){var e=this;$.get("/api/v1/buddies/find/"+this.state.buddyDetail,function(t){e.setState({buddies:t.buddies}),events.publish("findBuddies/result",{buddies:e.state.buddies,requestType:"find"})})},handleTextChange:function(e){this.setState({buddyDetail:e.target.value})},render:function(){var e=this;return React.createElement("div",null,React.createElement("h2",null,"Connect with a Buddy"),React.createElement("section",{className:"form-group"},React.createElement("input",{className:"form-control",type:"text",placeholder:"Type here",onChange:this.handleTextChange}),React.createElement("button",{className:"form-control",onClick:this.findBuddies.bind(this)},"Find"),React.createElement(AuthBuddies,{buddies:e.state.buddies})))}}),BuddyRow=React.createClass({render:function(){return React.createElement("section",{className:"buddy"},this.props.buddy.email," | ",this.props.buddy.status," ",React.createElement(InviteBuddyMicro,{buddy:this.props.buddy}))}}),BuddyInvite=React.createClass({render:function(){return React.createElement("section",{className:"buddy"},this.props.buddy.email," ",React.createElement(InviteBuddyMicro,{buddy:this.props.buddy,msg:"Connect"}))}}),InviteBuddiesR=React.createClass({getInitialState:function(){return{buddyDetail:""}},handleTextChange:function(e){this.setState({buddyDetail:e.target.value})},sendInvite:function(){var e=this;$.ajax({url:"/api/v1/buddies/invite",data:{buddyEmail:e.state.buddyDetail}}).done(function(e){events.publish("admin/alert",{className:"text-success",msg:JSON.stringify(e)})}).fail(function(e){events.publish("admin/alert",{className:"text-danger",msg:JSON.stringify(e)})})},render:function(){return React.createElement("inviteForm",{className:"form-group"},React.createElement("h2",null,"Invite a buddy to join"),React.createElement("input",{className:"form-control",type:"text",placeholder:"Email address",onChange:this.handleTextChange}),React.createElement("button",{className:"form-control",onClick:this.sendInvite.bind(this)},"Send invite"))}}),PendingInvitesR=React.createClass({getInitialState:function(){return{invites:this.props.upcoming,pendingBuddyRequests:this.props.pendingBuddyRequests}},componentDidMount:function(){var e=this;events.subscribe("buddies/pendingRequests",function(t){e.setState({pendingBuddyRequests:t})}),events.subscribe("buddies/upcomingInvites",function(t){e.setState({invites:t})})},render:function(){return console.log(this),React.createElement("div",null,React.createElement("h2",null,"Upcoming Sessions"),React.createElement("h2",null,"Pending Invites"),this.state.pendingBuddyRequests.map(function(e,t){return React.createElement(ApproveBuddyMicro,{key:t,buddy:e})}))}}),ApproveBuddyMicro=React.createClass({getInitialState:function(){return{buddy:this.props.buddy}},handleInvite:function(e){"use strict";var t=this.props.buddy;$.ajax({url:"/api/v1/invites/respond",method:"POST",data:{buddyId:t._id,approved:e,_csrf:APP._csrf}}).success(function(e){events.publish("admin/alert",{className:"text-success",msg:"Buddy request was approved"})}).fail(function(e){events.publish("admin/alert",{className:"text-danger",msg:"There was a problem approving buddy invite. Please try again."})})},render:function(){var e=this.state.buddy;return React.createElement("section",null,e.profile.name,React.createElement("button",{onClick:this.handleInvite.bind(this,!0)},"Approve"),React.createElement("button",{onClick:this.handleInvite.bind(this,!1)},"Reject"))}}),InviteBuddyMicro=React.createClass({getInitialState:function(){return{msg:"undefined"==typeof this.props.msg?"Send Request":this.props.msg}},handleInvite:function(){"use strict";var e=this.props.buddy;$.ajax({url:"/api/v1/invites/",method:"POST",data:{buddyId:e._id,_csrf:APP._csrf}}).success(function(e){events.publish("admin/alert",{className:"text-success",msg:"Buddy request was sent"})}).fail(function(e){events.publish("admin/alert",{className:"text-danger",msg:"There was a problem sending request. Please try again."})})},render:function(){return React.createElement("button",{onClick:this.handleInvite.bind(this)},this.state.msg)}}),MessageMicro=React.createClass({getInitialState:function(){return{msg:"",messagePresent:!1,defaultClass:"text-danger",className:"text-danger"}},clearMessage:function(){var e=this;setTimeout(function(){e.setState({msg:"",messagePresent:!1,className:e.state.defaultClass})},3e4)},componentDidMount:function(){var e=this;events.subscribe("admin/alert",function(t){console.log(t.className),e.setState({msg:t.msg,messagePresent:!0,className:"undefined"!=typeof t.className?t.className:e.state.defaultClass}),e.clearMessage()})},render:function(){return React.createElement("messageWrapper",null,this.state.messagePresent?React.createElement("message",{className:this.state.className},this.state.msg):React.createElement("message",null))}}),AppRouter=Backbone.Router.extend({routes:{invite:"invite",find:"find",buddies:"buddies","*actions":"defaultRoute"}}),app_router=new AppRouter;app_router.on("route:find",function(e){FindBuddiesController()}),app_router.on("route:invite",function(e){InviteController()}),app_router.on("route:buddies",function(e){AllBuddiesController()}),app_router.on("route:defaultRoute",function(e){PendingInvitesController()}),Backbone.history.start(),ReactDOM.render(React.createElement(AuthNav,null),document.getElementById(window.APP.mounts.adminMount)),ReactDOM.render(React.createElement(MessageMicro),document.getElementById("auth-message"));