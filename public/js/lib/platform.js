!function(){var requirejs,require,define;if(function(t){function e(t,e){return v.call(t,e)}function n(t,e){var n,r,i,o,s,a,u,l,c,f,h=e&&e.split("/"),p=m.map,d=p&&p["*"]||{};if(t&&"."===t.charAt(0))if(e){for(h=h.slice(0,h.length-1),t=h.concat(t.split("/")),l=0;l<t.length;l+=1)if(f=t[l],"."===f)t.splice(l,1),l-=1;else if(".."===f){if(1===l&&(".."===t[2]||".."===t[0]))break;l>0&&(t.splice(l-1,2),l-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((h||d)&&p){for(n=t.split("/"),l=n.length;l>0;l-=1){if(r=n.slice(0,l).join("/"),h)for(c=h.length;c>0;c-=1)if(i=p[h.slice(0,c).join("/")],i&&(i=i[r])){o=i,s=l;break}if(o)break;!a&&d&&d[r]&&(a=d[r],u=l)}!o&&a&&(o=a,s=u),o&&(n.splice(0,s,o),t=n.join("/"))}return t}function r(e,n){return function(){return c.apply(t,y.call(arguments,0).concat([e,n]))}}function i(t){return function(e){return n(e,t)}}function o(t){return function(e){p[t]=e}}function s(n){if(e(d,n)){var r=d[n];delete d[n],g[n]=!0,l.apply(t,r)}if(!e(p,n)&&!e(g,n))throw new Error("No "+n);return p[n]}function a(t){var e,n=t?t.indexOf("!"):-1;return n>-1&&(e=t.substring(0,n),t=t.substring(n+1,t.length)),[e,t]}function u(t){return function(){return m&&m.config&&m.config[t]||{}}}var l,c,f,h,p={},d={},m={},g={},v=Object.prototype.hasOwnProperty,y=[].slice;f=function(t,e){var r,o=a(t),u=o[0];return t=o[1],u&&(u=n(u,e),r=s(u)),u?t=r&&r.normalize?r.normalize(t,i(e)):n(t,e):(t=n(t,e),o=a(t),u=o[0],t=o[1],u&&(r=s(u))),{f:u?u+"!"+t:t,n:t,pr:u,p:r}},h={require:function(t){return r(t)},exports:function(t){var e=p[t];return"undefined"!=typeof e?e:p[t]={}},module:function(t){return{id:t,uri:"",exports:p[t],config:u(t)}}},l=function(n,i,a,u){var l,c,m,v,y,_,b=[];if(u=u||n,"function"==typeof a){for(i=!i.length&&a.length?["require","exports","module"]:i,y=0;y<i.length;y+=1)if(v=f(i[y],u),c=v.f,"require"===c)b[y]=h.require(n);else if("exports"===c)b[y]=h.exports(n),_=!0;else if("module"===c)l=b[y]=h.module(n);else if(e(p,c)||e(d,c)||e(g,c))b[y]=s(c);else{if(!v.p)throw new Error(n+" missing "+c);v.p.load(v.n,r(u,!0),o(c),{}),b[y]=p[c]}m=a.apply(p[n],b),n&&(l&&l.exports!==t&&l.exports!==p[n]?p[n]=l.exports:m===t&&_||(p[n]=m))}else n&&(p[n]=a)},requirejs=require=c=function(e,n,r,i,o){return"string"==typeof e?h[e]?h[e](n):s(f(e,n).f):(e.splice||(m=e,n.splice?(e=n,n=r,r=null):e=t),n=n||function(){},"function"==typeof r&&(r=i,i=o),i?l(t,e,n,r):setTimeout(function(){l(t,e,n,r)},4),c)},c.config=function(t){return m=t,m.deps&&c(m.deps,m.callback),c},define=function(t,n,r){n.splice||(r=n,n=[]),e(p,t)||e(d,t)||(d[t]=[t,n,r])},define.amd={jQuery:!0}}(),define("../node_modules/almond/almond",function(){}),function(t){function e(t,e,n){for(var r=(n||0)-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}function n(t,n){var r=typeof n;if(t=t.cache,"boolean"==r||null==n)return t[n];"number"!=r&&"string"!=r&&(r="object");var i="number"==r?n:w+n;return t=t[r]||(t[r]={}),"object"==r?t[i]&&e(t[i],n)>-1?0:-1:t[i]?0:-1}function r(t){var e=this.cache,n=typeof t;if("boolean"==n||null==t)e[t]=!0;else{"number"!=n&&"string"!=n&&(n="object");var r="number"==n?t:w+t,i=e[n]||(e[n]={});"object"==n?(i[r]||(i[r]=[])).push(t)==this.array.length&&(e[n]=!1):i[r]=!0}}function i(t){return t.charCodeAt(0)}function o(t,e){var n=t.index,r=e.index;if(t=t.criteria,e=e.criteria,t!==e){if(t>e||"undefined"==typeof t)return 1;if(e>t||"undefined"==typeof e)return-1}return r>n?-1:1}function s(t){var e=-1,n=t.length,i=l();i["false"]=i["null"]=i["true"]=i.undefined=!1;var o=l();for(o.array=t,o.cache=i,o.push=r;++e<n;)o.push(t[e]);return i.object===!1?(p(o),null):o}function a(t){return"\\"+Z[t]}function u(){return v.pop()||[]}function l(){return y.pop()||{args:"",array:null,bottom:"",cache:null,criteria:null,"false":!1,firstArg:"",index:0,init:"",leading:!1,loop:"",maxWait:0,"null":!1,number:null,object:null,push:null,shadowedProps:null,string:null,top:"",trailing:!1,"true":!1,undefined:!1,useHas:!1,useKeys:!1,value:null}}function c(t){return"function"!=typeof t.toString&&"string"==typeof(t+"")}function f(){}function h(t){t.length=0,v.length<x&&v.push(t)}function p(t){var e=t.cache;e&&p(e),t.array=t.cache=t.criteria=t.object=t.number=t.string=t.value=null,y.length<x&&y.push(t)}function d(t,e,n){e||(e=0),"undefined"==typeof n&&(n=t?t.length:0);for(var r=-1,i=n-e||0,o=Array(0>i?0:i);++r<i;)o[r]=t[e+r];return o}function m(r){function v(t){return t&&"object"==typeof t&&!Hr(t)&&gr.call(t,"__wrapped__")?t:new y(t)}function y(t){this.__wrapped__=t}function x(t,e,n,r){function i(){var r=arguments,l=s?this:e;if(o||(t=e[a]),n.length&&(r=r.length?(r=Tr.call(r),u?r.concat(n):n.concat(r)):n),this instanceof i){l=te(t.prototype);var c=t.apply(l,r);return Ee(c)?c:l}return t.apply(l,r)}var o=we(t),s=!n,a=e;if(s){var u=r;n=e}else if(!o){if(!r)throw new rr;e=t}return i}function Z(){var t=l();t.shadowedProps=F,t.array=t.bottom=t.loop=t.top="",t.init="iterable",t.useHas=!0,t.useKeys=!!$r;for(var e,n=0;e=arguments[n];n++)for(var r in e)t[r]=e[r];var i=t.args;t.firstArg=/^[^,]+/.exec(i)[0];var o=Jn("errorClass, errorProto, hasOwnProperty, isArguments, isArray, isString, keys, lodash, objectProto, objectTypes, nonEnumProps, stringClass, stringProto, toString","return function("+i+") {\n"+qr(t)+"\n}");return p(t),o(V,or,gr,ue,Hr,Se,$r,v,sr,Q,Pr,X,ar,wr)}function te(t){return Ee(t)?kr(t):{}}function ne(t){return Gr[t]}function ie(){var t=(t=v.indexOf)===sn?e:t;return t}function oe(t){return function(e,n,r,i){return"boolean"!=typeof n&&null!=n&&(i=r,r=i&&i[n]===e?g:n,n=!1),null!=r&&(r=v.createCallback(r,i)),t(e,n,r,i)}}function se(t){var e,n;return!t||wr.call(t)!=Y||(e=t.constructor,we(e)&&!(e instanceof e))||!Mr.argsClass&&ue(t)||!Mr.nodeClass&&c(t)?!1:Mr.ownLast?(Xr(t,function(t,e,r){return n=gr.call(r,e),!1}),n!==!1):(Xr(t,function(t,e){n=e}),n===g||gr.call(t,n))}function ae(t){return Kr[t]}function ue(t){return wr.call(t)==B}function le(t,e,n,r,i,o){var s=t;if("boolean"!=typeof e&&null!=e&&(r=n,n=e,e=!1),"function"==typeof n){if(n="undefined"==typeof r?n:v.createCallback(n,r,1),s=n(s),"undefined"!=typeof s)return s;s=t}var a=Ee(s);if(a){var l=wr.call(s);if(!J[l]||!Mr.nodeClass&&c(s))return s;var f=Hr(s)}if(!a||!e)return a?f?d(s):Yr({},s):s;var p=Dr[l];switch(l){case z:case $:return new p(+s);case K:case X:return new p(s);case W:return p(s.source,L.exec(s))}var m=!i;i||(i=u()),o||(o=u());for(var y=i.length;y--;)if(i[y]==t)return o[y];return s=f?p(s.length):{},f&&(gr.call(t,"index")&&(s.index=t.index),gr.call(t,"input")&&(s.input=t.input)),i.push(t),o.push(s),(f?Vr:Jr)(t,function(t,r){s[r]=le(t,e,n,g,i,o)}),m&&(h(i),h(o)),s}function ce(t,e,n){return le(t,!0,e,n)}function fe(t,e,n){var r;return e=v.createCallback(e,n),Jr(t,function(t,n,i){return e(t,n,i)?(r=n,!1):void 0}),r}function he(t){var e=[];return Xr(t,function(t,n){we(t)&&e.push(n)}),e.sort()}function pe(t,e){return t?gr.call(t,e):!1}function de(t){for(var e=-1,n=$r(t),r=n.length,i={};++e<r;){var o=n[e];i[t[o]]=o}return i}function me(t){return t===!0||t===!1||wr.call(t)==z}function ge(t){return t?"object"==typeof t&&wr.call(t)==$:!1}function ve(t){return t?1===t.nodeType:!1}function ye(t){var e=!0;if(!t)return e;var n=wr.call(t),r=t.length;return n==H||n==X||(Mr.argsClass?n==B:ue(t))||n==Y&&"number"==typeof r&&we(t.splice)?!r:(Jr(t,function(){return e=!1}),e)}function _e(t,e,n,r,i,o){var s=n===b;if("function"==typeof n&&!s){n=v.createCallback(n,r,2);var a=n(t,e);if("undefined"!=typeof a)return!!a}if(t===e)return 0!==t||1/t==1/e;var l=typeof t,f=typeof e;if(t===t&&(!t||"function"!=l&&"object"!=l)&&(!e||"function"!=f&&"object"!=f))return!1;if(null==t||null==e)return t===e;var p=wr.call(t),d=wr.call(e);if(p==B&&(p=Y),d==B&&(d=Y),p!=d)return!1;switch(p){case z:case $:return+t==+e;case K:return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case W:case X:return t==nr(e)}var m=p==H;if(!m){if(gr.call(t,"__wrapped__ ")||gr.call(e,"__wrapped__"))return _e(t.__wrapped__||t,e.__wrapped__||e,n,r,i,o);if(p!=Y||!Mr.nodeClass&&(c(t)||c(e)))return!1;var g=!Mr.argsObject&&ue(t)?tr:t.constructor,y=!Mr.argsObject&&ue(e)?tr:e.constructor;if(g!=y&&!(we(g)&&g instanceof g&&we(y)&&y instanceof y))return!1}var _=!i;i||(i=u()),o||(o=u());for(var w=i.length;w--;)if(i[w]==t)return o[w]==e;var E=0;if(a=!0,i.push(t),o.push(e),m){if(w=t.length,E=e.length,a=E==t.length,!a&&!s)return a;for(;E--;){var k=w,x=e[E];if(s)for(;k--&&!(a=_e(t[k],x,n,r,i,o)););else if(!(a=_e(t[E],x,n,r,i,o)))break}return a}return Xr(e,function(e,s,u){return gr.call(u,s)?(E++,a=gr.call(t,s)&&_e(t[s],e,n,r,i,o)):void 0}),a&&!s&&Xr(t,function(t,e,n){return gr.call(n,e)?a=--E>-1:void 0}),_&&(h(i),h(o)),a}function be(t){return Ar(t)&&!Or(parseFloat(t))}function we(t){return"function"==typeof t}function Ee(t){return!(!t||!Q[typeof t])}function ke(t){return Ae(t)&&t!=+t}function xe(t){return null===t}function Ae(t){return"number"==typeof t||wr.call(t)==K}function Oe(t){return!(!t||!Q[typeof t])&&wr.call(t)==W}function Se(t){return"string"==typeof t||wr.call(t)==X}function Ie(t){return"undefined"==typeof t}function je(t,e,n){var r=arguments,i=0,o=2;if(!Ee(t))return t;if(n===b)var s=r[3],a=r[4],l=r[5];else{var c=!0;a=u(),l=u(),"number"!=typeof n&&(o=r.length),o>3&&"function"==typeof r[o-2]?s=v.createCallback(r[--o-1],r[o--],2):o>2&&"function"==typeof r[o-1]&&(s=r[--o])}for(;++i<o;)(Hr(r[i])?Be:Jr)(r[i],function(e,n){var r,i,o=e,u=t[n];if(e&&((i=Hr(e))||Qr(e))){for(var c=a.length;c--;)if(r=a[c]==e){u=l[c];break}if(!r){var f;s&&(o=s(u,e),(f="undefined"!=typeof o)&&(u=o)),f||(u=i?Hr(u)?u:[]:Qr(u)?u:{}),a.push(e),l.push(u),f||(u=je(u,e,b,s,a,l))}}else s&&(o=s(u,e),"undefined"==typeof o&&(o=e)),"undefined"!=typeof o&&(u=o);t[n]=u});return c&&(h(a),h(l)),t}function Le(t,e,n){var r=ie(),i="function"==typeof e,o={};if(i)e=v.createCallback(e,n);else var s=hr.apply(ir,Tr.call(arguments,1));return Xr(t,function(t,n,a){(i?!e(t,n,a):r(s,n)<0)&&(o[n]=t)}),o}function Re(t){for(var e=-1,n=$r(t),r=n.length,i=Kn(r);++e<r;){var o=n[e];i[e]=[o,t[o]]}return i}function Te(t,e,n){var r={};if("function"!=typeof e)for(var i=-1,o=hr.apply(ir,Tr.call(arguments,1)),s=Ee(t)?o.length:0;++i<s;){var a=o[i];a in t&&(r[a]=t[a])}else e=v.createCallback(e,n),Xr(t,function(t,n,i){e(t,n,i)&&(r[n]=t)});return r}function Ce(t,e,n,r){var i=Hr(t);if(e=v.createCallback(e,r,4),null==n)if(i)n=[];else{var o=t&&t.constructor,s=o&&o.prototype;n=te(s)}return(i?Vr:Jr)(t,function(t,r,i){return e(n,t,r,i)}),n}function Ne(t){for(var e=-1,n=$r(t),r=n.length,i=Kn(r);++e<r;)i[e]=t[n[e]];return i}function De(t){var e=-1,n=hr.apply(ir,Tr.call(arguments,1)),r=n.length,i=Kn(r);for(Mr.unindexedChars&&Se(t)&&(t=t.split(""));++e<r;)i[e]=t[n[e]];return i}function Pe(t,e,n){var r=-1,i=ie(),o=t?t.length:0,s=!1;return n=(0>n?Ir(0,o+n):n)||0,o&&"number"==typeof o?s=(Se(t)?t.indexOf(e,n):i(t,e,n))>-1:Vr(t,function(t){return++r>=n?!(s=t===e):void 0}),s}function Me(t,e,n){var r={};return e=v.createCallback(e,n),Be(t,function(t,n,i){n=nr(e(t,n,i)),gr.call(r,n)?r[n]++:r[n]=1}),r}function qe(t,e,n){var r=!0;if(e=v.createCallback(e,n),Hr(t))for(var i=-1,o=t.length;++i<o&&(r=!!e(t[i],i,t)););else Vr(t,function(t,n,i){return r=!!e(t,n,i)});return r}function Fe(t,e,n){var r=[];if(e=v.createCallback(e,n),Hr(t))for(var i=-1,o=t.length;++i<o;){var s=t[i];e(s,i,t)&&r.push(s)}else Vr(t,function(t,n,i){e(t,n,i)&&r.push(t)});return r}function Ue(t,e,n){if(e=v.createCallback(e,n),!Hr(t)){var r;return Vr(t,function(t,n,i){return e(t,n,i)?(r=t,!1):void 0}),r}for(var i=-1,o=t.length;++i<o;){var s=t[i];if(e(s,i,t))return s}}function Be(t,e,n){if(e&&"undefined"==typeof n&&Hr(t))for(var r=-1,i=t.length;++r<i&&e(t[r],r,t)!==!1;);else Vr(t,e,n);return t}function He(t,e,n){var r={};return e=v.createCallback(e,n),Be(t,function(t,n,i){n=nr(e(t,n,i)),(gr.call(r,n)?r[n]:r[n]=[]).push(t)}),r}function ze(t,e){var n=Tr.call(arguments,2),r=-1,i="function"==typeof e,o=t?t.length:0,s=Kn("number"==typeof o?o:0);return Be(t,function(t){s[++r]=(i?e:t[e]).apply(t,n)}),s}function $e(t,e,n){var r=-1,i=t?t.length:0,o=Kn("number"==typeof i?i:0);if(e=v.createCallback(e,n),Hr(t))for(;++r<i;)o[r]=e(t[r],r,t);else Vr(t,function(t,n,i){o[++r]=e(t,n,i)});return o}function Ve(t,e,n){var r=-1/0,o=r;if(!e&&Hr(t))for(var s=-1,a=t.length;++s<a;){var u=t[s];u>o&&(o=u)}else e=!e&&Se(t)?i:v.createCallback(e,n),Vr(t,function(t,n,i){var s=e(t,n,i);s>r&&(r=s,o=t)});return o}function Ge(t,e,n){var r=1/0,o=r;if(!e&&Hr(t))for(var s=-1,a=t.length;++s<a;){var u=t[s];o>u&&(o=u)}else e=!e&&Se(t)?i:v.createCallback(e,n),Vr(t,function(t,n,i){var s=e(t,n,i);r>s&&(r=s,o=t)});return o}function Ke(t,e,n,r){var i=arguments.length<3;if(e=v.createCallback(e,r,4),Hr(t)){var o=-1,s=t.length;for(i&&(n=t[++o]);++o<s;)n=e(n,t[o],o,t)}else Vr(t,function(t,r,o){n=i?(i=!1,t):e(n,t,r,o)});return n}function Ye(t,e,n,r){var i=t,o=t?t.length:0,s=arguments.length<3;if("number"!=typeof o){var a=$r(t);o=a.length}else Mr.unindexedChars&&Se(t)&&(i=t.split(""));return e=v.createCallback(e,r,4),Be(t,function(t,r,u){r=a?a[--o]:--o,n=s?(s=!1,i[r]):e(n,i[r],r,u)}),n}function We(t,e,n){return e=v.createCallback(e,n),Fe(t,function(t,n,r){return!e(t,n,r)})}function Xe(t){var e=-1,n=t?t.length:0,r=Kn("number"==typeof n?n:0);return Be(t,function(t){var n=pr(Rr()*(++e+1));r[e]=r[n],r[n]=t}),r}function Je(t){var e=t?t.length:0;return"number"==typeof e?e:$r(t).length}function Qe(t,e,n){var r;if(e=v.createCallback(e,n),Hr(t))for(var i=-1,o=t.length;++i<o&&!(r=e(t[i],i,t)););else Vr(t,function(t,n,i){return!(r=e(t,n,i))});return!!r}function Ze(t,e,n){var r=-1,i=t?t.length:0,s=Kn("number"==typeof i?i:0);for(e=v.createCallback(e,n),Be(t,function(t,n,i){var o=s[++r]=l();o.criteria=e(t,n,i),o.index=r,o.value=t}),i=s.length,s.sort(o);i--;){var a=s[i];s[i]=a.value,p(a)}return s}function tn(t){return t&&"number"==typeof t.length?Mr.unindexedChars&&Se(t)?t.split(""):d(t):Ne(t)}function en(t){for(var e=-1,n=t?t.length:0,r=[];++e<n;){var i=t[e];i&&r.push(i)}return r}function nn(t){var r=-1,i=ie(),o=t?t.length:0,a=hr.apply(ir,Tr.call(arguments,1)),u=[],l=o>=E&&i===e;if(l){var c=s(a);c?(i=n,a=c):l=!1}for(;++r<o;){var f=t[r];i(a,f)<0&&u.push(f)}return l&&p(a),u}function rn(t,e,n){var r=-1,i=t?t.length:0;for(e=v.createCallback(e,n);++r<i;)if(e(t[r],r,t))return r;return-1}function on(t,e,n){if(t){var r=0,i=t.length;if("number"!=typeof e&&null!=e){var o=-1;for(e=v.createCallback(e,n);++o<i&&e(t[o],o,t);)r++}else if(r=e,null==r||n)return t[0];return d(t,0,jr(Ir(0,r),i))}}function sn(t,n,r){if("number"==typeof r){var i=t?t.length:0;r=0>r?Ir(0,i+r):r||0}else if(r){var o=pn(t,n);return t[o]===n?o:-1}return t?e(t,n,r):-1}function an(t,e,n){if(!t)return[];var r=0,i=t.length;if("number"!=typeof e&&null!=e){var o=i;for(e=v.createCallback(e,n);o--&&e(t[o],o,t);)r++}else r=null==e||n?1:e||r;return d(t,0,jr(Ir(0,i-r),i))}function un(t){for(var r=arguments,i=r.length,o=-1,a=u(),l=-1,c=ie(),f=t?t.length:0,d=[],m=u();++o<i;){var g=r[o];a[o]=c===e&&(g?g.length:0)>=E&&s(o?r[o]:m)}t:for(;++l<f;){var v=a[0];if(g=t[l],(v?n(v,g):c(m,g))<0){for(o=i,(v||m).push(g);--o;)if(v=a[o],(v?n(v,g):c(r[o],g))<0)continue t;d.push(g)}}for(;i--;)v=a[i],v&&p(v);return h(a),h(m),d}function ln(t,e,n){if(t){var r=0,i=t.length;if("number"!=typeof e&&null!=e){var o=i;for(e=v.createCallback(e,n);o--&&e(t[o],o,t);)r++}else if(r=e,null==r||n)return t[i-1];return d(t,Ir(0,i-r))}}function cn(t,e,n){var r=t?t.length:0;for("number"==typeof n&&(r=(0>n?Ir(0,r+n):jr(n,r-1))+1);r--;)if(t[r]===e)return r;return-1}function fn(t,e,n){t=+t||0,n=+n||1,null==e&&(e=t,t=0);for(var r=-1,i=Ir(0,cr((e-t)/n)),o=Kn(i);++r<i;)o[r]=t,t+=n;return o}function hn(t,e,n){if("number"!=typeof e&&null!=e){var r=0,i=-1,o=t?t.length:0;for(e=v.createCallback(e,n);++i<o&&e(t[i],i,t);)r++}else r=null==e||n?1:Ir(0,e);return d(t,r)}function pn(t,e,n,r){var i=0,o=t?t.length:i;for(n=n?v.createCallback(n,r,1):Dn,e=n(e);o>i;){var s=i+o>>>1;n(t[s])<e?i=s+1:o=s}return i}function dn(t){return Hr(t)||(arguments[0]=t?Tr.call(t):ir),ni(hr.apply(ir,arguments))}function mn(t){for(var e=-1,n=t?Ve(Zr(t,"length")):0,r=Kn(0>n?0:n);++e<n;)r[e]=Zr(t,e);return r}function gn(t){return nn(t,Tr.call(arguments,1))}function vn(t){return t?mn(arguments):[]}function yn(t,e){for(var n=-1,r=t?t.length:0,i={};++n<r;){var o=t[n];e?i[o]=e[n]:i[o[0]]=o[1]}return i}function _n(t,e){return 1>t?e():function(){return--t<1?e.apply(this,arguments):void 0}}function bn(t,e){return Mr.fastBind||Er&&arguments.length>2?Er.call.apply(Er,arguments):x(t,e,Tr.call(arguments,2))}function wn(t){for(var e=arguments.length>1?hr.apply(ir,Tr.call(arguments,1)):he(t),n=-1,r=e.length;++n<r;){var i=e[n];t[i]=bn(t[i],t)}return t}function En(t,e){return x(t,e,Tr.call(arguments,2),b)}function kn(){var t=arguments;return function(){for(var e=arguments,n=t.length;n--;)e=[t[n].apply(this,e)];return e[0]}}function xn(t,e,n){if(null==t)return Dn;var r=typeof t;if("function"!=r){if("object"!=r)return function(e){return e[t]};var i=$r(t);return function(e){for(var n=i.length,r=!1;n--&&(r=_e(e[i[n]],t[i[n]],b)););return r}}return"undefined"==typeof e||T&&!T.test(dr.call(t))?t:1===n?function(n){return t.call(e,n)}:2===n?function(n,r){return t.call(e,n,r)}:4===n?function(n,r,i,o){return t.call(e,n,r,i,o)}:function(n,r,i){return t.call(e,n,r,i)}}function An(t,e,n){function r(){fr(h),fr(p),l=0,h=p=null}function i(){var e=d&&(!m||l>1);r(),e&&(f!==!1&&(c=new Wn),a=t.apply(u,s))}function o(){r(),(d||f!==e)&&(c=new Wn,a=t.apply(u,s))}var s,a,u,l=0,c=0,f=!1,h=null,p=null,d=!0;if(e=Ir(0,e||0),n===!0){var m=!0;d=!1}else Ee(n)&&(m=n.leading,f="maxWait"in n&&Ir(e,n.maxWait||0),d="trailing"in n?n.trailing:d);return function(){if(s=arguments,u=this,l++,fr(p),f===!1)m&&2>l&&(a=t.apply(u,s));else{var n=new Wn;h||m||(c=n);var r=f-(n-c);0>=r?(fr(h),h=null,c=n,a=t.apply(u,s)):h||(h=br(o,r))}return e!==f&&(p=br(i,e)),a}}function On(t){var e=Tr.call(arguments,1);return br(function(){t.apply(g,e)},1)}function Sn(t,e){var n=Tr.call(arguments,2);return br(function(){t.apply(g,n)},e)}function In(t,e){function n(){var r=n.cache,i=w+(e?e.apply(this,arguments):arguments[0]);return gr.call(r,i)?r[i]:r[i]=t.apply(this,arguments)}return n.cache={},n}function jn(t){var e,n;return function(){return e?n:(e=!0,n=t.apply(this,arguments),t=null,n)}}function Ln(t){return x(t,Tr.call(arguments,1))}function Rn(t){return x(t,Tr.call(arguments,1),null,b)}function Tn(t,e,n){var r=!0,i=!0;n===!1?r=!1:Ee(n)&&(r="leading"in n?n.leading:r,i="trailing"in n?n.trailing:i),n=l(),n.leading=r,n.maxWait=e,n.trailing=i;var o=An(t,e,n);return p(n),o}function Cn(t,e){return function(){var n=[t];return vr.apply(n,arguments),e.apply(this,n)}}function Nn(t){return null==t?"":nr(t).replace(P,ne)}function Dn(t){return t}function Pn(t){Be(he(t),function(e){var n=v[e]=t[e];v.prototype[e]=function(){var t=this.__wrapped__,e=[t];vr.apply(e,arguments);var r=n.apply(v,e);return t&&"object"==typeof t&&t===r?this:new y(r)}})}function Mn(){return r._=ur,this}function qn(t,e){null==t&&null==e&&(e=1),t=+t||0,null==e?(e=t,t=0):e=+e||0;var n=Rr();return t%1||e%1?t+jr(n*(e-t+parseFloat("1e-"+((n+"").length-1))),e):t+pr(n*(e-t+1))}function Fn(t,e){var n=t?t[e]:g;return we(n)?t[e]():n}function Un(t,e,n){var r=v.templateSettings;t||(t=""),n=Wr({},n,r);var i,o=Wr({},n.imports,r.imports),s=$r(o),u=Ne(o),l=0,c=n.interpolate||D,f="__p += '",h=er((n.escape||D).source+"|"+c.source+"|"+(c===R?j:D).source+"|"+(n.evaluate||D).source+"|$","g");t.replace(h,function(e,n,r,o,s,u){return r||(r=o),f+=t.slice(l,u).replace(M,a),n&&(f+="' +\n__e("+n+") +\n'"),s&&(i=!0,f+="';\n"+s+";\n__p += '"),r&&(f+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),l=u+e.length,e}),f+="';\n";var p=n.variable,d=p;d||(p="obj",f="with ("+p+") {\n"+f+"\n}\n"),f=(i?f.replace(A,""):f).replace(O,"$1").replace(S,"$1;"),f="function("+p+") {\n"+(d?"":p+" || ("+p+" = {});\n")+"var __t, __p = '', __e = _.escape"+(i?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+f+"return __p\n}";var m="\n/*\n//@ sourceURL="+(n.sourceURL||"/lodash/template/source["+U++ +"]")+"\n*/";try{var y=Jn(s,"return "+f+m).apply(g,u)}catch(_){throw _.source=f,_}return e?y(e):(y.source=f,y)}function Bn(t,e,n){t=(t=+t)>-1?t:0;var r=-1,i=Kn(t);for(e=v.createCallback(e,n,1);++r<t;)i[r]=e(r);return i}function Hn(t){return null==t?"":nr(t).replace(I,ae)}function zn(t){var e=++_;return nr(null==t?"":t)+e}function $n(t,e){return e(t),t}function Vn(){return nr(this.__wrapped__)}function Gn(){return this.__wrapped__}r=r?re.defaults(t.Object(),r,re.pick(t,q)):t;var Kn=r.Array,Yn=r.Boolean,Wn=r.Date,Xn=r.Error,Jn=r.Function,Qn=r.Math,Zn=r.Number,tr=r.Object,er=r.RegExp,nr=r.String,rr=r.TypeError,ir=[],or=Xn.prototype,sr=tr.prototype,ar=nr.prototype,ur=r._,lr=er("^"+nr(sr.valueOf).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),cr=Qn.ceil,fr=r.clearTimeout,hr=ir.concat,pr=Qn.floor,dr=Jn.prototype.toString,mr=lr.test(mr=tr.getPrototypeOf)&&mr,gr=sr.hasOwnProperty,vr=ir.push,yr=sr.propertyIsEnumerable,_r=r.setImmediate,br=r.setTimeout,wr=sr.toString,Er=lr.test(Er=wr.bind)&&Er,kr=lr.test(kr=tr.create)&&kr,xr=lr.test(xr=Kn.isArray)&&xr,Ar=r.isFinite,Or=r.isNaN,Sr=lr.test(Sr=tr.keys)&&Sr,Ir=Qn.max,jr=Qn.min,Lr=r.parseInt,Rr=Qn.random,Tr=ir.slice,Cr=lr.test(r.attachEvent),Nr=Er&&!/\n|true/.test(Er+Cr),Dr={};Dr[H]=Kn,Dr[z]=Yn,Dr[$]=Wn,Dr[G]=Jn,Dr[Y]=tr,Dr[K]=Zn,Dr[W]=er,Dr[X]=nr;var Pr={};Pr[H]=Pr[$]=Pr[K]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},Pr[z]=Pr[X]={constructor:!0,toString:!0,valueOf:!0},Pr[V]=Pr[G]=Pr[W]={constructor:!0,toString:!0},Pr[Y]={constructor:!0},function(){for(var t=F.length;t--;){var e=F[t];for(var n in Pr)gr.call(Pr,n)&&!gr.call(Pr[n],e)&&(Pr[n][e]=!1)}}(),y.prototype=v.prototype;var Mr=v.support={};!function(){var t=function(){this.x=1},e={0:1,length:1},n=[];t.prototype={valueOf:1,y:1};for(var r in new t)n.push(r);for(r in arguments);Mr.argsObject=arguments.constructor==tr&&!(arguments instanceof Kn),Mr.argsClass=ue(arguments),Mr.enumErrorProps=yr.call(or,"message")||yr.call(or,"name"),Mr.enumPrototypes=yr.call(t,"prototype"),Mr.fastBind=Er&&!Nr,Mr.ownLast="x"!=n[0],Mr.nonEnumArgs=0!=r,Mr.nonEnumShadows=!/valueOf/.test(n),Mr.spliceObjects=(ir.splice.call(e,0,1),!e[0]),Mr.unindexedChars="xx"!="x"[0]+tr("x")[0];try{Mr.nodeClass=!(wr.call(document)==Y&&!({toString:0}+""))}catch(i){Mr.nodeClass=!0}}(1),v.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:R,variable:"",imports:{_:v}};var qr=function(t){var e="var index, iterable = "+t.firstArg+", result = "+t.init+";\nif (!iterable) return result;\n"+t.top+";";t.array?(e+="\nvar length = iterable.length; index = -1;\nif ("+t.array+") {  ",Mr.unindexedChars&&(e+="\n  if (isString(iterable)) {\n    iterable = iterable.split('')\n  }  "),e+="\n  while (++index < length) {\n    "+t.loop+";\n  }\n}\nelse {  "):Mr.nonEnumArgs&&(e+="\n  var length = iterable.length; index = -1;\n  if (length && isArguments(iterable)) {\n    while (++index < length) {\n      index += '';\n      "+t.loop+";\n    }\n  } else {  "),Mr.enumPrototypes&&(e+="\n  var skipProto = typeof iterable == 'function';\n  "),Mr.enumErrorProps&&(e+="\n  var skipErrorProps = iterable === errorProto || iterable instanceof Error;\n  ");var n=[];if(Mr.enumPrototypes&&n.push('!(skipProto && index == "prototype")'),Mr.enumErrorProps&&n.push('!(skipErrorProps && (index == "message" || index == "name"))'),t.useHas&&t.useKeys)e+="\n  var ownIndex = -1,\n      ownProps = objectTypes[typeof iterable] && keys(iterable),\n      length = ownProps ? ownProps.length : 0;\n\n  while (++ownIndex < length) {\n    index = ownProps[ownIndex];\n",n.length&&(e+="    if ("+n.join(" && ")+") {\n  "),e+=t.loop+";    ",n.length&&(e+="\n    }"),e+="\n  }  ";else if(e+="\n  for (index in iterable) {\n",t.useHas&&n.push("hasOwnProperty.call(iterable, index)"),n.length&&(e+="    if ("+n.join(" && ")+") {\n  "),e+=t.loop+";    ",n.length&&(e+="\n    }"),e+="\n  }    ",Mr.nonEnumShadows){for(e+="\n\n  if (iterable !== objectProto) {\n    var ctor = iterable.constructor,\n        isProto = iterable === (ctor && ctor.prototype),\n        className = iterable === stringProto ? stringClass : iterable === errorProto ? errorClass : toString.call(iterable),\n        nonEnum = nonEnumProps[className];\n      ",k=0;7>k;k++)e+="\n    index = '"+t.shadowedProps[k]+"';\n    if ((!(isProto && nonEnum[index]) && hasOwnProperty.call(iterable, index))",t.useHas||(e+=" || (!nonEnum[index] && iterable[index] !== objectProto[index])"),e+=") {\n      "+t.loop+";\n    }      ";e+="\n  }    "}return(t.array||Mr.nonEnumArgs)&&(e+="\n}"),e+=t.bottom+";\nreturn result"},Fr={args:"object, source, guard",top:"var args = arguments,\n    argsIndex = 0,\n    argsLength = typeof guard == 'number' ? 2 : args.length;\nwhile (++argsIndex < argsLength) {\n  iterable = args[argsIndex];\n  if (iterable && objectTypes[typeof iterable]) {",loop:"if (typeof result[index] == 'undefined') result[index] = iterable[index]",bottom:"  }\n}"},Ur={args:"collection, callback, thisArg",top:"callback = callback && typeof thisArg == 'undefined' ? callback : lodash.createCallback(callback, thisArg)",array:"typeof length == 'number'",loop:"if (callback(iterable[index], index, collection) === false) return result"},Br={top:"if (!objectTypes[typeof iterable]) return result;\n"+Ur.top,array:!1};if(!kr)var te=function(t){if(Ee(t)){f.prototype=t;var e=new f;f.prototype=null}return e||{}};Mr.argsClass||(ue=function(t){return t?gr.call(t,"callee"):!1});var Hr=xr||function(t){return t?"object"==typeof t&&wr.call(t)==H:!1},zr=Z({args:"object",init:"[]",top:"if (!(objectTypes[typeof object])) return result",loop:"result.push(index)"}),$r=Sr?function(t){return Ee(t)?Mr.enumPrototypes&&"function"==typeof t||Mr.nonEnumArgs&&t.length&&ue(t)?zr(t):Sr(t):[]}:zr,Vr=Z(Ur),Gr={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Kr=de(Gr),Yr=Z(Fr,{top:Fr.top.replace(";",";\nif (argsLength > 3 && typeof args[argsLength - 2] == 'function') {\n  var callback = lodash.createCallback(args[--argsLength - 1], args[argsLength--], 2);\n} else if (argsLength > 2 && typeof args[argsLength - 1] == 'function') {\n  callback = args[--argsLength];\n}"),loop:"result[index] = callback ? callback(result[index], iterable[index]) : iterable[index]"}),Wr=Z(Fr),Xr=Z(Ur,Br,{useHas:!1}),Jr=Z(Ur,Br);we(/x/)&&(we=function(t){return"function"==typeof t&&wr.call(t)==G});var Qr=mr?function(t){if(!t||wr.call(t)!=Y||!Mr.argsClass&&ue(t))return!1;var e=t.valueOf,n="function"==typeof e&&(n=mr(e))&&mr(n);return n?t==n||mr(t)==n:se(t)}:se,Zr=$e,ti=Fe,ei=oe(function ii(t,e,n){for(var r=-1,i=t?t.length:0,o=[];++r<i;){var s=t[r];n&&(s=n(s,r,t)),Hr(s)?vr.apply(o,e?s:ii(s)):o.push(s)}return o}),ni=oe(function(t,r,i){var o=-1,a=ie(),l=t?t.length:0,c=[],f=!r&&l>=E&&a===e,d=i||f?u():c;if(f){var m=s(d);m?(a=n,d=m):(f=!1,d=i?d:(h(d),c))}for(;++o<l;){var g=t[o],v=i?i(g,o,t):g;(r?!o||d[d.length-1]!==v:a(d,v)<0)&&((i||f)&&d.push(v),c.push(g))}return f?(h(d.array),p(d)):i&&h(d),c});Nr&&ee&&"function"==typeof _r&&(On=bn(_r,r));var ri=8==Lr(C+"08")?Lr:function(t,e){return Lr(Se(t)?t.replace(N,""):t,e||0)};return v.after=_n,v.assign=Yr,v.at=De,v.bind=bn,v.bindAll=wn,v.bindKey=En,v.compact=en,v.compose=kn,v.countBy=Me,v.createCallback=xn,v.debounce=An,v.defaults=Wr,v.defer=On,v.delay=Sn,v.difference=nn,v.filter=Fe,v.flatten=ei,v.forEach=Be,v.forIn=Xr,v.forOwn=Jr,v.functions=he,v.groupBy=He,v.initial=an,v.intersection=un,v.invert=de,v.invoke=ze,v.keys=$r,v.map=$e,v.max=Ve,v.memoize=In,v.merge=je,v.min=Ge,v.omit=Le,v.once=jn,v.pairs=Re,v.partial=Ln,v.partialRight=Rn,v.pick=Te,v.pluck=Zr,v.range=fn,v.reject=We,v.rest=hn,v.shuffle=Xe,v.sortBy=Ze,v.tap=$n,v.throttle=Tn,v.times=Bn,v.toArray=tn,v.transform=Ce,v.union=dn,v.uniq=ni,v.unzip=mn,v.values=Ne,v.where=ti,v.without=gn,v.wrap=Cn,v.zip=vn,v.zipObject=yn,v.collect=$e,v.drop=hn,v.each=Be,v.extend=Yr,v.methods=he,v.object=yn,v.select=Fe,v.tail=hn,v.unique=ni,Pn(v),v.chain=v,v.prototype.chain=function(){return this},v.clone=le,v.cloneDeep=ce,v.contains=Pe,v.escape=Nn,v.every=qe,v.find=Ue,v.findIndex=rn,v.findKey=fe,v.has=pe,v.identity=Dn,v.indexOf=sn,v.isArguments=ue,v.isArray=Hr,v.isBoolean=me,v.isDate=ge,v.isElement=ve,v.isEmpty=ye,v.isEqual=_e,v.isFinite=be,v.isFunction=we,v.isNaN=ke,v.isNull=xe,v.isNumber=Ae,v.isObject=Ee,v.isPlainObject=Qr,v.isRegExp=Oe,v.isString=Se,v.isUndefined=Ie,v.lastIndexOf=cn,v.mixin=Pn,v.noConflict=Mn,v.parseInt=ri,v.random=qn,v.reduce=Ke,v.reduceRight=Ye,v.result=Fn,v.runInContext=m,v.size=Je,v.some=Qe,v.sortedIndex=pn,v.template=Un,v.unescape=Hn,v.uniqueId=zn,v.all=qe,v.any=Qe,v.detect=Ue,v.findWhere=Ue,v.foldl=Ke,v.foldr=Ye,v.include=Pe,v.inject=Ke,Jr(v,function(t,e){v.prototype[e]||(v.prototype[e]=function(){var e=[this.__wrapped__];return vr.apply(e,arguments),t.apply(v,e)})}),v.first=on,v.last=ln,v.take=on,v.head=on,Jr(v,function(t,e){v.prototype[e]||(v.prototype[e]=function(e,n){var r=t(this.__wrapped__,e,n);return null==e||n&&"function"!=typeof e?r:new y(r)})}),v.VERSION="1.3.1",v.prototype.toString=Vn,v.prototype.value=Gn,v.prototype.valueOf=Gn,Vr(["join","pop","shift"],function(t){var e=ir[t];v.prototype[t]=function(){return e.apply(this.__wrapped__,arguments)}}),Vr(["push","reverse","sort","unshift"],function(t){var e=ir[t];v.prototype[t]=function(){return e.apply(this.__wrapped__,arguments),this}}),Vr(["concat","slice","splice"],function(t){var e=ir[t];v.prototype[t]=function(){return new y(e.apply(this.__wrapped__,arguments))}}),Mr.spliceObjects||Vr(["pop","shift","splice"],function(t){var e=ir[t],n="splice"==t;v.prototype[t]=function(){var t=this.__wrapped__,r=e.apply(t,arguments);return 0===t.length&&delete t[0],n?new y(r):r}}),v}var g,v=[],y=[],_=0,b={},w=+new Date+"",E=75,x=40,A=/\b__p \+= '';/g,O=/\b(__p \+=) '' \+/g,S=/(__e\(.*?\)|\b__t\)) \+\n'';/g,I=/&(?:amp|lt|gt|quot|#39);/g,j=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,L=/\w*$/,R=/<%=([\s\S]+?)%>/g,T=(T=/\bthis\b/)&&T.test(m)&&T,C=" 	\fÂ ï»¿\n\r\u2028\u2029áš€á Žâ€€â€â€‚â€ƒâ€„â€…â€†â€‡â€ˆâ€‰â€Šâ€¯âŸã€€",N=RegExp("^["+C+"]*0+(?=.$)"),D=/($^)/,P=/[&<>"']/g,M=/['\n\r\t\u2028\u2029\\]/g,q=["Array","Boolean","Date","Error","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setImmediate","setTimeout"],F=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],U=0,B="[object Arguments]",H="[object Array]",z="[object Boolean]",$="[object Date]",V="[object Error]",G="[object Function]",K="[object Number]",Y="[object Object]",W="[object RegExp]",X="[object String]",J={};J[G]=!1,J[B]=J[H]=J[z]=J[$]=J[K]=J[Y]=J[W]=J[X]=!0;var Q={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},Z={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},te=Q[typeof exports]&&exports,ee=Q[typeof module]&&module&&module.exports==te&&module,ne=Q[typeof global]&&global;!ne||ne.global!==ne&&ne.window!==ne||(t=ne);var re=m();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(t._=re,define("lodash",[],function(){return re})):te&&!te.nodeType?ee?(ee.exports=re)._=re:te._=re:t._=re}(this),define("hide_lodash",["lodash"],function(t){t.noConflict()}),define("iefix",[],function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(t){var e=this.length>>>0,n=Number(arguments[1])||0;for(n=0>n?Math.ceil(n):Math.floor(n),0>n&&(n+=e);e>n;n++)if(n in this&&this[n]===t)return n;return-1})}),define("global/window",[],function(){return window}),!function(t){function e(){this._events={},this._conf&&n.call(this,this._conf)}function n(t){t&&(this._conf=t,t.delimiter&&(this.delimiter=t.delimiter),t.maxListeners&&(this._events.maxListeners=t.maxListeners),t.wildcard&&(this.wildcard=t.wildcard),t.newListener&&(this.newListener=t.newListener),this.wildcard&&(this.listenerTree={}))}function r(t){this._events={},this.newListener=!1,n.call(this,t)}function i(t,e,n,r){if(!n)return[];var o,s,a,u,l,c,f,h=[],p=e.length,d=e[r],m=e[r+1];if(r===p&&n._listeners){if("function"==typeof n._listeners)return t&&t.push(n._listeners),[n];for(o=0,s=n._listeners.length;s>o;o++)t&&t.push(n._listeners[o]);
return[n]}if("*"===d||"**"===d||n[d]){if("*"===d){for(a in n)"_listeners"!==a&&n.hasOwnProperty(a)&&(h=h.concat(i(t,e,n[a],r+1)));return h}if("**"===d){f=r+1===p||r+2===p&&"*"===m,f&&n._listeners&&(h=h.concat(i(t,e,n,p)));for(a in n)"_listeners"!==a&&n.hasOwnProperty(a)&&("*"===a||"**"===a?(n[a]._listeners&&!f&&(h=h.concat(i(t,e,n[a],p))),h=h.concat(i(t,e,n[a],r))):h=a===m?h.concat(i(t,e,n[a],r+2)):h.concat(i(t,e,n[a],r)));return h}h=h.concat(i(t,e,n[d],r+1))}if(u=n["*"],u&&i(t,e,u,r+1),l=n["**"])if(p>r){l._listeners&&i(t,e,l,p);for(a in l)"_listeners"!==a&&l.hasOwnProperty(a)&&(a===m?i(t,e,l[a],r+2):a===d?i(t,e,l[a],r+1):(c={},c[a]=l[a],i(t,e,{"**":c},r+1)))}else l._listeners?i(t,e,l,p):l["*"]&&l["*"]._listeners&&i(t,e,l["*"],p);return h}function o(t,e){t="string"==typeof t?t.split(this.delimiter):t.slice();for(var n=0,r=t.length;r>n+1;n++)if("**"===t[n]&&"**"===t[n+1])return;for(var i=this.listenerTree,o=t.shift();o;){if(i[o]||(i[o]={}),i=i[o],0===t.length){if(i._listeners){if("function"==typeof i._listeners)i._listeners=[i._listeners,e];else if(s(i._listeners)&&(i._listeners.push(e),!i._listeners.warned)){var u=a;"undefined"!=typeof this._events.maxListeners&&(u=this._events.maxListeners),u>0&&i._listeners.length>u&&(i._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",i._listeners.length),console.trace())}}else i._listeners=e;return!0}o=t.shift()}return!0}var s=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},a=10;r.prototype.delimiter=".",r.prototype.setMaxListeners=function(t){this._events||e.call(this),this._events.maxListeners=t,this._conf||(this._conf={}),this._conf.maxListeners=t},r.prototype.event="",r.prototype.once=function(t,e){return this.many(t,1,e),this},r.prototype.many=function(t,e,n){function r(){0===--e&&i.off(t,r),n.apply(this,arguments)}var i=this;if("function"!=typeof n)throw new Error("many only accepts instances of Function");return r._origin=n,this.on(t,r),i},r.prototype.emit=function(){this._events||e.call(this);var t=arguments[0];if("newListener"===t&&!this.newListener&&!this._events.newListener)return!1;if(this._all){for(var n=arguments.length,r=new Array(n-1),o=1;n>o;o++)r[o-1]=arguments[o];for(o=0,n=this._all.length;n>o;o++)this.event=t,this._all[o].apply(this,r)}if("error"===t&&!(this._all||this._events.error||this.wildcard&&this.listenerTree.error))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");var s;if(this.wildcard){s=[];var a="string"==typeof t?t.split(this.delimiter):t.slice();i.call(this,s,a,this.listenerTree,0)}else s=this._events[t];if("function"==typeof s){if(this.event=t,1===arguments.length)s.call(this);else if(arguments.length>1)switch(arguments.length){case 2:s.call(this,arguments[1]);break;case 3:s.call(this,arguments[1],arguments[2]);break;default:for(var n=arguments.length,r=new Array(n-1),o=1;n>o;o++)r[o-1]=arguments[o];s.apply(this,r)}return!0}if(s){for(var n=arguments.length,r=new Array(n-1),o=1;n>o;o++)r[o-1]=arguments[o];for(var u=s.slice(),o=0,n=u.length;n>o;o++)this.event=t,u[o].apply(this,r);return u.length>0||this._all}return this._all},r.prototype.on=function(t,n){if("function"==typeof t)return this.onAny(t),this;if("function"!=typeof n)throw new Error("on only accepts instances of Function");if(this._events||e.call(this),this.emit("newListener",t,n),this.wildcard)return o.call(this,t,n),this;if(this._events[t]){if("function"==typeof this._events[t])this._events[t]=[this._events[t],n];else if(s(this._events[t])&&(this._events[t].push(n),!this._events[t].warned)){var r=a;"undefined"!=typeof this._events.maxListeners&&(r=this._events.maxListeners),r>0&&this._events[t].length>r&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),console.trace())}}else this._events[t]=n;return this},r.prototype.onAny=function(t){if(this._all||(this._all=[]),"function"!=typeof t)throw new Error("onAny only accepts instances of Function");return this._all.push(t),this},r.prototype.addListener=r.prototype.on,r.prototype.off=function(t,e){if("function"!=typeof e)throw new Error("removeListener only takes instances of Function");var n,r=[];if(this.wildcard){var o="string"==typeof t?t.split(this.delimiter):t.slice();r=i.call(this,null,o,this.listenerTree,0)}else{if(!this._events[t])return this;n=this._events[t],r.push({_listeners:n})}for(var a=0;a<r.length;a++){var u=r[a];if(n=u._listeners,s(n)){for(var l=-1,c=0,f=n.length;f>c;c++)if(n[c]===e||n[c].listener&&n[c].listener===e||n[c]._origin&&n[c]._origin===e){l=c;break}if(0>l)return this;this.wildcard?u._listeners.splice(l,1):this._events[t].splice(l,1),0===n.length&&(this.wildcard?delete u._listeners:delete this._events[t])}else(n===e||n.listener&&n.listener===e||n._origin&&n._origin===e)&&(this.wildcard?delete u._listeners:delete this._events[t])}return this},r.prototype.offAny=function(t){var e,n=0,r=0;if(t&&this._all&&this._all.length>0){for(e=this._all,n=0,r=e.length;r>n;n++)if(t===e[n])return e.splice(n,1),this}else this._all=[];return this},r.prototype.removeListener=r.prototype.off,r.prototype.removeAllListeners=function(t){if(0===arguments.length)return!this._events||e.call(this),this;if(this.wildcard)for(var n="string"==typeof t?t.split(this.delimiter):t.slice(),r=i.call(this,null,n,this.listenerTree,0),o=0;o<r.length;o++){var s=r[o];s._listeners=null}else{if(!this._events[t])return this;this._events[t]=null}return this},r.prototype.listeners=function(t){if(this.wildcard){var n=[],r="string"==typeof t?t.split(this.delimiter):t.slice();return i.call(this,n,r,this.listenerTree,0),n}return this._events||e.call(this),this._events[t]||(this._events[t]=[]),s(this._events[t])||(this._events[t]=[this._events[t]]),this._events[t]},r.prototype.listenersAny=function(){return this._all?this._all:[]},"function"==typeof define&&define.amd?define("eventemitter2",[],function(){return r}):t.EventEmitter2=r}("undefined"!=typeof process&&"undefined"!=typeof process.title&&"undefined"!=typeof exports?exports:window),function(){var t={};t.constructor=function(){};var e=this;t.register=function(){function t(t){return function(){i++||(e(),t&&t.apply(this,arguments))}}function e(){if(n){for(var t=0;r>t;t+=3){var e=n[t],i=n[t+1],o=n[t+2];e.removeListener?e.removeListener(i,o):e.off(i,o)}n=null}}var n=1===arguments.length?arguments[0]:arguments,r=n.length;if(0!==r%3)throw new Error("register needs triplets as arguments");for(var i=0,o=0;r>o;o+=3){var s=n[o],a=n[o+1],u=n[o+2];"!"==a.substr(0,1)&&(a=n[o+1]=a.substr(1),u=n[o+2]=t(u)),s.addListener?s.addListener(a,u):s.on(a,u)}return e},t.singular=function(t){return function(){if(t){var e=t;return t=null,e.apply(this,arguments)}}},"undefined"!=typeof define&&define.amd?define("eventutil",[],function(){return t}):"undefined"!=typeof module&&module.exports?module.exports=t:e.eventutil=t}(),define("global/json",["global/window"],function(t){return t.JSON}),function(){function t(t){var n=!1;return function(){if(n)throw new Error("Callback was already called.");n=!0,t.apply(e,arguments)}}var e,n,r={};e=this,null!=e&&(n=e.async),r.noConflict=function(){return e.async=n,r};var i=function(t,e){if(t.forEach)return t.forEach(e);for(var n=0;n<t.length;n+=1)e(t[n],n,t)},o=function(t,e){if(t.map)return t.map(e);var n=[];return i(t,function(t,r,i){n.push(e(t,r,i))}),n},s=function(t,e,n){return t.reduce?t.reduce(e,n):(i(t,function(t,r,i){n=e(n,t,r,i)}),n)},a=function(t){if(Object.keys)return Object.keys(t);var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n);return e};"undefined"!=typeof process&&process.nextTick?(r.nextTick=process.nextTick,r.setImmediate="undefined"!=typeof setImmediate?setImmediate:r.nextTick):"function"==typeof setImmediate?(r.nextTick=function(t){setImmediate(t)},r.setImmediate=r.nextTick):(r.nextTick=function(t){setTimeout(t,0)},r.setImmediate=r.nextTick),r.each=function(e,n,r){if(r=r||function(){},!e.length)return r();var o=0;i(e,function(i){n(i,t(function(t){t?(r(t),r=function(){}):(o+=1,o>=e.length&&r(null))}))})},r.forEach=r.each,r.eachSeries=function(t,e,n){if(n=n||function(){},!t.length)return n();var r=0,i=function(){e(t[r],function(e){e?(n(e),n=function(){}):(r+=1,r>=t.length?n(null):i())})};i()},r.forEachSeries=r.eachSeries,r.eachLimit=function(t,e,n,r){var i=u(e);i.apply(null,[t,n,r])},r.forEachLimit=r.eachLimit;var u=function(t){return function(e,n,r){if(r=r||function(){},!e.length||0>=t)return r();var i=0,o=0,s=0;!function a(){if(i>=e.length)return r();for(;t>s&&o<e.length;)o+=1,s+=1,n(e[o-1],function(t){t?(r(t),r=function(){}):(i+=1,s-=1,i>=e.length?r():a())})}()}},l=function(t){return function(){var e=Array.prototype.slice.call(arguments);return t.apply(null,[r.each].concat(e))}},c=function(t,e){return function(){var n=Array.prototype.slice.call(arguments);return e.apply(null,[u(t)].concat(n))}},f=function(t){return function(){var e=Array.prototype.slice.call(arguments);return t.apply(null,[r.eachSeries].concat(e))}},h=function(t,e,n,r){var i=[];e=o(e,function(t,e){return{index:e,value:t}}),t(e,function(t,e){n(t.value,function(n,r){i[t.index]=r,e(n)})},function(t){r(t,i)})};r.map=l(h),r.mapSeries=f(h),r.mapLimit=function(t,e,n,r){return p(e)(t,n,r)};var p=function(t){return c(t,h)};r.reduce=function(t,e,n,i){r.eachSeries(t,function(t,r){n(e,t,function(t,n){e=n,r(t)})},function(t){i(t,e)})},r.inject=r.reduce,r.foldl=r.reduce,r.reduceRight=function(t,e,n,i){var s=o(t,function(t){return t}).reverse();r.reduce(s,e,n,i)},r.foldr=r.reduceRight;var d=function(t,e,n,r){var i=[];e=o(e,function(t,e){return{index:e,value:t}}),t(e,function(t,e){n(t.value,function(n){n&&i.push(t),e()})},function(){r(o(i.sort(function(t,e){return t.index-e.index}),function(t){return t.value}))})};r.filter=l(d),r.filterSeries=f(d),r.select=r.filter,r.selectSeries=r.filterSeries;var m=function(t,e,n,r){var i=[];e=o(e,function(t,e){return{index:e,value:t}}),t(e,function(t,e){n(t.value,function(n){n||i.push(t),e()})},function(){r(o(i.sort(function(t,e){return t.index-e.index}),function(t){return t.value}))})};r.reject=l(m),r.rejectSeries=f(m);var g=function(t,e,n,r){t(e,function(t,e){n(t,function(n){n?(r(t),r=function(){}):e()})},function(){r()})};r.detect=l(g),r.detectSeries=f(g),r.some=function(t,e,n){r.each(t,function(t,r){e(t,function(t){t&&(n(!0),n=function(){}),r()})},function(){n(!1)})},r.any=r.some,r.every=function(t,e,n){r.each(t,function(t,r){e(t,function(t){t||(n(!1),n=function(){}),r()})},function(){n(!0)})},r.all=r.every,r.sortBy=function(t,e,n){r.map(t,function(t,n){e(t,function(e,r){e?n(e):n(null,{value:t,criteria:r})})},function(t,e){if(t)return n(t);var r=function(t,e){var n=t.criteria,r=e.criteria;return r>n?-1:n>r?1:0};n(null,o(e.sort(r),function(t){return t.value}))})},r.auto=function(t,e){e=e||function(){};var n=a(t);if(!n.length)return e(null);var o={},u=[],l=function(t){u.unshift(t)},c=function(t){for(var e=0;e<u.length;e+=1)if(u[e]===t)return u.splice(e,1),void 0},f=function(){i(u.slice(0),function(t){t()})};l(function(){a(o).length===n.length&&(e(null,o),e=function(){})}),i(n,function(n){var u=t[n]instanceof Function?[t[n]]:t[n],h=function(t){var s=Array.prototype.slice.call(arguments,1);if(s.length<=1&&(s=s[0]),t){var u={};i(a(o),function(t){u[t]=o[t]}),u[n]=s,e(t,u),e=function(){}}else o[n]=s,r.setImmediate(f)},p=u.slice(0,Math.abs(u.length-1))||[],d=function(){return s(p,function(t,e){return t&&o.hasOwnProperty(e)},!0)&&!o.hasOwnProperty(n)};if(d())u[u.length-1](h,o);else{var m=function(){d()&&(c(m),u[u.length-1](h,o))};l(m)}})},r.waterfall=function(t,e){if(e=e||function(){},t.constructor!==Array){var n=new Error("First argument to waterfall must be an array of functions");return e(n)}if(!t.length)return e();var i=function(t){return function(n){if(n)e.apply(null,arguments),e=function(){};else{var o=Array.prototype.slice.call(arguments,1),s=t.next();s?o.push(i(s)):o.push(e),r.setImmediate(function(){t.apply(null,o)})}}};i(r.iterator(t))()};var v=function(t,e,n){if(n=n||function(){},e.constructor===Array)t.map(e,function(t,e){t&&t(function(t){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),e.call(null,t,n)})},n);else{var r={};t.each(a(e),function(t,n){e[t](function(e){var i=Array.prototype.slice.call(arguments,1);i.length<=1&&(i=i[0]),r[t]=i,n(e)})},function(t){n(t,r)})}};r.parallel=function(t,e){v({map:r.map,each:r.each},t,e)},r.parallelLimit=function(t,e,n){v({map:p(e),each:u(e)},t,n)},r.series=function(t,e){if(e=e||function(){},t.constructor===Array)r.mapSeries(t,function(t,e){t&&t(function(t){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),e.call(null,t,n)})},e);else{var n={};r.eachSeries(a(t),function(e,r){t[e](function(t){var i=Array.prototype.slice.call(arguments,1);i.length<=1&&(i=i[0]),n[e]=i,r(t)})},function(t){e(t,n)})}},r.iterator=function(t){var e=function(n){var r=function(){return t.length&&t[n].apply(null,arguments),r.next()};return r.next=function(){return n<t.length-1?e(n+1):null},r};return e(0)},r.apply=function(t){var e=Array.prototype.slice.call(arguments,1);return function(){return t.apply(null,e.concat(Array.prototype.slice.call(arguments)))}};var y=function(t,e,n,r){var i=[];t(e,function(t,e){n(t,function(t,n){i=i.concat(n||[]),e(t)})},function(t){r(t,i)})};r.concat=l(y),r.concatSeries=f(y),r.whilst=function(t,e,n){t()?e(function(i){return i?n(i):(r.whilst(t,e,n),void 0)}):n()},r.doWhilst=function(t,e,n){t(function(i){return i?n(i):(e()?r.doWhilst(t,e,n):n(),void 0)})},r.until=function(t,e,n){t()?n():e(function(i){return i?n(i):(r.until(t,e,n),void 0)})},r.doUntil=function(t,e,n){t(function(i){return i?n(i):(e()?n():r.doUntil(t,e,n),void 0)})},r.queue=function(e,n){function o(t,e,o,s){e.constructor!==Array&&(e=[e]),i(e,function(e){var i={data:e,callback:"function"==typeof s?s:null};o?t.tasks.unshift(i):t.tasks.push(i),t.saturated&&t.tasks.length===n&&t.saturated(),r.setImmediate(t.process)})}void 0===n&&(n=1);var s=0,a={tasks:[],concurrency:n,saturated:null,empty:null,drain:null,push:function(t,e){o(a,t,!1,e)},unshift:function(t,e){o(a,t,!0,e)},process:function(){if(s<a.concurrency&&a.tasks.length){var n=a.tasks.shift();a.empty&&0===a.tasks.length&&a.empty(),s+=1;var r=function(){s-=1,n.callback&&n.callback.apply(n,arguments),a.drain&&0===a.tasks.length+s&&a.drain(),a.process()},i=t(r);e(n.data,i)}},length:function(){return a.tasks.length},running:function(){return s}};return a},r.cargo=function(t,e){var n=!1,s=[],a={tasks:s,payload:e,saturated:null,empty:null,drain:null,push:function(t,n){t.constructor!==Array&&(t=[t]),i(t,function(t){s.push({data:t,callback:"function"==typeof n?n:null}),a.saturated&&s.length===e&&a.saturated()}),r.setImmediate(a.process)},process:function u(){if(!n){if(0===s.length)return a.drain&&a.drain(),void 0;var r="number"==typeof e?s.splice(0,e):s.splice(0),l=o(r,function(t){return t.data});a.empty&&a.empty(),n=!0,t(l,function(){n=!1;var t=arguments;i(r,function(e){e.callback&&e.callback.apply(null,t)}),u()})}},length:function(){return s.length},running:function(){return n}};return a};var _=function(t){return function(e){var n=Array.prototype.slice.call(arguments,1);e.apply(null,n.concat([function(e){var n=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(e?console.error&&console.error(e):console[t]&&i(n,function(e){console[t](e)}))}]))}};r.log=_("log"),r.dir=_("dir"),r.memoize=function(t,e){var n={},r={};e=e||function(t){return t};var i=function(){var i=Array.prototype.slice.call(arguments),o=i.pop(),s=e.apply(null,i);s in n?o.apply(null,n[s]):s in r?r[s].push(o):(r[s]=[o],t.apply(null,i.concat([function(){n[s]=arguments;var t=r[s];delete r[s];for(var e=0,i=t.length;i>e;e++)t[e].apply(null,arguments)}])))};return i.memo=n,i.unmemoized=t,i},r.unmemoize=function(t){return function(){return(t.unmemoized||t).apply(null,arguments)}},r.times=function(t,e,n){for(var i=[],o=0;t>o;o++)i.push(o);return r.map(i,e,n)},r.timesSeries=function(t,e,n){for(var i=[],o=0;t>o;o++)i.push(o);return r.mapSeries(i,e,n)},r.compose=function(){var t=Array.prototype.reverse.call(arguments);return function(){var e=this,n=Array.prototype.slice.call(arguments),i=n.pop();r.reduce(t,n,function(t,n,r){n.apply(e,t.concat([function(){var t=arguments[0],e=Array.prototype.slice.call(arguments,1);r(t,e)}]))},function(t,n){i.apply(e,[t].concat(n))})}};var b=function(t,e){var n=function(){var n=this,r=Array.prototype.slice.call(arguments),i=r.pop();return t(e,function(t,e){t.apply(n,r.concat([e]))},i)};if(arguments.length>2){var r=Array.prototype.slice.call(arguments,2);return n.apply(this,r)}return n};r.applyEach=l(b),r.applyEachSeries=f(b),r.forever=function(t,e){function n(r){if(r){if(e)return e(r);throw r}t(n)}n()},"undefined"!=typeof define&&define.amd?define("async",[],function(){return r}):"undefined"!=typeof module&&module.exports?module.exports=r:e.async=r}(),function(t){if("function"==typeof bootstrap)bootstrap("promise",t);else if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define("Q",t);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=t}else Q=t()}(function(){function t(t){return function(){return W.apply(t,arguments)}}function e(t){return t===Object(t)}function n(t){return"[object StopIteration]"===re(t)||t instanceof V}function r(t,e){if(H&&e.stack&&"object"==typeof t&&null!==t&&t.stack&&-1===t.stack.indexOf(oe)){for(var n=[],r=e;r;r=r.source)r.stack&&n.unshift(r.stack);n.unshift(t.stack);var o=n.join("\n"+oe+"\n");t.stack=i(o)}}function i(t){for(var e=t.split("\n"),n=[],r=0;r<e.length;++r){var i=e[r];a(i)||o(i)||!i||n.push(i)}return n.join("\n")}function o(t){return-1!==t.indexOf("(module.js:")||-1!==t.indexOf("(node.js:")}function s(t){var e=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(t);if(e)return[e[1],Number(e[2])];var n=/at ([^ ]+):(\d+):(?:\d+)$/.exec(t);if(n)return[n[1],Number(n[2])];var r=/.*@(.+):(\d+)$/.exec(t);return r?[r[1],Number(r[2])]:void 0}function a(t){var e=s(t);if(!e)return!1;var n=e[0],r=e[1];return n===$&&r>=G&&ce>=r}function u(){if(H)try{throw new Error}catch(t){var e=t.stack.split("\n"),n=e[0].indexOf("@")>0?e[1]:e[2],r=s(n);if(!r)return;return $=r[0],r[1]}}function l(t,e,n){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(e+" is deprecated, use "+n+" instead.",new Error("").stack),t.apply(t,arguments)}}function c(t){return v(t)?t:y(t)?j(t):I(t)}function f(){function t(t){e=t,o.source=t,J(n,function(e,n){Y(function(){t.promiseDispatch.apply(t,n)})},void 0),n=void 0,r=void 0}var e,n=[],r=[],i=te(f.prototype),o=te(d.prototype);if(o.promiseDispatch=function(t,i,o){var s=X(arguments);n?(n.push(s),"when"===i&&o[1]&&r.push(o[1])):Y(function(){e.promiseDispatch.apply(e,s)})},o.valueOf=l(function(){if(n)return o;var t=g(e);return v(t)&&(e=t),t},"valueOf","inspect"),o.inspect=function(){return e?e.inspect():{state:"pending"}},c.longStackSupport&&H)try{throw new Error}catch(s){o.stack=s.stack.substring(s.stack.indexOf("\n")+1)}return i.promise=o,i.resolve=function(n){e||t(c(n))},i.fulfill=function(n){e||t(I(n))},i.reject=function(n){e||t(S(n))},i.notify=function(t){e||J(r,function(e,n){Y(function(){n(t)})},void 0)},i}function h(t){if("function"!=typeof t)throw new TypeError("resolver must be a function.");var e=f();try{t(e.resolve,e.reject,e.notify)}catch(n){e.reject(n)}return e.promise}function p(t){return h(function(e,n){for(var r=0,i=t.length;i>r;r++)c(t[r]).then(e,n)})}function d(t,e,n){void 0===e&&(e=function(t){return S(new Error("Promise does not support operation: "+t))}),void 0===n&&(n=function(){return{state:"unknown"}});var r=te(d.prototype);if(r.promiseDispatch=function(n,i,o){var s;try{s=t[i]?t[i].apply(r,o):e.call(r,i,o)}catch(a){s=S(a)}n&&n(s)},r.inspect=n,n){var i=n();"rejected"===i.state&&(r.exception=i.reason),r.valueOf=l(function(){var t=n();return"pending"===t.state||"rejected"===t.state?r:t.value})}return r}function m(t,e,n,r){return c(t).then(e,n,r)}function g(t){if(v(t)){var e=t.inspect();if("fulfilled"===e.state)return e.value}return t}function v(t){return e(t)&&"function"==typeof t.promiseDispatch&&"function"==typeof t.inspect}function y(t){return e(t)&&"function"==typeof t.then}function _(t){return v(t)&&"pending"===t.inspect().state}function b(t){return!v(t)||"fulfilled"===t.inspect().state}function w(t){return v(t)&&"rejected"===t.inspect().state}function E(){ue||"undefined"==typeof window||window.Touch||!window.console||console.warn("[Q] Unhandled rejection reasons (should be empty):",se),ue=!0}function k(){for(var t=0;t<se.length;t++){var e=se[t];console.warn("Unhandled rejection reason:",e)}}function x(){se.length=0,ae.length=0,ue=!1,le||(le=!0,"undefined"!=typeof process&&process.on&&process.on("exit",k))}function A(t,e){le&&(ae.push(t),e&&"undefined"!=typeof e.stack?se.push(e.stack):se.push("(no stack) "+e),E())}function O(t){if(le){var e=Q(ae,t);-1!==e&&(ae.splice(e,1),se.splice(e,1))}}function S(t){var e=d({when:function(e){return e&&O(this),e?e(t):this}},function(){return this},function(){return{state:"rejected",reason:t}});return A(e,t),e}function I(t){return d({when:function(){return t},get:function(e){return t[e]},set:function(e,n){t[e]=n},"delete":function(e){delete t[e]},post:function(e,n){return null===e||void 0===e?t.apply(void 0,n):t[e].apply(t,n)},apply:function(e,n){return t.apply(e,n)},keys:function(){return ne(t)}},void 0,function(){return{state:"fulfilled",value:t}})}function j(t){var e=f();return Y(function(){try{t.then(e.resolve,e.reject,e.notify)}catch(n){e.reject(n)}}),e.promise}function L(t){return d({isDef:function(){}},function(e,n){return P(t,e,n)},function(){return c(t).inspect()})}function R(t,e,n){return c(t).spread(e,n)}function T(t){return function(){function e(t,e){var s;if(ie){try{s=r[t](e)}catch(a){return S(a)}return s.done?s.value:m(s.value,i,o)}try{s=r[t](e)}catch(a){return n(a)?a.value:S(a)}return m(s,i,o)}var r=t.apply(this,arguments),i=e.bind(e,"next"),o=e.bind(e,"throw");return i()}}function C(t){c.done(c.async(t)())}function N(t){throw new V(t)}function D(t){return function(){return R([this,M(arguments)],function(e,n){return t.apply(e,n)})}}function P(t,e,n){return c(t).dispatch(e,n)}function M(t){return m(t,function(t){var e=0,n=f();return J(t,function(r,i,o){var s;v(i)&&"fulfilled"===(s=i.inspect()).state?t[o]=s.value:(++e,m(i,function(r){t[o]=r,0===--e&&n.resolve(t)},n.reject,function(t){n.notify({index:o,value:t})}))},void 0),0===e&&n.resolve(t),n.promise})}function q(t){return m(t,function(t){return t=Z(t,c),m(M(Z(t,function(t){return m(t,K,K)})),function(){return t})})}function F(t){return c(t).allSettled()}function U(t,e){return c(t).then(void 0,void 0,e)}function B(t,e){return c(t).nodeify(e)}var H=!1;try{throw new Error}catch(z){H=!!z.stack}var $,V,G=u(),K=function(){},Y=function(){function t(){for(;e.next;){e=e.next;var n=e.task;e.task=void 0;var i=e.domain;i&&(e.domain=void 0,i.enter());try{n()}catch(s){if(o)throw i&&i.exit(),setTimeout(t,0),i&&i.enter(),s;setTimeout(function(){throw s},0)}i&&i.exit()}r=!1}var e={task:void 0,next:null},n=e,r=!1,i=void 0,o=!1;if(Y=function(t){n=n.next={task:t,domain:o&&process.domain,next:null},r||(r=!0,i())},"undefined"!=typeof process&&process.nextTick)o=!0,i=function(){process.nextTick(t)};else if("function"==typeof setImmediate)i="undefined"!=typeof window?setImmediate.bind(window,t):function(){setImmediate(t)};else if("undefined"!=typeof MessageChannel){var s=new MessageChannel;s.port1.onmessage=function(){i=a,s.port1.onmessage=t,t()};var a=function(){s.port2.postMessage(0)};i=function(){setTimeout(t,0),a()}}else i=function(){setTimeout(t,0)};return Y}(),W=Function.call,X=t(Array.prototype.slice),J=t(Array.prototype.reduce||function(t,e){var n=0,r=this.length;if(1===arguments.length)for(;;){if(n in this){e=this[n++];break}if(++n>=r)throw new TypeError}for(;r>n;n++)n in this&&(e=t(e,this[n],n));return e}),Q=t(Array.prototype.indexOf||function(t){for(var e=0;e<this.length;e++)if(this[e]===t)return e;return-1}),Z=t(Array.prototype.map||function(t,e){var n=this,r=[];return J(n,function(i,o,s){r.push(t.call(e,o,s,n))},void 0),r}),te=Object.create||function(t){function e(){}return e.prototype=t,new e},ee=t(Object.prototype.hasOwnProperty),ne=Object.keys||function(t){var e=[];for(var n in t)ee(t,n)&&e.push(n);return e},re=t(Object.prototype.toString);V="undefined"!=typeof ReturnValue?ReturnValue:function(t){this.value=t};var ie;try{new Function("(function* (){ yield 1; })"),ie=!0}catch(z){ie=!1}var oe="From previous event:";c.resolve=c,c.nextTick=Y,c.longStackSupport=!1,c.defer=f,f.prototype.makeNodeResolver=function(){var t=this;return function(e,n){e?t.reject(e):arguments.length>2?t.resolve(X(arguments,1)):t.resolve(n)}},c.promise=h,c.passByCopy=function(t){return t},d.prototype.passByCopy=function(){return this},c.join=function(t,e){return c(t).join(e)},d.prototype.join=function(t){return c([this,t]).spread(function(t,e){if(t===e)return t;throw new Error("Can't join: not the same: "+t+" "+e)})},c.race=p,d.prototype.race=function(){return this.then(c.race)},c.makePromise=d,d.prototype.toString=function(){return"[object Promise]"},d.prototype.then=function(t,e,n){function i(e){try{return"function"==typeof t?t(e):e}catch(n){return S(n)}}function o(t){if("function"==typeof e){r(t,a);try{return e(t)}catch(n){return S(n)}}return S(t)}function s(t){return"function"==typeof n?n(t):t}var a=this,u=f(),l=!1;return Y(function(){a.promiseDispatch(function(t){l||(l=!0,u.resolve(i(t)))},"when",[function(t){l||(l=!0,u.resolve(o(t)))}])}),a.promiseDispatch(void 0,"when",[void 0,function(t){var e,n=!1;try{e=s(t)}catch(r){if(n=!0,!c.onerror)throw r;c.onerror(r)}n||u.notify(e)}]),u.promise},c.when=m,d.prototype.thenResolve=function(t){return this.then(function(){return t})},c.thenResolve=function(t,e){return c(t).thenResolve(e)},d.prototype.thenReject=function(t){return this.then(function(){throw t})},c.thenReject=function(t,e){return c(t).thenReject(e)},c.nearer=g,c.isPromise=v,c.isPromiseAlike=y,c.isPending=_,d.prototype.isPending=function(){return"pending"===this.inspect().state},c.isFulfilled=b,d.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},c.isRejected=w,d.prototype.isRejected=function(){return"rejected"===this.inspect().state};var se=[],ae=[],ue=!1,le=!0;c.resetUnhandledRejections=x,c.getUnhandledReasons=function(){return se.slice()},c.stopUnhandledRejectionTracking=function(){x(),"undefined"!=typeof process&&process.on&&process.removeListener("exit",k),le=!1},x(),c.reject=S,c.fulfill=I,c.master=L,c.spread=R,d.prototype.spread=function(t,e){return this.all().then(function(e){return t.apply(void 0,e)},e)},c.async=T,c.spawn=C,c["return"]=N,c.promised=D,c.dispatch=P,d.prototype.dispatch=function(t,e){var n=this,r=f();return Y(function(){n.promiseDispatch(r.resolve,t,e)}),r.promise},c.get=function(t,e){return c(t).dispatch("get",[e])},d.prototype.get=function(t){return this.dispatch("get",[t])},c.set=function(t,e,n){return c(t).dispatch("set",[e,n])},d.prototype.set=function(t,e){return this.dispatch("set",[t,e])},c.del=c["delete"]=function(t,e){return c(t).dispatch("delete",[e])},d.prototype.del=d.prototype["delete"]=function(t){return this.dispatch("delete",[t])},c.mapply=c.post=function(t,e,n){return c(t).dispatch("post",[e,n])},d.prototype.mapply=d.prototype.post=function(t,e){return this.dispatch("post",[t,e])},c.send=c.mcall=c.invoke=function(t,e){return c(t).dispatch("post",[e,X(arguments,2)])},d.prototype.send=d.prototype.mcall=d.prototype.invoke=function(t){return this.dispatch("post",[t,X(arguments,1)])},c.fapply=function(t,e){return c(t).dispatch("apply",[void 0,e])},d.prototype.fapply=function(t){return this.dispatch("apply",[void 0,t])},c["try"]=c.fcall=function(t){return c(t).dispatch("apply",[void 0,X(arguments,1)])},d.prototype.fcall=function(){return this.dispatch("apply",[void 0,X(arguments)])},c.fbind=function(t){var e=c(t),n=X(arguments,1);return function(){return e.dispatch("apply",[this,n.concat(X(arguments))])}},d.prototype.fbind=function(){var t=this,e=X(arguments);return function(){return t.dispatch("apply",[this,e.concat(X(arguments))])}},c.keys=function(t){return c(t).dispatch("keys",[])},d.prototype.keys=function(){return this.dispatch("keys",[])},c.all=M,d.prototype.all=function(){return M(this)},c.allResolved=l(q,"allResolved","allSettled"),d.prototype.allResolved=function(){return q(this)},c.allSettled=F,d.prototype.allSettled=function(){return this.then(function(t){return M(Z(t,function(t){function e(){return t.inspect()}return t=c(t),t.then(e,e)}))})},c.fail=c["catch"]=function(t,e){return c(t).then(void 0,e)},d.prototype.fail=d.prototype["catch"]=function(t){return this.then(void 0,t)},c.progress=U,d.prototype.progress=function(t){return this.then(void 0,void 0,t)},c.fin=c["finally"]=function(t,e){return c(t)["finally"](e)},d.prototype.fin=d.prototype["finally"]=function(t){return t=c(t),this.then(function(e){return t.fcall().then(function(){return e})},function(e){return t.fcall().then(function(){throw e})})},c.done=function(t,e,n,r){return c(t).done(e,n,r)},d.prototype.done=function(t,e,n){var i=function(t){Y(function(){if(r(t,o),!c.onerror)throw t;c.onerror(t)})},o=t||e||n?this.then(t,e,n):this;"object"==typeof process&&process&&process.domain&&(i=process.domain.bind(i)),o.then(void 0,i)},c.timeout=function(t,e,n){return c(t).timeout(e,n)},d.prototype.timeout=function(t,e){var n=f(),r=setTimeout(function(){n.reject(new Error(e||"Timed out after "+t+" ms"))},t);return this.then(function(t){clearTimeout(r),n.resolve(t)},function(t){clearTimeout(r),n.reject(t)},n.notify),n.promise},c.delay=function(t,e){return void 0===e&&(e=t,t=void 0),c(t).delay(e)},d.prototype.delay=function(t){return this.then(function(e){var n=f();return setTimeout(function(){n.resolve(e)},t),n.promise})},c.nfapply=function(t,e){return c(t).nfapply(e)},d.prototype.nfapply=function(t){var e=f(),n=X(t);return n.push(e.makeNodeResolver()),this.fapply(n).fail(e.reject),e.promise},c.nfcall=function(t){var e=X(arguments,1);return c(t).nfapply(e)},d.prototype.nfcall=function(){var t=X(arguments),e=f();return t.push(e.makeNodeResolver()),this.fapply(t).fail(e.reject),e.promise},c.nfbind=c.denodeify=function(t){var e=X(arguments,1);return function(){var n=e.concat(X(arguments)),r=f();return n.push(r.makeNodeResolver()),c(t).fapply(n).fail(r.reject),r.promise}},d.prototype.nfbind=d.prototype.denodeify=function(){var t=X(arguments);return t.unshift(this),c.denodeify.apply(void 0,t)},c.nbind=function(t,e){var n=X(arguments,2);return function(){function r(){return t.apply(e,arguments)}var i=n.concat(X(arguments)),o=f();return i.push(o.makeNodeResolver()),c(r).fapply(i).fail(o.reject),o.promise}},d.prototype.nbind=function(){var t=X(arguments,0);return t.unshift(this),c.nbind.apply(void 0,t)},c.nmapply=c.npost=function(t,e,n){return c(t).npost(e,n)},d.prototype.nmapply=d.prototype.npost=function(t,e){var n=X(e||[]),r=f();return n.push(r.makeNodeResolver()),this.dispatch("post",[t,n]).fail(r.reject),r.promise},c.nsend=c.nmcall=c.ninvoke=function(t,e){var n=X(arguments,2),r=f();return n.push(r.makeNodeResolver()),c(t).dispatch("post",[e,n]).fail(r.reject),r.promise},d.prototype.nsend=d.prototype.nmcall=d.prototype.ninvoke=function(t){var e=X(arguments,1),n=f();return e.push(n.makeNodeResolver()),this.dispatch("post",[t,e]).fail(n.reject),n.promise},c.nodeify=B,d.prototype.nodeify=function(t){return t?(this.then(function(e){Y(function(){t(null,e)})},function(e){Y(function(){t(e)})}),void 0):this};var ce=u();return c}),define("util/resolver",["lodash","Q"],function(t,e){function n(e,r,i){t.bindAll(this),this._deferred=n.Q.defer(),this._fn=e||function(){},this._context=r,this._keys=i,this.cb=this._lift,this.promise=this._deferred.promise}return n.Q=e,n.prototype._lift=function(e){if(e)return this._conclude("reject",e,arguments);
var n=t.toArray(arguments).slice(1);if(1===n.length&&this._keys)throw new Error("when a single arg is returned, no keys can be passed");if(1===n.length)return this._conclude("resolve",n[0],arguments);var r,i={};t.map(this._keys,function(t){return"..."===t.slice(-3)?(r=t.slice(0,t.length-3),i[r]=n,void 0):(i[t]=n.shift(),void 0)}),this._conclude("resolve",i,arguments)},n.prototype._conclude=function(t,e,n){this._deferred[t](e),this._fn.apply(this._context,n)},n}),define("sharedConfig",[],function(){var t={};return t.version="1.15.0-1",t.serverUrl="https://goinstant.net",t.authServerUrl="https://auth.goinstant.net",t.domain="goinstant.net",t.httpsOnly="true"==="True".toLowerCase(),t.componentsUrl="https://cdn.goinstant.net/components/",t.isBarista=window?!!window.isBarista:!1,t.isBarista&&(t.httpsOnly=!1),t}),define("util/guard",["lodash","global/window"],function(t,e){var n={};return n.one=function(n,r){if(!n)throw new Error("Attempted to guard a function that did not exist.");if(!t.isFunction(n))throw new Error("Attempted to guard a property that is not a function");if(!r)throw new Error("Context was not passed to guard");return function(){try{n.apply(r,arguments)}catch(t){e.setTimeout(function(){throw t},0)}}},n.all=function(e,r){t.each(r,function(t){e[t]=n.one(e[t],e)})},n}),function(){function t(e,n,r){var i=t.resolve(e);if(null==i){r=r||e,n=n||"root";var o=new Error('Failed to require "'+r+'" from "'+n+'"');throw o.path=r,o.parent=n,o.require=!0,o}var s=t.modules[i];return s.exports||(s.exports={},s.client=s.component=!0,s.call(this,s.exports,t.relative(i),s)),s.exports}if(t.modules={},t.aliases={},t.resolve=function(e){"/"===e.charAt(0)&&(e=e.slice(1));for(var n=e+"/index.js",r=[e,e+".js",e+".json",e+"/index.js",e+"/index.json"],i=0;i<r.length;i++){var e=r[i];if(t.modules.hasOwnProperty(e))return e}return t.aliases.hasOwnProperty(n)?t.aliases[n]:void 0},t.normalize=function(t,e){var n=[];if("."!=e.charAt(0))return e;t=t.split("/"),e=e.split("/");for(var r=0;r<e.length;++r)".."==e[r]?t.pop():"."!=e[r]&&""!=e[r]&&n.push(e[r]);return t.concat(n).join("/")},t.register=function(e,n){t.modules[e]=n},t.alias=function(e,n){if(!t.modules.hasOwnProperty(e))throw new Error('Failed to alias "'+e+'", it does not exist');t.aliases[n]=e},t.relative=function(e){function n(t,e){for(var n=t.length;n--;)if(t[n]===e)return n;return-1}function r(n){var i=r.resolve(n);return t(i,e,n)}var i=t.normalize(e,"..");return r.resolve=function(r){var o=r.charAt(0);if("/"==o)return r.slice(1);if("."==o)return t.normalize(i,r);var s=e.split("/"),a=n(s,"deps")+1;return a||(a=0),r=s.slice(0,a+1).join("/")+"/deps/"+r},r.exists=function(e){return t.modules.hasOwnProperty(r.resolve(e))},r},t.register("component-emitter/index.js",function(t,e,n){function r(t){return t?i(t):void 0}function i(t){for(var e in r.prototype)t[e]=r.prototype[e];return t}n.exports=r,r.prototype.on=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks[t]=this._callbacks[t]||[]).push(e),this},r.prototype.once=function(t,e){function n(){r.off(t,n),e.apply(this,arguments)}var r=this;return this._callbacks=this._callbacks||{},e._off=n,this.on(t,n),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks[t];if(!n)return this;if(1==arguments.length)return delete this._callbacks[t],this;var r=n.indexOf(e._off||e);return~r&&n.splice(r,1),this},r.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),n=this._callbacks[t];if(n){n=n.slice(0);for(var r=0,i=n.length;i>r;++r)n[r].apply(this,e)}return this},r.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks[t]||[]},r.prototype.hasListeners=function(t){return!!this.listeners(t).length}}),t.register("component-indexof/index.js",function(t,e,n){var r=[].indexOf;n.exports=function(t,e){if(r)return t.indexOf(e);for(var n=0;n<t.length;++n)if(t[n]===e)return n;return-1}}),t.register("LearnBoost-engine.io-protocol/lib/index.js",function(t,e){var n=e("./keys");t.protocol=2;var r=t.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},i=n(r),o={type:"error",data:"parser error"};t.encodePacket=function(t){var e=r[t.type];return void 0!==t.data&&(e+=String(t.data)),""+e},t.decodePacket=function(t){var e=t.charAt(0);return Number(e)==e&&i[e]?t.length>1?{type:i[e],data:t.substring(1)}:{type:i[e]}:o},t.encodePayload=function(e){if(!e.length)return"0:";for(var n,r="",i=0,o=e.length;o>i;i++)n=t.encodePacket(e[i]),r+=n.length+":"+n;return r},t.decodePayload=function(e,n){var r;if(""==e)return n(o,0,1);for(var i,s,a="",u=0,l=e.length;l>u;u++){var c=e.charAt(u);if(":"!=c)a+=c;else{if(""==a||a!=(i=Number(a)))return n(o,0,1);if(s=e.substr(u+1,i),a!=s.length)return n(o,0,1);if(s.length){if(r=t.decodePacket(s),o.type==r.type&&o.data==r.data)return n(o,0,1);var f=n(r,u+i,l);if(!1===f)return}u+=i,a=""}}return""!=a?n(o,0,1):void 0}}),t.register("LearnBoost-engine.io-protocol/lib/keys.js",function(t,e,n){n.exports=Object.keys||function(t){var e=[],n=Object.prototype.hasOwnProperty;for(var r in t)n.call(t,r)&&e.push(r);return e}}),t.register("visionmedia-debug/index.js",function(t,e,n){n.exports="undefined"==typeof window?e("./lib/debug"):e("./debug")}),t.register("visionmedia-debug/debug.js",function(t,e,n){function r(t){return r.enabled(t)?function(e){e=i(e);var n=new Date,o=n-(r[t]||n);r[t]=n,e=t+" "+e+" +"+r.humanize(o),window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}:function(){}}function i(t){return t instanceof Error?t.stack||t.message:t}n.exports=r,r.names=[],r.skips=[],r.enable=function(t){try{localStorage.debug=t}catch(e){}for(var n=(t||"").split(/[\s,]+/),i=n.length,o=0;i>o;o++)t=n[o].replace("*",".*?"),"-"===t[0]?r.skips.push(new RegExp("^"+t.substr(1)+"$")):r.names.push(new RegExp("^"+t+"$"))},r.disable=function(){r.enable("")},r.humanize=function(t){var e=1e3,n=6e4,r=60*n;return t>=r?(t/r).toFixed(1)+"h":t>=n?(t/n).toFixed(1)+"m":t>=e?(0|t/e)+"s":t+"ms"},r.enabled=function(t){for(var e=0,n=r.skips.length;n>e;e++)if(r.skips[e].test(t))return!1;for(var e=0,n=r.names.length;n>e;e++)if(r.names[e].test(t))return!0;return!1},window.localStorage&&r.enable(localStorage.debug)}),t.register("engine.io/lib/index.js",function(t,e,n){n.exports=e("./socket"),n.exports.parser=e("engine.io-parser")}),t.register("engine.io/lib/socket.js",function(t,e,n){function r(t,e){if(!(this instanceof r))return new r(t,e);if(e=e||{},"object"==typeof t&&(e=t,t=null),t&&(t=o.parseUri(t),e.host=t.host,e.secure="https"==t.protocol||"wss"==t.protocol,e.port=t.port,t.query&&(e.query=t.query)),this.secure=null!=e.secure?e.secure:f.location&&"https:"==location.protocol,e.host){var n=e.host.split(":");e.hostname=n.shift(),n.length&&(e.port=n.pop())}this.hostname=e.hostname||(f.location?location.hostname:"localhost"),this.port=e.port||(f.location&&location.port?location.port:this.secure?443:80),this.query=e.query||{},"string"==typeof this.query&&(this.query=o.qsParse(this.query)),this.upgrade=!1!==e.upgrade,this.path=(e.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!e.forceJSONP,this.timestampParam=e.timestampParam||"t",this.timestampRequests=!!e.timestampRequests,this.flashPath=e.flashPath||"",this.transports=e.transports||["polling","websocket","flashsocket"],this.readyState="",this.writeBuffer=[],this.callbackBuffer=[],this.policyPort=e.policyPort||843,this.open(),r.sockets.push(this),r.sockets.evs.emit("add",this)}function i(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}var o=e("./util"),s=e("./transports"),a=e("./emitter"),u=e("debug")("engine-client:socket"),l=e("indexof"),c=e("engine.io-parser");n.exports=r;var f=o.global();a(r.prototype),r.protocol=c.protocol,r.sockets=[],r.sockets.evs=new a,r.Socket=r,r.Transport=e("./transport"),r.Emitter=e("./emitter"),r.transports=e("./transports"),r.util=e("./util"),r.parser=e("engine.io-parser"),r.prototype.createTransport=function(t){u('creating transport "%s"',t);var e=i(this.query);e.EIO=c.protocol,e.transport=t,this.id&&(e.sid=this.id);var n=new s[t]({hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:e,forceJSONP:this.forceJSONP,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,flashPath:this.flashPath,policyPort:this.policyPort});return n},r.prototype.open=function(){this.readyState="opening";var t=this.createTransport(this.transports[0]);t.open(),this.setTransport(t)},r.prototype.setTransport=function(t){var e=this;this.transport&&(u("clearing existing transport"),this.transport.removeAllListeners()),this.transport=t,t.on("drain",function(){e.onDrain()}).on("packet",function(t){e.onPacket(t)}).on("error",function(t){e.onError(t)}).on("close",function(){e.onClose("transport close")})},r.prototype.probe=function(t){function e(e){if(!r){r=!0;var o=new Error("probe error: "+e);o.transport=n.name,n.close(),n=null,u('probe transport "%s" failed because of error: %s',t,e),i.emit("error",o)}}u('probing transport "%s"',t);var n=this.createTransport(t,{probe:1}),r=!1,i=this;n.once("open",function(){r||(u('probe transport "%s" opened',t),n.send([{type:"ping",data:"probe"}]),n.once("packet",function(o){if(!r)if("pong"==o.type&&"probe"==o.data)u('probe transport "%s" pong',t),i.upgrading=!0,i.emit("upgrading",n),u('pausing current transport "%s"',i.transport.name),i.transport.pause(function(){r||"closed"!=i.readyState&&"closing"!=i.readyState&&(u("changing transport and sending upgrade packet"),n.removeListener("error",e),i.emit("upgrade",n),i.setTransport(n),n.send([{type:"upgrade"}]),n=null,i.upgrading=!1,i.flush())});else{u('probe transport "%s" failed',t);var s=new Error("probe error");s.transport=n.name,i.emit("error",s)}}))}),n.once("error",e),n.open(),this.once("close",function(){n&&(u("socket closed prematurely - aborting probe"),r=!0,n.close(),n=null)}),this.once("upgrading",function(t){n&&t.name!=n.name&&(u('"%s" works - aborting "%s"',t.name,n.name),n.close(),n=null)})},r.prototype.onOpen=function(){if(u("socket open"),this.readyState="open",this.emit("open"),this.onopen&&this.onopen.call(this),this.flush(),"open"==this.readyState&&this.upgrade&&this.transport.pause){u("starting upgrade probes");for(var t=0,e=this.upgrades.length;e>t;t++)this.probe(this.upgrades[t])}},r.prototype.onPacket=function(t){if("opening"==this.readyState||"open"==this.readyState)switch(u('socket receive: type "%s", data "%s"',t.type,t.data),this.emit("packet",t),this.emit("heartbeat"),t.type){case"open":this.onHandshake(o.parseJSON(t.data));break;case"pong":this.setPing();break;case"error":var e=new Error("server error");e.code=t.data,this.emit("error",e);break;case"message":this.emit("data",t.data),this.emit("message",t.data);var n={data:t.data};n.toString=function(){return t.data},this.onmessage&&this.onmessage.call(this,n)}else u('packet received with socket readyState "%s"',this.readyState)},r.prototype.onHandshake=function(t){this.emit("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.onOpen(),this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat)},r.prototype.onHeartbeat=function(t){clearTimeout(this.pingTimeoutTimer);var e=this;e.pingTimeoutTimer=setTimeout(function(){"closed"!=e.readyState&&e.onClose("ping timeout")},t||e.pingInterval+e.pingTimeout)},r.prototype.setPing=function(){var t=this;clearTimeout(t.pingIntervalTimer),t.pingIntervalTimer=setTimeout(function(){u("writing ping packet - expecting pong within %sms",t.pingTimeout),t.ping(),t.onHeartbeat(t.pingTimeout)},t.pingInterval)},r.prototype.ping=function(){this.sendPacket("ping")},r.prototype.onDrain=function(){this.callbacks(),this.writeBuffer.splice(0,this.prevBufferLen),this.callbackBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0==this.writeBuffer.length?this.emit("drain"):this.flush()},r.prototype.callbacks=function(){for(var t=0;t<this.prevBufferLen;t++)this.callbackBuffer[t]&&this.callbackBuffer[t]()},r.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(u("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},r.prototype.write=r.prototype.send=function(t,e){return this.sendPacket("message",t,e),this},r.prototype.sendPacket=function(t,e,n){var r={type:t,data:e};this.emit("packetCreate",r),this.writeBuffer.push(r),this.callbackBuffer.push(n),this.flush()},r.prototype.close=function(){return("opening"==this.readyState||"open"==this.readyState)&&(this.onClose("forced close"),u("socket closing - telling transport to close"),this.transport.close(),this.transport.removeAllListeners()),this},r.prototype.onError=function(t){u("socket error %j",t),this.emit("error",t),this.onClose("transport error",t)},r.prototype.onClose=function(t,e){if("opening"==this.readyState||"open"==this.readyState){u('socket close with reason: "%s"',t);var n=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),setTimeout(function(){n.writeBuffer=[],n.callbackBuffer=[],n.prevBufferLen=0},0);var r=this.readyState;this.readyState="closed","open"==r&&this.emit("close",t,e),this.onclose&&this.onclose.call(this),this.id=null}},r.prototype.filterUpgrades=function(t){for(var e=[],n=0,r=t.length;r>n;n++)~l(this.transports,t[n])&&e.push(t[n]);return e}}),t.register("engine.io/lib/transport.js",function(t,e,n){function r(t){this.path=t.path,this.hostname=t.hostname,this.port=t.port,this.secure=t.secure,this.query=t.query,this.timestampParam=t.timestampParam,this.timestampRequests=t.timestampRequests,this.readyState=""}var i=(e("./util"),e("engine.io-parser")),o=e("./emitter");n.exports=r,o(r.prototype),r.prototype.onError=function(t,e){var n=new Error(t);return n.type="TransportError",n.description=e,this.emit("error",n),this},r.prototype.open=function(){return("closed"==this.readyState||""==this.readyState)&&(this.readyState="opening",this.doOpen()),this},r.prototype.close=function(){return("opening"==this.readyState||"open"==this.readyState)&&(this.doClose(),this.onClose()),this},r.prototype.send=function(t){if("open"!=this.readyState)throw new Error("Transport not open");this.write(t)},r.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},r.prototype.onData=function(t){this.onPacket(i.decodePacket(t))},r.prototype.onPacket=function(t){this.emit("packet",t)},r.prototype.onClose=function(){this.readyState="closed",this.emit("close")}}),t.register("engine.io/lib/emitter.js",function(t,e,n){var r=e("emitter");n.exports=r,r.prototype.addEventListener=r.prototype.on,r.prototype.removeEventListener=r.prototype.off,r.prototype.removeListener=r.prototype.off}),t.register("engine.io/lib/util.js",function(t,e){var n=!1;t.global=function(){return"undefined"!=typeof window?window:global},t.inherits=function(t,e){function n(){}n.prototype=e.prototype,t.prototype=new n},t.keys=Object.keys||function(t){var e=[],n=Object.prototype.hasOwnProperty;for(var r in t)n.call(t,r)&&e.push(r);return e},t.on=function(t,e,n,r){t.attachEvent?t.attachEvent("on"+e,n):t.addEventListener&&t.addEventListener(e,n,r)},t.load=function(e){var r=t.global();return r.document&&"complete"===document.readyState||n?e():(t.on(r,"load",e,!1),void 0)},"undefined"!=typeof window&&t.load(function(){n=!0}),t.defer=function(e){return t.ua.webkit&&"undefined"==typeof importScripts?(t.load(function(){setTimeout(e,100)}),void 0):e()};var r=/^[\],:{}\s]*$/,i=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,o=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,s=/(?:^|:|,)(?:\s*\[)+/g,a=/^\s+/,u=/\s+$/;t.parseJSON=function(e){var n=t.global();return"string"==typeof e&&e?(e=e.replace(a,"").replace(u,""),n.JSON&&JSON.parse?JSON.parse(e):r.test(e.replace(i,"@").replace(o,"]").replace(s,""))?new Function("return "+e)():void 0):null},t.ua={},t.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){var t;try{t=new XMLHttpRequest}catch(e){return!1}return void 0!=t.withCredentials}(),t.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent),t.ua.gecko="undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent),t.ua.android="undefined"!=typeof navigator&&/android/i.test(navigator.userAgent),t.ua.ios="undefined"!=typeof navigator&&/^(iPad|iPhone|iPod)$/.test(navigator.platform),t.ua.ios6=t.ua.ios&&/OS 6_/.test(navigator.userAgent),t.request=function(n){try{var r=e("xmlhttprequest").XMLHttpRequest;return new r}catch(i){}if(n&&"undefined"!=typeof XDomainRequest&&!t.ua.hasCORS)return new XDomainRequest;try{if("undefined"!=typeof XMLHttpRequest&&(!n||t.ua.hasCORS))return new XMLHttpRequest}catch(i){}if(!n)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(i){}};var l=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,c=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];t.parseUri=function(t){for(var e=l.exec(t||""),n={},r=14;r--;)n[c[r]]=e[r]||"";return n},t.qs=function(t){var e="";for(var n in t)t.hasOwnProperty(n)&&(e.length&&(e+="&"),e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e},t.qsParse=function(t){for(var e={},n=t.split("&"),r=0,i=n.length;i>r;r++){var o=n[r].split("=");e[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return e}}),t.register("engine.io/lib/transports/index.js",function(t,e){function n(t){var e,n=!1,o=!1;if(u.location){var s="https:"==location.protocol,l=location.port;Number(l)!==l&&(l=s?443:80),n=t.hostname!=location.hostname||l!=t.port,o=t.secure!=s}return e=a.request(n),o&&u.XDomainRequest&&e instanceof u.XDomainRequest?new i(t):e&&!t.forceJSONP?new r(t):new i(t)}var r=e("./polling-xhr"),i=e("./polling-jsonp"),o=e("./websocket"),s=e("./flashsocket"),a=e("../util");t.polling=n,t.websocket=o,t.flashsocket=s;var u=a.global()}),t.register("engine.io/lib/transports/polling.js",function(t,e,n){function r(t){i.call(this,t)}var i=e("../transport"),o=e("../util"),s=e("engine.io-parser"),a=e("debug")("engine.io-client:polling");n.exports=r;var u=o.global();o.inherits(r,i),r.prototype.name="polling",r.prototype.doOpen=function(){this.poll()},r.prototype.pause=function(t){function e(){a("paused"),n.readyState="paused",t()}var n=this;if(this.readyState="pausing",this.polling||!this.writable){var r=0;this.polling&&(a("we are currently polling - waiting to pause"),r++,this.once("pollComplete",function(){a("pre-pause polling complete"),--r||e()})),this.writable||(a("we are currently writing - waiting to pause"),r++,this.once("drain",function(){a("pre-pause writing complete"),--r||e()}))}else e()},r.prototype.poll=function(){a("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},r.prototype.onData=function(t){var e=this;a("polling got data %s",t),s.decodePayload(t,function(t){return"opening"==e.readyState&&e.onOpen(),"close"==t.type?(e.onClose(),!1):(e.onPacket(t),void 0)}),"closed"!=this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():a('ignoring poll - transport state "%s"',this.readyState))},r.prototype.doClose=function(){a("sending close packet"),this.send([{type:"close"}])},r.prototype.write=function(t){var e=this;this.writable=!1,this.doWrite(s.encodePayload(t),function(){e.writable=!0,e.emit("drain")})},r.prototype.uri=function(){var t=this.query||{},e=this.secure?"https":"http",n="";return(u.ActiveXObject||o.ua.android||o.ua.ios6||this.timestampRequests)&&(t[this.timestampParam]=+new Date),t=o.qs(t),this.port&&("https"==e&&443!=this.port||"http"==e&&80!=this.port)&&(n=":"+this.port),t.length&&(t="?"+t),e+"://"+this.hostname+n+this.path+t}}),t.register("engine.io/lib/transports/polling-xhr.js",function(t,e,n){function r(){}function i(t){if(s.call(this,t),c.location){var e="https:"==location.protocol,n=location.port;Number(n)!==n&&(n=e?443:80),this.xd=t.hostname!=c.location.hostname||n!=t.port}}function o(t){this.method=t.method||"GET",this.uri=t.uri,this.xd=!!t.xd,this.async=!1!==t.async,this.data=void 0!=t.data?t.data:null,this.create()}var s=e("./polling"),a=e("../util"),u=e("../emitter"),l=e("debug")("engine.io-client:polling-xhr");n.exports=i,n.exports.Request=o;var c=a.global(),f=c[["Active"].concat("Object").join("X")];a.inherits(i,s),i.prototype.doOpen=function(){var t=this;a.defer(function(){s.prototype.doOpen.call(t)})},i.prototype.request=function(t){return t=t||{},t.uri=this.uri(),t.xd=this.xd,new o(t)},i.prototype.doWrite=function(t,e){var n=this.request({method:"POST",data:t}),r=this;n.on("success",e),n.on("error",function(t){r.onError("xhr post error",t)}),this.sendXhr=n},i.prototype.doPoll=function(){l("xhr poll");var t=this.request(),e=this;t.on("data",function(t){e.onData(t)}),t.on("error",function(t){e.onError("xhr poll error",t)}),this.pollXhr=t},u(o.prototype),o.prototype.create=function(){var t=this.xhr=a.request(this.xd),e=this;if(t.open(this.method,this.uri,this.async),"POST"==this.method)try{t.setRequestHeader?t.setRequestHeader("Content-type","text/plain;charset=UTF-8"):t.contentType="text/plain"}catch(n){}this.xd&&c.XDomainRequest&&t instanceof XDomainRequest?(t.onerror=function(t){e.onError(t)},t.onload=function(){e.onData(t.responseText)},t.onprogress=r):("withCredentials"in t&&(t.withCredentials=!0),t.onreadystatechange=function(){var n;try{if(4!=t.readyState)return;200==t.status||1223==t.status?n=t.responseText:e.onError(t.status)}catch(r){e.onError(r)}void 0!==n&&e.onData(n)}),l("sending xhr with url %s | data %s",this.uri,this.data);try{t.send(this.data)}catch(n){return setTimeout(function(){e.onError(n)},0),void 0}f&&(this.index=o.requestsCount++,o.requests[this.index]=this)},o.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},o.prototype.onData=function(t){this.emit("data",t),this.onSuccess()},o.prototype.onError=function(t){this.emit("error",t),this.cleanup()},o.prototype.cleanup=function(){if("undefined"!=typeof this.xhr){this.xhr.onreadystatechange=r,this.xhr.onload=this.xhr.onerror=r;try{this.xhr.abort()}catch(t){}f&&delete o.requests[this.index],this.xhr=null}},o.prototype.abort=function(){this.cleanup()},f&&(o.requestsCount=0,o.requests={},c.attachEvent("onunload",function(){for(var t in o.requests)o.requests.hasOwnProperty(t)&&o.requests[t].abort()}))}),t.register("engine.io/lib/transports/polling-jsonp.js",function(t,e,n){function r(t){i.call(this,t),s||(a.___eio||(a.___eio=[]),s=a.___eio),this.index=s.length;var e=this;s.push(function(t){e.onData(t)}),this.query.j=this.index}var i=e("./polling"),o=e("../util");n.exports=r;var s,a=o.global(),u=/\n/g;o.inherits(r,i),r.prototype.doOpen=function(){var t=this;o.defer(function(){i.prototype.doOpen.call(t)})},r.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null),i.prototype.doClose.call(this)},r.prototype.doPoll=function(){var t=this,e=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),e.async=!0,e.src=this.uri(),e.onerror=function(e){t.onError("jsonp poll error",e)};var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n),this.script=e,o.ua.gecko&&setTimeout(function(){var t=document.createElement("iframe");document.body.appendChild(t),document.body.removeChild(t)},100)},r.prototype.doWrite=function(t,e){function n(){r(),e()}function r(){if(i.iframe)try{i.form.removeChild(i.iframe)}catch(t){i.onError("jsonp polling iframe removal error",t)}try{var e='<iframe src="javascript:0" name="'+i.iframeId+'">';o=document.createElement(e)}catch(t){o=document.createElement("iframe"),o.name=i.iframeId,o.src="javascript:0"}o.id=i.iframeId,i.form.appendChild(o),i.iframe=o}var i=this;if(!this.form){var o,s=document.createElement("form"),a=document.createElement("textarea"),l=this.iframeId="eio_iframe_"+this.index;s.className="socketio",s.style.position="absolute",s.style.top="-1000px",s.style.left="-1000px",s.target=l,s.method="POST",s.setAttribute("accept-charset","utf-8"),a.name="d",s.appendChild(a),document.body.appendChild(s),this.form=s,this.area=a}this.form.action=this.uri(),r(),this.area.value=t.replace(u,"\\n");try{this.form.submit()}catch(c){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"==i.iframe.readyState&&n()}:this.iframe.onload=n}}),t.register("engine.io/lib/transports/websocket.js",function(t,e,n){function r(t){o.call(this,t)}function i(){return"undefined"==typeof window?e("ws"):u.WebSocket||u.MozWebSocket}var o=e("../transport"),s=e("engine.io-parser"),a=e("../util");e("debug")("engine.io-client:websocket"),n.exports=r;var u=a.global();a.inherits(r,o),r.prototype.name="websocket",r.prototype.doOpen=function(){if(this.check()){var t=this;this.socket=new(i())(this.uri()),this.socket.onopen=function(){t.onOpen()},this.socket.onclose=function(){t.onClose()},this.socket.onmessage=function(e){t.onData(e.data)},this.socket.onerror=function(e){t.onError("websocket error",e)}}},r.prototype.write=function(t){function e(){n.writable=!0,n.emit("drain")}var n=this;this.writable=!1;for(var r=0,i=t.length;i>r;r++)this.socket.send(s.encodePacket(t[r]));"bufferedAmount"in this.socket?this.bufferedAmountId=setInterval(function(){0==n.socket.bufferedAmount&&(clearInterval(n.bufferedAmountId),e())},50):setTimeout(e,0)},r.prototype.onClose=function(){clearInterval(this.bufferedAmountId),o.prototype.onClose.call(this)},r.prototype.doClose=function(){"undefined"!=typeof this.socket&&this.socket.close()},r.prototype.uri=function(){var t=this.query||{},e=this.secure?"wss":"ws",n="";return this.port&&("wss"==e&&443!=this.port||"ws"==e&&80!=this.port)&&(n=":"+this.port),this.timestampRequests&&(t[this.timestampParam]=+new Date),t=a.qs(t),t.length&&(t="?"+t),e+"://"+this.hostname+n+this.path+t},r.prototype.check=function(){var t=i();return!(!t||"__initialize"in t&&this.name===r.prototype.name)}}),t.register("engine.io/lib/transports/flashsocket.js",function(t,e,n){function r(t){s.call(this,t),this.flashPath=t.flashPath,this.policyPort=t.policyPort}function i(t,e){if(f[t])return e();var n=document.createElement("script"),r=!1;u('loading "%s"',t),n.onload=n.onreadystatechange=function(){if(!r&&!f[t]){var i=n.readyState;i&&"loaded"!=i&&"complete"!=i||(u('loaded "%s"',t),n.onload=n.onreadystatechange=null,r=!0,f[t]=!0,e())}},n.async=1,n.src=t;var i=document.getElementsByTagName("head")[0];i.insertBefore(n,i.firstChild)}function o(t,e){function n(r){return t[r]?(i(t[r],function(){n(++r)}),void 0):e()}n(0)}var s=e("./websocket"),a=e("../util"),u=e("debug")("engine.io-client:flashsocket");n.exports=r;var l=a.global(),c=l[["Active"].concat("Object").join("X")];a.inherits(r,s),r.prototype.name="flashsocket",r.prototype.doOpen=function(){function t(t){return function(){var e=Array.prototype.join.call(arguments," ");u("[websocketjs %s] %s",t,e)}}if(this.check()){WEB_SOCKET_LOGGER={log:t("debug"),error:t("error")},WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR=!0,WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=!0,"undefined"==typeof WEB_SOCKET_SWF_LOCATION&&(WEB_SOCKET_SWF_LOCATION=this.flashPath+"WebSocketMainInsecure.swf");var e=[this.flashPath+"web_socket.js"];"undefined"==typeof swfobject&&e.unshift(this.flashPath+"swfobject.js");var n=this;o(e,function(){n.ready(function(){WebSocket.__addTask(function(){s.prototype.doOpen.call(n)})})})}},r.prototype.doClose=function(){if(this.socket){var t=this;WebSocket.__addTask(function(){s.prototype.doClose.call(t)})}},r.prototype.write=function(){var t=this,e=arguments;WebSocket.__addTask(function(){s.prototype.write.apply(t,e)})},r.prototype.ready=function(t){function e(){r.loaded||(843!=n.policyPort&&WebSocket.loadFlashPolicyFile("xmlsocket://"+n.host+":"+n.policyPort),WebSocket.__initialize(),r.loaded=!0),t.call(n)}if("undefined"!=typeof WebSocket&&"__initialize"in WebSocket&&swfobject&&!(swfobject.getFlashPlayerVersion().major<10)){var n=this;return document.body?e():(a.load(e),void 0)}},r.prototype.check=function(){if("undefined"==typeof window)return!1;if("undefined"!=typeof WebSocket&&!("__initialize"in WebSocket))return!1;if(c){var t=null;try{t=new c("ShockwaveFlash.ShockwaveFlash")}catch(e){}if(t)return!0}else for(var n=0,r=navigator.plugins.length;r>n;n++)for(var i=0,o=navigator.plugins[n].length;o>i;i++)if("Shockwave Flash"==navigator.plugins[n][i].description)return!0;return!1};var f={}}),t.alias("component-emitter/index.js","engine.io/deps/emitter/index.js"),t.alias("component-emitter/index.js","emitter/index.js"),t.alias("component-indexof/index.js","engine.io/deps/indexof/index.js"),t.alias("component-indexof/index.js","indexof/index.js"),t.alias("LearnBoost-engine.io-protocol/lib/index.js","engine.io/deps/engine.io-parser/lib/index.js"),t.alias("LearnBoost-engine.io-protocol/lib/keys.js","engine.io/deps/engine.io-parser/lib/keys.js"),t.alias("LearnBoost-engine.io-protocol/lib/index.js","engine.io/deps/engine.io-parser/index.js"),t.alias("LearnBoost-engine.io-protocol/lib/index.js","engine.io-parser/index.js"),t.alias("LearnBoost-engine.io-protocol/lib/index.js","LearnBoost-engine.io-protocol/index.js"),t.alias("visionmedia-debug/index.js","engine.io/deps/debug/index.js"),t.alias("visionmedia-debug/debug.js","engine.io/deps/debug/debug.js"),t.alias("visionmedia-debug/index.js","debug/index.js"),t.alias("engine.io/lib/index.js","engine.io/index.js"),"object"==typeof exports)module.exports=t("engine.io");else if("function"==typeof define&&define.amd){var e=function(){return t("engine.io")};define("eio",e)}else this.eio=t("engine.io")}(),define("util/backoff",["eventemitter2","lodash"],function(t,e){function n(e){this._failAfter=e&&e.failAfter||10,this._startDelay=e&&e.startDelay||100,this._maxDelay=e&&e.maxDelay||1e4,this._fibo1=1,this._fibo2=1,this._currentAttempt=1,this._timeOut=null,this._lastDelay=this._startDelay,this._emitter=new t}function r(t){if(!e.contains(i,t))throw new Error("Unknown event type: "+t)}var i=["start","finish","fail"];return n.prototype.on=function(t,e){r(t),this._emitter.on(t,e)},n.prototype.off=function(t,e){r(t),this._emitter.off(t,e)},n.prototype.start=function(){if(this._currentAttempt>=this._failAfter)return this.reset(),this._emitter.emit("fail"),void 0;var t=this._fibonacci(),n=this._currentAttempt;this._currentAttempt++;var r=Math.min(this._startDelay*t,this._maxDelay);this._lastDelay=r,this._emitter.emit("start",n,r,this),this._timeOut=setTimeout(e.bind(function(){this._emitter.emit("finish",n,r,this)},this),r)},n.prototype.reset=function(){this._currentAttempt=1,this._fibo1=1,this._fibo2=1,this._timeOut&&(clearTimeout(this._timeOut),this._timeOut=null)},n.prototype._fibonacci=function(){if(this._currentAttempt<3)return 1;var t=this._fibo1+this._fibo2;return this._fibo1=this._fibo2,this._fibo2=t,t},n}),define("util/logging",["lodash"],function(t){function e(e){this.moduleName=e,t.bind(this.log,this),t.each(o,function(e){var n=r[e];this[e]=t.bind(this.log,this,n)},this)}var n={},r={silly:0,debug:1,verbose:2,info:3,warn:4,error:5},i=t.invert(r),o=t.keys(r);return n.loggers={},n.raw=function(){},n.Logger=e,e.prototype.log=function(e){var r=Array.prototype.slice.call(arguments,1),o=r[r.length-1],s=t.isFunction(o)?r.pop():null;o=r[r.length-1];var a=t.isObject(o)&&!t.isArray(o)?r.pop():{},u=r.shift();n.raw(i[e]+": "+this.moduleName+": "+u,r,a),s&&s()},n.logger=function(t){return n.loggers[t]||(n.loggers[t]=new e(t)),n.loggers[t]},n.get=n.logger,n}),define("global/navigator",["global/window"],function(t){return t.navigator}),"undefined"==typeof define&&module&&module.exports)var define=require("../lib/common_loader")(module);
if(define("common/inherits",[],function(){return"function"==typeof Object.create?function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}}),"undefined"==typeof define&&module&&module.exports)var define=require("../lib/common_loader")(module);if(define("common/errorgen",["lodash","common/inherits"],function(_,inherits){function detectStacktrace(){try{throw new Error("probing")}catch(t){var e=t.stack;if(!e)return!1;try{e=e.substring(1)}catch(n){return!1}}return!0}function detectStackHasMessage(){try{throw new Error("probing")}catch(t){var e=t.stack;return/^Error: probing\n/.test(e)?!0:!1}}function detectMutableStacktrace(){function t(t){this.message=t;var e=(new Error).stack;this.stack=e.substring(1)}inherits(t,Error);try{throw new t("probing")}catch(e){return e.stacktrace?!1:e instanceof t&&"probing"===e.message?!0:!1}}function detectNeedToString(){function t(t){this.message=t,this.name="Tmp"}inherits(t,Error);var e;try{throw new Error("probing")}catch(n){e=n.toString().replace(/^Error/,"Tmp")}try{throw new t("probing")}catch(n){try{var r=n.toString();return r!==e}catch(i){return!0}}}function GoInstantError(){throw new Error("GoInstantError is an abstract base-class")}function generateClass(name){var curClass;return eval(TEMPLATE.replace(/X/g,name)+"\ncurClass = "+name+";"),inherits(curClass,GoInstantError),canCaptureStacktrace&&(curClass.prototype.name=name),needsToString&&(curClass.prototype.toString=function(){return this.name+": "+this.message}),inWindow||(curClass.prototype.inspect=function(){return"["+this.toString()+"]"}),curClass}function errorgen(t){_.isString(t)&&(t=[t]);var e={};return _.each(t,function(t){e[t]=generateClass(t)}),e}var inWindow=!1;try{inWindow=!!window}catch(e){}var canCaptureStacktrace=!!Error.captureStackTrace,hasStacktrace=canCaptureStacktrace||detectStacktrace(),stackHasMessage=hasStacktrace&&detectStackHasMessage(),hasMutableStacktrace=canCaptureStacktrace||detectMutableStacktrace(),needsToString=detectNeedToString(),scrubStack=function(){};scrubStack=stackHasMessage?function(t){return t.replace(/\n[^\n]+\n/,"\n")}:function(t){return t.substr(t.indexOf("\n")+1)},inherits(GoInstantError,Error);var TEMPLATE="";return TEMPLATE+="function X(message) {\n",TEMPLATE+="  \n",TEMPLATE+="  this.message = message;\n",canCaptureStacktrace||(TEMPLATE+="  this.name = 'X';\n"),hasStacktrace&&(canCaptureStacktrace?TEMPLATE+="  Error.captureStackTrace(this, this.name);\n":hasMutableStacktrace&&(TEMPLATE+="  var s = '' + new Error().stack;\n",TEMPLATE+="  this.stack = scrubStack(s);\n")),TEMPLATE+="}\n",errorgen.hasStacktrace=hasStacktrace,errorgen.GoInstantError=GoInstantError,errorgen}),"undefined"==typeof define&&module&&module.exports)var define=require("../lib/common_loader")(module);if(define("common/errors",["lodash","common/errorgen"],function(t,e){var n={CollisionError:100,RoomSessionStateError:200,RoomSizeError:201,ConnectionError:202,AuthenticationError:203,PermissionError:204,NotMemberError:205,NotConnectedError:206,NoUserError:207,SynchronizationError:208,KeyNameError:300,InvalidRequestError:302,ArgumentError:303,NonLeafKeyError:304,DuplicateCallError:305,CouldNotCompleteError:306,NotInitializedError:307,RoomOvergrownError:400},r=t.invert(n),i=e(t.keys(n));return t.each(n,function(t,e){i[e].prototype.code=t}),i.GoInstantError=e.GoInstantError,i.build=function(t,e){var n;n="number"==typeof e?e:e&&e.meta?e.meta.code:0;var o=r[n],s=i[o]||Error;return new s(t)},i}),define("platform/socket",["eio","lodash","eventutil","eventemitter2","util/backoff","util/logging","global/navigator","global/window","common/errors"],function(t,e,n,r,i,o,s,a,u){function l(t,n,o,a,l){if(this.connectUrl=t,!e.isString(this.connectUrl))throw new u.ArgumentError("connectUrl must be a string");if(this.account=n,!e.isString(this.account))throw new u.ArgumentError("account must be a string");if(this.app=o,!e.isString(this.app))throw new u.ArgumentError("app must be a string");if(!e.isString(a)&&!e.isPlainObject(a)&&null!==a)throw new u.ArgumentError("user must be a jwt or a default guest object");if(this.token=null,this._guestDefaults=null,e.isPlainObject(a)){try{JSON.stringify(a)}catch(c){throw new u.ArgumentError("user defaults are not serializable")}this._guestDefaults=a}else this.token=a;this._saveGuestId=!0,this.guestId=null,e.has(l,"guestId")&&(this._saveGuestId=!1,this.guestId=l.guestId),this._state=d,this.onlyPolling=e.some(h,function(t){return s.userAgent.indexOf(t)>-1}),this._sendAuth=null,this.storageVersion=1;var f=e.defaults({},l,p);this._backoff=new i(f),this._cleanupBackoff=function(){},this._cleanupListeners=function(){},this._emitter=new r}var c=0,f=700,h=["iPhone","Android","iPad"],p={startDelay:100,maxDelay:3e3,failAfter:20},d="disconnected",m="connecting",g="handshaking",v="connected",y="reconnecting",_="rehandshaking",b="disconnecting",w=0,E=1,k=2,x=3,A=4,O=5,S={};S[d]=[m],S[m]=[g,b,d],S[g]=[v,m,b],S[v]=[b,y],S[y]=[_,b,d],S[_]=[v,y,b],S[b]=[d];var I=o.get("platform/socket");return l.prototype._transition=function(t){var n=S[this._state],r={prev:this._state,next:t};if(!e.contains(n,t))throw I.error("Invalid socket state transition",r),new Error('Cannot transition socket from "'+this._state+'" '+'to "'+t+'"!');I.debug("Socket state transition",r),this._state=t},l._makeSocket=function(e,n){return t.Socket(e,n)},l.prototype.send=function(t){if(this._state===d)throw new u.ConnectionError("Socket is not connected (send)");var e;try{e=JSON.stringify(t)}catch(n){throw new u.ArgumentError("JSON Stringify Error: "+n.message)}this.eiSocket.send(e)},l.prototype.on=function(t,e){this._emitter.on(t,e)},l.prototype.off=function(t,e){this._emitter.off(t,e)},l.prototype.close=function(){function t(t){r._transition(d),r._emitter.emit("error",t)}function e(){r._transition(d),r._emitter.emit("disconnect")}this._transition(b),this._cleanup();var r=this;n.register(this.eiSocket,"!error",t,this.eiSocket,"!close",e),this.eiSocket.close(),this.eiSocket=null},l.prototype._getSocketOptions=function(){return{transports:this.onlyPolling?["polling"]:["polling","websocket"],query:{},path:"/"+encodeURIComponent(this.account)+"/"+encodeURIComponent(this.app)}},l.prototype.connect=function(t){this._transition(m);var r=this._getSocketOptions();if(this._cleanupBackoff=n.register(this._backoff,"fail",e.bind(this._onRetryConnectFail,this),this._backoff,"finish",e.bind(this._retryConnect,this)),n.register(this._emitter,"!connect",e.bind(t,this,null),this._emitter,"!error",e.bind(t,this)),this.token)this.token.length>f?this._sendAuth=JSON.stringify(["AUTH",this.token]):r.query.jwt=this.token;else if(this._guestDefaults)try{this._sendAuth=JSON.stringify(["AUTH","GUEST",this._guestDefaults])}catch(i){return this._socketError("Guest defaults cannot be serialized")}else r.query.guest=1;var o=this._getGuestId();o&&(r.query.gid=o),r.query.c=c++ +"-"+Math.floor(1e4*Math.random());try{this.eiSocket=l._makeSocket(this.connectUrl,r)}catch(i){return this._socketError("initiation failed")}this._backoff.reset(),this._cleanupListeners=n.register(this.eiSocket,"!error",e.bind(this._backoff.start,this._backoff),this.eiSocket,"!open",e.bind(this._handshaking,this))},l.prototype._getGuestId=function(){var t=this.guestId;if(this._saveGuestId)try{t=a.localStorage.getItem("giGuestId")}catch(e){}return t},l.prototype._setGuestId=function(t){if(this._saveGuestId)try{a.localStorage.setItem("giGuestId",t)}catch(e){}this.guestId=t,this.eiSocket.query.gid=t},l.prototype._setStorageProtocol=function(t){1!==t&&I.warn("Storage Protocol Version is unstable"),this.storageVersion=t,this.eiSocket.query.storageProtocolVersion=t},l.prototype._onConnectMessage=function(t){var e;try{e=JSON.parse(t)}catch(n){return this._socketError("malformed message")}var r=e[w];if("ERROR"===r){var i=u.build(e[E],0+e[k]);return this._socketError(i)}if("USER"===r){var o=e[E];e.length===O&&(this._setStorageProtocol(e[A]),this._setGuestId(e[x])),e.length===O-1&&this._setStorageProtocol(e[A-1]),this._connected(o)}},l.prototype._socketError=function(t){var e="Could not connect: ";(this._state===y||this._state===_)&&(e="Could not reconnect: "),this._state===g||this._state===_?this.close():this._transition(d),t instanceof Error?t.message=e+t.message:t=e+t,I.error("Socket error",{err:t}),this._emitter.emit("error",t)},l.prototype._setupHandshake=function(t,r){function i(){o._transition(r),o._backoff.start()}this._transition(t),null!==this._sendAuth&&(I.debug("sending auth token message"),this.eiSocket.send(this._sendAuth));var o=this;this._cleanupListeners=n.register(this.eiSocket,"!close",i,this.eiSocket,"message",e.bind(this._onConnectMessage,this))},l.prototype._handshaking=function(){this._setupHandshake(g,m)},l.prototype._rehandshaking=function(){this._setupHandshake(_,y)},l.prototype._connected=function(t){function r(){i._transition(y),i._backoff.start(),i._emitter.emit("disconnect")}this._transition(v),this._backoff.reset();var i=this;this._cleanupListeners(),this._cleanupListeners=n.register(this.eiSocket,"!close",r,this.eiSocket,"message",e.bind(this._emitter.emit,this._emitter,"message")),this._emitter.emit("connect",t)},l.prototype._cleanup=function(){this._backoff.reset(),this._cleanupBackoff(),this._cleanupListeners()},l.prototype._onRetryConnectFail=function(){this._cleanup(),this._socketError("Maximum number of reconnect attempts reached.")},l.prototype._retryConnect=function(){var t;if(this._state===m)t=this._handshaking;else{if(this._state!==y)return this._socketError("Invalid state seen during retry");t=this._rehandshaking}this._cleanupListeners=n.register(this.eiSocket,"!error",e.bind(this._backoff.start,this._backoff),this.eiSocket,"!open",e.bind(t,this)),this.eiSocket.open()},l}),define("util/validation",["lodash"],function(t){var e={};return e.optionalCallback=function(e){return t.isUndefined(e)||t.isNull(e)||t.isFunction(e)},e.requiredCallback=function(e){return!(!e||!t.isFunction(e))},e.contained=function(e,n){return t.contains(e,n)},e.subset=function(e,n){var r=t.difference(e,n);return 0===r.length},e.isFunction=function(e){return t.isFunction(e)},e.throwOrCallback=function(e,n){if(!t.isFunction(n))throw e;n(e)},e}),"undefined"==typeof define&&module&&module.exports)var define=require("../lib/common_loader")(module);if(define("common/constants",[],function(){var t={};t.SLASH_SPACE_TRIMMER=/^[\/\s]+|[\/\s]+$/g;var e="a-zA-Z0-9%",n=e+".",r=e+".@_:-",i="["+n+"]["+r+"]{0,127}",o="["+e+"]["+r+"]{0,127}";t.NAME_REGEX_BODY=o;var s="["+r+"]{1,128}";t.INTERNAL_NAME_REGEX_BODY=s,t.NAME_REGEX=new RegExp("^"+o+"$"),t.INTERNAL_NAME_REGEX=new RegExp("^"+s+"$"),t.KEY_REGEX="(?:(?:/)?"+i+"(?:/|)?)*",t.NAME_RULES_ENGLISH=" names are case sensitive, must be alphanumeric (1-128 chars), and can include non-leading -, _, ., @, and :",t.PROVIDER_NAME_REGEX=/^(?!session$)[a-z0-9_]+$/;var a="(?:25[0-5]|2[0-4][0-9]|[0-1]?[0-9]{1,2})",u=a+"\\."+a+"\\."+a+"\\."+a,l="\\[[A-F0-9:]+(?::"+u+")?"+"\\]",c="[a-z0-9][a-z0-9\\-]+",f="(?:"+c+"\\.)*"+"(?:"+c+")",h="(?:[1-9]|[1-9][0-9]{1,3}|[1-5][0-9]{1,4}|6(?:[0-4][0-9]{3}|5[0-4][0-9]{2}|55[0-2][0-9]|553[0-5]))",p="(?:"+f+"|"+u+"|"+l+")"+"(?::"+h+")?";return t.ORIGIN_REGEX=new RegExp("^https?://"+p+"$","i"),t.HOST_OR_IP_AND_PORT_REGEX=new RegExp("^"+p+"$","i"),t}),"undefined"==typeof define&&module&&module.exports)var define=require("../lib/common_loader")(module);if(define("common/key_name",["lodash","common/constants"],function(t,e){var n={},r=e.SLASH_SPACE_TRIMMER;return n.clean=function(e){if("/"===e)return"/";if(!t.isString(e))return null;if(e="/"+e.replace(r,""),1===e.length)return null;var i=n.validate(e);return i?e:null},n.validate=function(n){if(!t.isString(n)||n.length<1||"/"!==n[0])return!1;if("/"===n)return!0;var r=n.split("/");r.shift(),".users"===r[0]&&(r.shift(),r.length>0&&e.INTERNAL_NAME_REGEX.test(r[0])&&r.shift());var i=t.every(r,function(t){return e.NAME_REGEX.test(t)});return i},n}),define("platform/channel",["eventemitter2","lodash","util/validation","common/key_name","util/resolver"],function(t,e,n,r,i){function Channel(e,n){if(this._room=e,this.name=r.clean(n),null===this.name)throw new Error("Invalid channel name: "+n);this._emitter=new t}return Channel.COMMANDS={message:"MESSAGE"},Channel.DEFAULT_COMMAND_OPTIONS={local:!0},Channel._Resolver=i,Channel.VALID_EVENTS=e.keys(Channel.COMMANDS),Channel.prototype.room=function(){return this._room},Channel.prototype._resolveOptionsAndCallback=function(t,n){return e.isPlainObject(t)?t=e.defaults(t,Channel.DEFAULT_COMMAND_OPTIONS):(n=n||t,t=Channel.DEFAULT_COMMAND_OPTIONS),{options:t,cb:n}},Channel.prototype.on=function(t,e,n){this._room._on(this.name,Channel.VALID_EVENTS,t,e,n)},Channel.prototype.off=function(t,e){var n={local:!1,bubble:!1};this._room._off(this.name,Channel.VALID_EVENTS,t,n,e)},Channel.prototype.message=function(t,r,i){var o;e.isUndefined(t)&&(o=new Error("Message cannot be undefined"));var s=this._resolveOptionsAndCallback(r,i);if(n.optionalCallback(s.cb)||(o=new Error("Callback should be a function or undefined")),o)return n.throwOrCallback(o,s.cb);var a=new Channel._Resolver(s.cb,this,["value","context"]),u=s.options;i=a.cb;var l={key:this.name,value:t,options:u};return this._room._request(Channel.COMMANDS.message,l,i),a.promise},Channel.prototype.equals=function(t){return t instanceof this.constructor?this.name!==t.name?!1:this._room.equals(t._room)?!0:!1:!1},Channel}),define("util/deprecate",["global/window"],function(t){function e(e){if(t.console){var n="Usage of deprecated GoInstant feature: "+e.name;e.date&&(n+="\nThis feature will be removed on: "+e.date.toDateString()),e.url&&(n+="\nLearn more at: "+e.url),t.console.warn(n)}}return{warn:e}}),define("platform/watch_registry",["lodash"],function(t){function e(){this._listeners=[]}return e.prototype.add=function(t){var e=this._wrap(t);return this._listeners.push(e),e},e.prototype.remove=function(t){var e=this._indexOf(t),n=null;return e>=0&&(n=this._listeners[e],this._listeners.splice(e,1)),n},e.prototype.clear=function(){var t=this._listeners;return this._listeners=[],t},e.prototype._indexOf=function(e){return t.findIndex(this._listeners,{__wrapped:e})},e.prototype._wrap=function(t){var e=function(){var t=Array.prototype.slice.call(arguments);e.__wrapped.apply(this,t)};return e.__wrapped=t,e},e}),define("util/inherits",[],function(){function t(t,n){t.super_=n,t.prototype=e(n.prototype)}function e(t){function e(){}if(arguments.length>1)throw new Error("Object.create implementation only accepts the first parameter");return e.prototype=t,new e}return t}),define("util/state_machine",["lodash"],function(t){function e(e,n){if(!t.isString(e))throw new Error("The start state must be a string");if(!t.isObject(n))throw new Error("Must provide a fsm definition");if(t.size(n)<2)throw new Error("There must be two or more states");if(!n[e])throw new Error("Start state does not exist");var r=t.keys(n),i={};t.each(r,function(t){i[t]=t}),t.each(n,function(e){t.each(e,function(e){if(!t.contains(r,e))throw new Error("Unknown state: "+e)})}),this.states=i,this._fsm=n,this.current=e}return e.prototype.transition=function(e){if(!t.isString(e))throw new Error("State must be a string");if(!this._fsm[e])throw new Error("Invalid state provided: "+e);if(!t.contains(this._fsm[this.current],e))throw new Error("Cannot transition from "+this.current+" to "+e);this.current=e},e}),"undefined"==typeof define&&module&&module.exports)var define=require("../lib/common_loader")(module);if(define("common/obj",["lodash","common/errors"],function(t,e){function n(e,n){var r=e.node;if(!t.isUndefined(r[n])){if(t.keys(r).length>1&&!t.isPlainObject(r[n]))throw new Error("Impossible to infer type, conflict at node");if(!t.isPlainObject(r[n]))return e.node=r[n],null!==e.parent&&(e.parent.node[e.name]=r[n]),void 0;t.merge(r,r[n]),delete r[n]}}function r(e,n){if(!t.isPlainObject(e))throw new Error("first argument must be an object");if(!t.isString(n)&&!t.isArray(n))throw new Error("undecorate only supports strings and arrays to describe removals")}function i(t,e,n){this.name=t,this.node=e,this.parent=n}var o={};return o.compose=function(t,e){var n=[];return o.iterate(e,function(){if(this.isLeaf()){for(var e=[],r=this,i=r.node;r.parent;)e.unshift(r.name),r=r.parent;e.unshift(t),n.push(e.join("/")),n.push(i)}}),n},o.pick=function(e,n,r){r=r||"/";var i=n.split(r),o=e;if(i=t.filter(i,function(t){return""!==t}),(null===o||void 0===o)&&i.length>=0)return void 0;for(var s=0;s<i.length;++s){if(o=o[i[s]],null===o&&s+1<i.length)return void 0;if(void 0===o)return void 0}return o},o.rZip=function(e,n,r,i){var o=n.split("/");o=t.filter(o,function(t){return""!==t});var s=e||{},a=!1;return t.each(o,function(e,n){if(a||t.isPlainObject(s[e])||(s[e]={}),n>=o.length-1&&(a&&"cascade"==e?(t.isArray(s[e])||(s[e]=[]),s[e].push(r)):s[e]=r),i){var u=o[n-1];i(s,u)}s=s[e],".meta"==e&&(a=!0)}),e},o.remove=function(n,r,i,o){if(!t.isObject(n))throw new Error("Provided blob is not an object");i&&i.clone&&(n=t.cloneDeep(n));var s=r.split("/");s=t.filter(s,function(t){return""!==t});var a,u=!0,l=n,c=[n],f=s.length-1;for(a=0;f>a;a++){if(l=l[s[a]],void 0===l){if(i&&t.has(i,"throws")&&!i.throws){u=!1;break}throw new e.KeyNameError("Path does not exist in object")}c.push(l)}if(u){var h=l[s[f]];if(h&&i.ignore&&h[i.ignore])for(var p=t.keys(h),d=0;d<p.length;++d)p[d]!=i.ignore&&delete h[p[d]];else delete l[s[f]]}for(var m,g=a;g>=0;g--)m=s[g],0===t.size(c[g][m])&&delete c[g][m],o&&o(c[g]);return n},o.decorate=function(e,n,r){return o.iterate(e,function(){if(!this.isHead()){for(var e=this,i=!1;e;){if(r&&e.name==r){i=!0;break}e=e.parent}if(!(i||r&&this.name==r)){if(this.isLeaf()){var o=this.parent.node[this.name];return this.parent.node[this.name]={},this.parent.node[this.name][n]=o,void 0}var s={};s[n]=t.cloneDeep(this.node);var a=this;t.each(a.node,function(t,e){e!==n&&delete a.node[e]}),t.merge(this.node,s)}}}),e},o.undecorate=function(e,i,s){r(e,i),s&&(e=t.cloneDeep(e)),t.isString(i)&&(i=[i]);var a=[],u=[];t.each(i,function(t){return"!"===t[0]?a.push(t.substring(1,t.length)):u.push(t)});var l=o.iterate(e,function(){var e=this;t.each(u,function(n){t.isNull(e.node[n]&&!t.isUndefined(e.node[n]))||delete e.node[n]}),t.each(a,function(t){n(e,t)})});return l.node},o.iterate=function(e,n){var r,o=[e],s=[],a=o.shift();r=new i(null,a,null);for(var u=r;r;){s.unshift(r);for(var l=t.keys(r.node),c=0;c<l.length;++c){var f=new i(l[c],r.node[l[c]],r);o.push(f)}r=o.shift()}return t.each(s,function(e){t.bind(n,e)()}),u},i.prototype.isLeaf=function(){var e=t.isPlainObject(this.node),n=e&&0===t.size(this.node);return n?!0:!e},i.prototype.isHead=function(){return null===this.parent},o}),define("expression/filter",["lodash","common/obj","common/errors"],function(t,e,n){function r(e){if(!t.isPlainObject(e))throw new n.ArgumentError("Must provide an object for expression");this._expr=e,this.filter([{name:"test",value:"empty"}],!0)}var i={object:t.isPlainObject,array:t.isArray,integer:function(e){return t.isNumber(e)&&0===e%1},"float":function(e){return t.isNumber(e)&&0!==e%1},string:t.isString,"boolean":t.isBoolean,"null":t.isNull};return r.prototype.filter=function(r,o){function s(e,r,i,s){if(o&&!t.isPlainObject(e))throw new n.ArgumentError("Expected an object at path: "+s);var l=t.keys(e);if(0===l.length)return!0;var c=a(e);if(c)return u(e[c],r,i,s+"/"+c,c);for(var f,h,p,d=0;d<l.length;++d)if(f=l[d],h=s+"/"+f,p=i+"/"+f,"$"!==f[0]){if(t.isPlainObject(e[f])&&(c=a(e[f]))){if(u(e[f][c],r,p,h,c))continue;return!1}if(!u(e[f],r,p,h,"$eq"))return!1}else if(!u(e[f],r,i,h,f))return!1;return!0}function a(e){if(!t.isPlainObject(e))return!1;var n=t.keys(e);return 1===n.length&&"$"===n[0][0]?n[0]:!1}function u(r,s,a,u,p){p||(p="$eq");var d=e.pick(s,a);switch(p=p.toLowerCase()){case"$type":if(o&&!i[r])throw new n.ArgumentError("$type value given is not valid at "+u);return i[r](d);case"$exists":return void 0!==d===r;case"$all":if(o&&!t.isArray(r))throw new n.ArgumentError("$all requires an array at "+u);return t.isEqual(d,r);case"$eq":return t.isEqual(d,r);case"$ne":return t.isArray(r)?!t.isEqual(d,r):d!==r;case"$in":if(o&&!t.isArray(r))throw new n.ArgumentError("$in operators require their value to be an array at "+u);return t.contains(r,d);case"$nin":if(o&&!t.isArray(r))throw new n.ArgumentError("$nin operators require their value to be an array at "+u);return!t.contains(r,d);case"$size":return t.isArray(d)?d.length===r:!1;case"$gt":if(o&&t.isObject(r))throw new n.ArgumentError("$gt operator must be a primitive value at "+u);return d>r;case"$lt":if(o&&t.isObject(r))throw new n.ArgumentError("$lt operator must be a primitive value at "+u);return r>d;case"$lte":if(o&&t.isObject(r))throw new n.ArgumentError("$lte operator must be a primitive value at "+u);return r>=d;case"$gte":if(o&&t.isObject(r))throw new n.ArgumentError("$gte operator must be a primitive value at "+u);return d>=r;case"$or":return h(r,s,a,u);case"$and":return f(r,s,a,u);case"$nor":return!h(r,s,a,u);case"$nand":return!f(r,s,a,u);case"$value":return c(r,s,a,u);case"$name":return l(r,s,a,u);default:throw new n.ArgumentError("Unknown operator["+p+"] at "+u)}}function l(n,r,i,o){var u=t.keys(e.pick(r,i));return a(n)||(n={$eq:n}),t.any(u,function(t,e){return s(n,u,"/"+e,o)})}function c(e,r,i,o){if(/\/\$value$/.test(o)){var u=t.values(r);if(1!==u.length)throw new n.ArgumentError("$value should only have a single value associated "+u);r=t.values(r)[0]}return a(e)||(e={$eq:e}),s(e,r,i,o)}function f(e,r,i,a){if(o&&!t.isArray(e))throw new n.ArgumentError("$and operator requires value to be an array at "+a);for(var u,l,c=0;c<e.length;++c){if(u=e[c],l=a+"/"+c,o&&!t.isPlainObject(u))throw new n.ArgumentError("$and operator members must be objects at "+a);if(!s(u,r,i,l))return!1}return!0}function h(e,r,i,a){if(o&&!t.isArray(e))throw new n.ArgumentError("$or operator requires value to be an array at "+a);for(var u,l,c=0;c<e.length;++c){if(u=e[c],l=a+"/"+c,o&&!t.isPlainObject(u))throw new n.ArgumentError("$or operator members must be objects at "+a);if(s(u,r,i,l))return!0}return!1}if(!t.isArray(r)){if(!t.isPlainObject(r))throw new Error("ResultGenerator expected array passed to filter.");r=[r]}o||(o=!1);var p=this;return t.filter(r,function(e){var n=e.value;return t.isObject(n)||(n={},n[e.name]=e.value),s(p._expr,n,"","")})},r}),define("expression/sort",["lodash","common/obj","common/errors"],function(t,e,n){function r(e){if(t.isUndefined(e))return this._order=[],this._direction=[],void 0;if(!t.isPlainObject(e))throw new n.ArgumentError("Sorting options must be an object: "+e);e=t.cloneDeep(e),t.each(e,function(r,o){if(!t.isNumber(r)||!t.contains([-1,1],r)){if(t.isString(r)&&(r=r.toLowerCase()),!i[r])throw new n.ArgumentError("Invalid sort direction provided for "+o);e[o]=i[r]}}),t.each(e,function(t,n){"$value"===n?e.value=t:"$name"===n?e.name=t:e["value/"+n]=t,delete e[n]}),this._expr=e,this._order=t.keys(this._expr),this._direction=t.values(this._expr)}var i={ascending:1,descending:-1,asc:1,desc:-1};return r.prototype.compare=function(t,n){if(0===this._order.length)return 1;for(var r,i,o=this._order,s=this._direction,a=0;a<o.length;++a)if(r=e.pick(t,o[a]),i=e.pick(n,o[a]),r!==i)return null===r||void 0===r?1:null===i||void 0===i?-1:s[a]*(r>i?1:-1);return 0},r.prototype.sort=function(e){if(!t.isArray(e))throw new Error("An array must be provided to sort.");return 0===this._order.length?e:e.sort(t.bind(this.compare,this))},r.prototype.determinePosition=function(t,e){if(0===this._order.length)return 1/0;for(var n,r=0,i=t.length-1,o=t.length,s=-1,a=0;s!==o-1;)a=Math.floor((r+i)/2),n=this.compare(t[a],e),0>=n?(s=a,r=a+1):(o=a,i=a-1);return o},r}),define("expression/page",["lodash","common/errors"],function(t,e){function n(n){var i,o;if(t.isUndefined(n))return this._start=0,this._size=r,void 0;if(t.isNumber(n)?(i=0,o=n):t.isArray(n)&&(i=n[0],o=n[1]),!t.isNumber(i)||0!==i%1||0>i)throw new e.ArgumentError("Page start must be an integer >= 0.");if(!t.isNumber(o)||0!==o%1||1>o)throw new e.ArgumentError("Page size must be an integer >= 1.");this._start=i,this._size=o}var r=1/0;return n.prototype.paginate=function(n,i,o){if(!t.isArray(n))throw new e.ArgumentError("Pagination results must be an array.");if(!t.isArray(i))throw new e.ArgumentError("Pagination operations must be an array.");if(this._size===r)return i;var s=[];if(0===i.length)return s;var a,u;for(a=0,u=i.length;u>a;a++)i[a].previousPosition=this._pageRelative(i[a].previousPosition),i[a].position=this._pageRelative(i[a].position);for(a=0;a<i.length;++a){var l=i[a];i[a+1]&&i[a].name===i[a+1].name&&"add"===i[a+1].op&&"remove"===i[a].op&&isFinite(i[a+1].position)&&isFinite(i[a].previousPosition)&&(i[a].op="update",i[a].position=i[a+1].position,i[a].value=i[a+1].value,i.splice(a+1,1));var c,f,h,p,d=l.previousPosition===Number.NEGATIVE_INFINITY,m=l.previousPosition===Number.POSITIVE_INFINITY,g=l.position===Number.NEGATIVE_INFINITY,v=l.position===Number.POSITIVE_INFINITY,y=!d&&!m&&null!==l.previousPosition,_=!g&&!v&&null!==l.position;switch(l.op){case"add":if(v)break;if(o&&!_)break;c=this._size-1,f=n[this._start+this._size],f&&!o&&s.push({op:"remove",name:f.name,position:null,previousPosition:c,value:t.cloneDeep(f.value)}),h=_?l.position:0,p=n[h+this._start],p&&s.push({op:"add",name:p.name,position:h,previousPosition:null,value:t.cloneDeep(p.value)});break;case"update":if(o)throw new e.ArgumentError("Initialization should not contain update events.");y&&_&&s.push(l);break;case"remove":if(o)throw new e.ArgumentError("Initialization should not contain remove events.");if(m)break;y?(c=l.previousPosition,f={name:l.name,value:l.value}):(c=0,f=n[c+this._start-1]),f&&s.push({op:"remove",name:f.name,position:null,previousPosition:c,value:t.cloneDeep(f.value)}),h=this._size-1,p=n[this._start+this._size-1],p&&s.push({op:"add",name:p.name,position:h,previousPosition:null,value:t.cloneDeep(p.value)});break;default:throw new e.ArgumentError("Operation op is invalid: "+l.op)}}return s},n.prototype.slice=function(e){if(!t.isArray(e)||0===e.length)return[];var n=this._start,i=this._start+this._size;return this._size===r&&(i=e.length),e.slice(n,i)},n.prototype._pageRelative=function(t){if(null===t||void 0===t)return null;var e=t-this._start;return 0>e?Number.NEGATIVE_INFINITY:e>=this._size?Number.POSITIVE_INFINITY:e},n}),define("expression/index",["lodash","common/errors"],function(t,e){function n(){this._nameMap={},this._posMap={},this._dataMap={},this._size=0}return n.prototype.set=function(n){if(!t.isArray(n))throw new e.ArgumentError("Items must be an array");for(var r=[],i=this._size-1;i>=0;--i)r.unshift(this.remove(this._posMap[i])[0]);this._size=0,this._nameMap={},this._posMap={},this._dataMap={};for(var o,s=0;s<n.length;s++)o=n[s],r.push(this.add(o.name,s,o.value)[0]);return this._size=n.length,r},n.prototype.add=function(n,r,i){if(void 0!==this._nameMap[n])throw new e.ArgumentError("Item already exists in index: "+n);if(r>this._size)throw new e.ArgumentError("Position is out of bounds: "+r);this._rightShift(r,this._size-1),this._posMap[r]=n,this._nameMap[n]=r,this._dataMap[n]=i,this._size+=1;var o=[{op:"add",name:n,position:r,previousPosition:null,value:t.cloneDeep(i)}];return o},n.prototype.remove=function(n){var r=this._nameMap[n];if(void 0===r)throw new e.ArgumentError("Item is not available in result index: "+n);var i=t.cloneDeep(this._dataMap[n]);delete this._nameMap[n],delete this._posMap[r],delete this._dataMap[n],this._leftShift(r+1,this._size-1),delete this._posMap[this._size-1],this._size-=1;var o=[{op:"remove",name:n,position:null,previousPosition:r,value:i}];return o},n.prototype.update=function(n,r,i){var o=this._nameMap[n];if(void 0===o)throw new e.ArgumentError("Item is not available in result index: "+n);if(r>=this._size)throw new e.ArgumentError("Position is out of bounds: "+r);void 0===i&&(i=this.data(n));var s=t.cloneDeep(this._dataMap[n]);if(this._dataMap[n]=i,o===r)return[{op:"update",name:n,position:r,previousPosition:r,value:t.cloneDeep(i)}];var a=[];return delete this._posMap[o],a.push({op:"remove",name:n,position:r,previousPosition:o,value:s}),o>r?this._rightShift(r,o-1):this._leftShift(o+1,r),this._posMap[r]=n,this._nameMap[n]=r,a.push({op:"add",name:n,position:r,previousPosition:o,value:t.cloneDeep(i)}),a},n.prototype.data=function(e){return t.cloneDeep(this._dataMap[e])},n.prototype.position=function(t){var e=this._nameMap[t];return void 0===e?-1:e},n.prototype._leftShift=function(t,e){for(var n,r,i=t;e>=i;++i)r=this._posMap[i],n=i-1,this._posMap[n]=r,this._nameMap[r]=n},n.prototype._rightShift=function(t,e){for(var n,r,i=e;i>=t;i--)n=this._posMap[i],r=i+1,this._posMap[r]=n,this._nameMap[n]=r},n}),define("expression/engine",["lodash","common/obj","common/errors","expression/filter","expression/sort","expression/page","expression/index"],function(t,e,n,r,i,o,s){function a(e,a){if(!t.isPlainObject(a))throw new n.ArgumentError("Must provide an object for opts");e=t.cloneDeep(e),a=t.cloneDeep(a),this._results=[],this._index=new s,this._filterer=new r(e),this._sorter=new i(a.sort),this._paginator=new o(a.limit)}return a.prototype.set=function(e,n){if(!t.isArray(e))throw new Error("An array must be provided");var r=this._filterer.filter(e);r=this._sorter.sort(r);var i=this._index.set(r);return this._results=r,this._paginator.paginate(this._results,i,n)},a.prototype.add=function(e){if(!t.isObject(e))throw new n.ArgumentError("Expects an object to be provided");if(0===this._filterer.filter([e]).length)return[];var r=this._sorter.determinePosition(this._results,e);1/0===r&&(r=this._results.length);var i=this._index.add(e.name,r,e.value);return this._apply(i),this._paginator.paginate(this._results,i)},a.prototype.update=function(e){if(!t.isObject(e))throw new n.ArgumentError("Expects an object to be provided");var r=0!==this._filterer.filter([e]).length,i=void 0!==this._index.data(e.name);if(!r&&!i)return[];if(!r&&i)return this.remove(e);if(r&&!i)return this.add(e);var o=this._index.position(e.name),s=this._results.slice(0,o).concat(this._results.slice(o+1,this._results.length)),a=this._sorter.determinePosition(s,e);1/0===a&&(a=o);var u=this._index.update(e.name,a,e.value);return this._apply(u),this._paginator.paginate(this._results,u)},a.prototype.remove=function(e){if(!t.isObject(e))throw new n.ArgumentError("Expects an object to be provided");if(void 0===this._index.data(e.name))return[];var r=this._index.remove(e.name);return this._apply(r),this._paginator.paginate(this._results,r)},a.prototype.get=function(){return t.cloneDeep(this._paginator.slice(this._results))},a.prototype._apply=function(t){for(var e,n=0;n<t.length;++n)switch(e=t[n],e.op){case"add":this._results.splice(e.position,0,{name:e.name,value:e.value});break;case"update":this._results[e.position]={name:e.name,value:e.value};break;case"remove":this._results.splice(e.previousPosition,1)}},a}),define("platform/query",["lodash","eventemitter2","async","util/inherits","util/validation","util/state_machine","util/resolver","common/errors","common/obj","expression/engine"],function(t,e,n,r,i,o,s,a,u,l){function Query(n,r,i){if(!t.isObject(n))throw new a.ArgumentError("Provided key must be an instance of Key");this._engine=new l(r,i||{}),this._key=n,this._registry={},this._data={},this._state=new o("NOT_INITIALIZED",{NOT_INITIALIZED:["INITIALIZING","DESTROYED"],INITIALIZING:["ERROR","HAS_CHILDREN","HAS_NO_CHILDREN","DESTROYED"],HAS_NO_CHILDREN:["ERROR","HAS_CHILDREN","DESTROYED"],HAS_CHILDREN:["ERROR","HAS_NO_CHILDREN","DESTROYED"],ERROR:["DESTROYED"],DESTROYED:[]}),this._emitter=new e}function c(t,e){var n=e.replace(t,"");return n.replace(/^\/|\/$/g,"")}function f(t,e){var n=c(t,e),r=n.split("/");return 0===r.length?null:r[0]}var h={change:!0,error:!0,add:!0,remove:!0,update:!0};return Query._Resolver=s,Query.prototype.key=function(){return this._key},Query.prototype.on=function(e,n){if(!t.isString(e))throw new a.ArgumentError("The event must be a string");
if(!h[e])throw new a.ArgumentError(e+" is not a valid event for a Query");if(!t.isFunction(n))throw new a.ArgumentError("A listener must be a function");this._emitter.on(e,n)},Query.prototype.off=function(e,n){if(!t.isUndefined(e)&&!t.isString(e))throw new a.ArgumentError("The event must be a string if supplied");if(!t.isUndefined(e)&&!h[e])throw new a.ArgumentError("The event must be a valid query event if supplied");if(!t.isUndefined(n)&&!t.isFunction(n))throw new a.ArgumentError("The listener must be a function if supplied");if(t.isUndefined(e)&&!t.isUndefined(n))throw new a.ArgumentError("You must provide an event if you provide a listener");return e&&n?this._emitter.removeListener(e,n):(this._emitter.removeAllListeners.apply(this._emitter,arguments),void 0)},Query.prototype.execute=function(e){if(!t.isUndefined(e)&&!t.isFunction(e))throw new a.ArgumentError("If a callback is provided it must be a function");var n=new Query._Resolver(e,this);if(e=n.cb,this._state.current!==this._state.states.NOT_INITIALIZED)return e(new a.DuplicateCallError("Query#execute can only be called once per query."));this._state.transition("INITIALIZING");var r=this;return r._get(function(n,i){if(n)return r._state.transition("ERROR"),e(n);if(r._state.current===r._state.states.DESTROYED)return e(new a.CouldNotCompleteError("Query#destroy called during Query#execute -- cannot complete execute"));r._registry={set:t.bind(r._handleUpdate,r),add:t.bind(r._handleUpdate,r),remove:t.bind(r._handleRemove,r)},t.each(r._registry,function(t,e){r._key.on(e,{local:!0,bubble:!0},t)});var o=t.isArray(i)&&0===t.size(i)?"HAS_NO_CHILDREN":"HAS_CHILDREN";r._state.transition(o),r._broadcast(r._engine.set(i,!0)),e(null,r._engine.get())}),n.promise},Query.prototype.get=function(e){if(!t.isUndefined(e)&&!t.isFunction(e))throw new a.ArgumentError("You must provide a function as a callback to Query#get");var n=new Query._Resolver(e,this);e=n.cb;var r=["ERROR","DESTROYED","NOT_INITIALIZED","INITIALIZING"];if(t.contains(r,this._state.current))return i.throwOrCallback(new a.NotInitializedError("Cannot call #get if #execute has not completed, or an error has occurred"),e);var o=this._engine.get();return t.defer(function(){e(null,o)}),n.promise},Query.prototype.destroy=function(){var e=this;t.each(this._registry,function(t,n){e._key.off(n,t)}),e._emitter.removeAllListeners(),e._engine=null,e._data=null,e._key=null,e._registry=null,e._state.transition("DESTROYED")},Query.prototype._get=function(e){var n=this;n._key.get(function(r,i){if(r)return e(r);if(null!==i&&(!t.isObject(i)||t.isArray(i)))return e(new a.NonLeafKeyError("Queries cannot occur on leaf-key's, the key must be a parent"));n._data=i||{};var o=n._mutate(n._data);e(null,o)})},Query.prototype._handleUpdate=function(e,n){if(t.contains(["HAS_CHILDREN","HAS_NO_CHILDREN"],this._state.current)){var r=n.addedKey?n.addedKey:n.key;if(!t.isPlainObject(e)&&n.currentKey===r)return this._emitter.emit("error",new a.NonLeafKeyError("Key["+r+"] has become a leaf-key, no-longer a queryable key"));t.isPlainObject(e)&&(e=t.cloneDeep(e)),e=this._normalize(e,n),t.merge(this._data,e),this._state.current===this._state.states.HAS_NO_CHILDREN&&this._state.transition("HAS_CHILDREN");var i=f(n.currentKey,r),o={name:i,value:u.pick(this._data,i)};this._broadcast(this._engine.update(o))}},Query.prototype._handleRemove=function(e,n){if(t.contains(["HAS_CHILDREN","HAS_NO_CHILDREN"],this._state.current)){var r;if(n.currentKey===n.key)return this._state.transition("HAS_NO_CHILDREN"),this._data={},r=this._engine.set([]),this._broadcast(r);var i=c(n.currentKey,n.key);try{this._data=u.remove(this._data,i,{clone:!0})}catch(o){if(o instanceof a.KeyNameError)return this._state.transition("ERROR"),this._emitter.emit("error",new a.SynchronizationError("Query has become out of sync with the current key value"));throw o}0===t.size(this._data)&&this._state.transition("HAS_NO_CHILDREN");var s=f(n.currentKey,n.key),l=u.pick(this._data,s),h={name:s,value:void 0===l?null:l};r=-1!==i.indexOf("/")&&void 0!==l?this._engine.update(h):this._engine.remove(h),this._broadcast(r)}},Query.prototype._normalize=function(t,e){if(!e.currentKey)throw new a.ArgumentError("invalid context provided");for(var n,r,i,o=e.addedKey?e.addedKey:e.key;o!==e.currentKey;)i=o.lastIndexOf("/"),n=o.slice(o.lastIndexOf("/")),n=n.replace("/",""),r={},r[n]=t,t=r,o=o.slice(0,i);return t},Query.prototype._mutate=function(e){if(!t.isObject(e)||t.isArray(e))throw new Error("Mutate requires an object");var n=[];return t.each(e,function(t,e){n.push({name:e,value:t})}),n},Query.prototype._broadcast=function(t){if(0!==t.length){for(var e,n=0;n<t.length;++n)e=t[n],this._emitter.emit(e.op,{name:e.name,value:e.value},{position:{current:e.position,previous:e.previousPosition},events:{current:n+1,total:t.length},event:e.op,child:e.name});this._emitter.emit("change",this._engine.get(),{event:"change"})}},Query}),!function(t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define("tandem",t):"undefined"!=typeof window?window.Tandem=t():"undefined"!=typeof global?global.Tandem=t():"undefined"!=typeof self&&(self.Tandem=t())}(function(){return function t(e,n,r){function i(s,a){if(!n[s]){if(!e[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s);if(o)return o(s,!0);throw new Error("Cannot find module '"+s+"'")}var l=n[s]={exports:{}};e[s][0].call(l.exports,function(t){var n=e[s][1][t];return i(n?n:t)},l,l.exports,t,e,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t,e){Tandem=t("tandem-core"),Tandem.Client=t("./src/client/tandem"),Tandem.File=t("./src/client/file"),Tandem.Network={Adapter:t("./src/client/network/adapter")},e.exports=Tandem},{"./src/client/file":13,"./src/client/network/adapter":14,"./src/client/tandem":15,"tandem-core":10}],2:[function(t,e){!function(){var n,r,i,o,s,a,u;u=t("lodash"),s=t("./diff_match_patch"),i=t("./op"),r=t("./insert"),o=t("./retain"),a=new s,n=function(){function t(t,e,n){var r;if(this.startLength=t,this.endLength=e,this.ops=n,null==this.ops&&(this.ops=this.endLength,this.endLength=null),this.ops=u.map(this.ops,function(t){if(i.isRetain(t))return t;if(i.isInsert(t))return t;throw new Error("Creating delta with invalid op. Expecting an insert or retain.")}),this.compact(),r=u.reduce(this.ops,function(t,e){return t+e.getLength()},0),null!=this.endLength&&r!==this.endLength)throw new Error("Expecting end length of "+r);this.endLength=r}var e,n;return t.getIdentity=function(e){return new t(e,e,[new o(0,e)])},t.getInitial=function(e){return new t(0,e.length,[new r(e)])},t.isDelta=function(t){var e,n,r,o;if(null!=t&&"object"==typeof t&&"number"==typeof t.startLength&&"number"==typeof t.endLength&&"object"==typeof t.ops){for(o=t.ops,n=0,r=o.length;r>n;n++)if(e=o[n],!i.isRetain(e)&&!i.isInsert(e))return!1;return!0}return!1},t.makeDelta=function(e){return new t(e.startLength,e.endLength,u.map(e.ops,function(t){return i.isInsert(t)?new r(t.value,t.attributes):i.isRetain(t)?new o(t.start,t.end,t.attributes):null}))},t.makeDeleteDelta=function(e,n,r){var i;return i=[],n>0&&i.push(new o(0,n)),e>n+r&&i.push(new o(n+r,e)),new t(e,i)},t.makeInsertDelta=function(e,n,i,s){var a;return a=[new r(i,s)],n>0&&a.unshift(new o(0,n)),e>n&&a.push(new o(n,e)),new t(e,a)},t.makeRetainDelta=function(e,n,r,i){var s;return s=[new o(n,n+r,i)],n>0&&s.unshift(new o(0,n)),e>n+r&&s.push(new o(n+r,e)),new t(e,s)},t.prototype.apply=function(t,e,n,r){var s,a,l;return null==t&&(t=function(){}),null==e&&(e=function(){}),null==n&&(n=function(){}),null==r&&(r=null),this.isIdentity()?void 0:(s=0,a=0,l=[],u.each(this.ops,function(n){return i.isInsert(n)?(t.call(r,s+a,n.value,n.attributes),a+=n.getLength()):i.isRetain(n)?(n.start>s&&(e.call(r,s+a,n.start-s),a-=n.start-s),l.push(new o(n.start+a,n.end+a,n.attributes)),s=n.end):void 0}),this.endLength<this.startLength+a&&e.call(r,this.endLength,this.startLength+a-this.endLength),u.each(l,function(t){return u.each(t.attributes,function(e,i){return null===e?n.call(r,t.start,t.end-t.start,i,e):void 0}),u.each(t.attributes,function(e,i){return null!=e?n.call(r,t.start,t.end-t.start,i,e):void 0})}))},t.prototype.applyToText=function(t){var e,n,r,o,s,a,u;if(n=this,t.length!==n.startLength)throw new Error("Start length of delta: "+n.startLength+" is not equal to the text: "+t.length);for(e=[],u=n.ops,s=0,a=u.length;a>s;s++)r=u[s],i.isInsert(r)?e.push(r.value):e.push(t.substring(r.start,r.end));if(o=e.join(""),n.endLength!==o.length)throw new Error("End length of delta: "+n.endLength+" is not equal to result text: "+o.length);return o},t.prototype.canCompose=function(e){return t.isDelta(e)&&this.endLength===e.startLength},t.prototype.compact=function(){var t;return t=[],u.each(this.ops,function(e){var n;if(0!==e.getLength())return 0===t.length?t.push(e):(n=u.last(t),i.isInsert(n)&&i.isInsert(e)&&n.attributesMatch(e)?t[t.length-1]=new r(n.value+e.value,e.attributes):i.isRetain(n)&&i.isRetain(e)&&n.end===e.start&&n.attributesMatch(e)?t[t.length-1]=new o(n.start,e.end,e.attributes):t.push(e))}),this.ops=t},t.prototype.compose=function(e){var n,s,a,l,c,f,h;if(!this.canCompose(e))throw new Error("Cannot compose delta");for(s=this,n=[],h=e.ops,c=0,f=h.length;f>c;c++)if(a=h[c],i.isInsert(a))n.push(a);else{if(!i.isRetain(a))throw new Error("Invalid op in deltaB when composing");l=s.getOpsAt(a.start,a.getLength()),l=u.map(l,function(t){return i.isInsert(t)?new r(t.value,t.composeAttributes(a.attributes)):new o(t.start,t.end,t.composeAttributes(a.attributes))}),n=n.concat(l)}return new t(s.startLength,e.endLength,n)},t.prototype.decompose=function(e){var n,s,a,l,c,f;if(a=this,!t.isDelta(e))throw new Error("Decompose called when deltaA is not a Delta, type: "+typeof e);if(e.startLength!==this.startLength)throw new Error("startLength "+e.startLength+" / startLength "+this.startLength+" mismatch");if(!u.all(e.ops,function(t){return i.isInsert(t)}))throw new Error("DeltaA has retain in decompose");if(!u.all(a.ops,function(t){return i.isInsert(t)}))throw new Error("DeltaC has retain in decompose");return n=function(t,e){var r,i,o;r={};for(i in e)o=e[i],(void 0===t[i]||t[i]!==o)&&(r[i]=null!==t[i]&&"object"==typeof t[i]&&null!==o&&"object"==typeof o?n(t[i],o):o);for(i in t)o=t[i],void 0===e[i]&&(r[i]=null);return r},l=e.diff(a),f=[],c=0,u.each(l.ops,function(t){var s,l;return l=a.getOpsAt(c,t.getLength()),s=0,u.each(l,function(a){var l,c,h;if(i.isInsert(t))l=new r(t.value.substring(s,s+a.getLength()),a.attributes),f.push(l);else{if(!i.isRetain(t))throw new Error("Invalid delta in deltaB when composing");h=e.getOpsAt(t.start+s,a.getLength()),c=0,u.each(h,function(e){var r,i,u;return r=n(e.attributes,a.attributes),u=t.start+c+s,i=new o(u,u+e.getLength(),r),f.push(i),c+=e.getLength()})}return s+=a.getLength()}),c+=t.getLength()}),s=new t(l.startLength,l.endLength,f)},t.prototype.diff=function(e){var n,i,l,c,f,h,p,d,m,g,v,y,_;if(y=u.map([this,e],function(t){return u.map(t.ops,function(t){return null!=t.value?t.value:""}).join("")}),p=y[0],d=y[1],""!==p||""!==d){if(n=a.diff_main(p,d),n.length<=0)throw new Error("diffToDelta called with diff with length <= 0");for(h=0,i=0,f=[],g=0,v=n.length;v>g;g++)switch(_=n[g],c=_[0],m=_[1],c){case s.DIFF_DELETE:h+=m.length;break;case s.DIFF_INSERT:f.push(new r(m)),i+=m.length;break;case s.DIFF_EQUAL:f.push(new o(h,h+m.length)),h+=m.length,i+=m.length}l=new t(h,i,f)}else l=new t(0,0,[]);return l},e=function(t,e,n,r){var i,s;if(s=u.extend({},n),i=Math.min(t.getLength(),e.getLength()),r)if(s.transformOp=new o(s.indexA,s.indexA+i),s.indexA+=i,i===t.getLength())s.elemIndexA++;else{if(!(i<t.getLength()))throw new Error("Invalid elem length in transform");s.elemA=u.last(t.split(i))}else s.transformOp=u.first(e.split(i)),s.indexB+=i,i===e.getLength()?s.elemIndexB++:s.elemB=u.last(e.split(i));return s},n=function(t,e,n){var r,i,s,a,l,c,f,h;if(l=n.indexA,c=n.indexB,i=n.elemIndexA,s=n.elemIndexB,h=u.extend({},n),t.end<e.start)h.indexA+=t.getLength(),h.elemIndexA++;else if(e.end<t.start)h.indexB+=e.getLength(),h.elemIndexB++;else{if(t.start<e.start?(h.indexA+=e.start-t.start,t=h.elemA=new o(e.start,t.end,t.attributes)):e.start<t.start&&(h.indexB+=t.start-e.start,e=h.elemB=new o(t.start,e.end,e.attributes)),a="RetainOps must have same start length in transform",t.start!==e.start)throw new Error(a);f=Math.min(t.end,e.end)-t.start,r=t.addAttributes(e.attributes),h.transformOp=new o(h.indexA,h.indexA+f,r),h.indexA+=f,h.indexB+=f,t.end===e.end?(h.elemIndexA++,h.elemIndexB++):t.end<e.end?(h.elemIndexA++,h.elemB=u.last(e.split(f))):(h.elemIndexB++,h.elemA=u.last(t.split(f)))}return h.elemIndexA!==n.elemIndexA&&(h.elemA=null),h.elemIndexB!==n.elemIndexB&&(h.elemB=null),h},t.prototype.transform=function(r,s){var a,l,c,f,h,p,d,m,g,v,y,_,b,w;if(null==s&&(s=!1),!t.isDelta(r))throw p="Transform called when deltaA is not a Delta, type: ",new Error(p+typeof r);for(r=new t(r.startLength,r.endLength,r.ops),a=new t(this.startLength,this.endLength,this.ops),y=[],d=m=0,f=h=0,b=function(t){return null!=t.indexA&&(d=t.indexA),null!=t.indexB&&(m=t.indexB),null!=t.elemIndexA&&(f=t.elemIndexA),null!=t.elemIndexB&&(h=t.elemIndexB),null!=t.elemA&&(r.ops[f]=t.elemA),null!=t.elemB&&(a.ops[h]=t.elemB),null!=t.transformOp?y.push(t.transformOp):void 0},w=function(){return{indexA:d,indexB:m,elemIndexA:f,elemIndexB:h}};f<r.ops.length&&h<a.ops.length;)l=r.ops[f],c=a.ops[h],i.isInsert(l)&&i.isInsert(c)?(g=e(l,c,w(),s),b(g)):i.isRetain(l)&&i.isRetain(c)?(g=n(l,c,w()),b(g)):i.isInsert(l)&&i.isRetain(c)?(y.push(new o(d,d+l.getLength())),d+=l.getLength(),f++):i.isRetain(l)&&i.isInsert(c)&&(y.push(c),m+=c.getLength(),h++);for(;f<r.ops.length;)l=r.ops[f],i.isInsert(l)&&y.push(new o(d,d+l.getLength())),d+=l.getLength(),f++;for(;h<a.ops.length;)c=a.ops[h],i.isInsert(c)&&y.push(c),m+=c.getLength(),h++;return _=r.endLength,v=u.reduce(y,function(t,e){return t+e.getLength()},0),new t(_,v,y)},t.prototype.getOpsAt=function(t,e){var n,r,i,o,s,a,u,l,c;for(n=[],i=null!=this.savedOpOffset&&this.savedOpOffset<t?this.savedOpOffset:this.savedOpOffset=this.savedOpIndex=0,c=this.ops.slice(this.savedOpIndex),u=0,l=c.length;l>u&&(o=c[u],!(i>=t+e));u++)s=o.getLength(),i+s>t&&(a=Math.max(t-i,0),r=Math.min(s-a,t+e-i-a),n.push(o.getAt(a,r))),i+=s,this.savedOpIndex+=1,this.savedOpOffset+=s;return n},t.prototype.invert=function(t){var e,n,r;if(!this.isInsertsOnly())throw new Error("Invert called on invalid delta containing non-insert ops");return e=this,n=e.compose(t),r=e.decompose(n)},t.prototype.isEqual=function(t){return t?this.startLength!==t.startLength||this.endLength!==t.endLength?!1:u.isArray(t.ops)&&this.ops.length===t.ops.length?u.all(this.ops,function(e,n){return e.isEqual(t.ops[n])}):!1:!1},t.prototype.isIdentity=function(){var t,e,n,r,o;if(this.startLength===this.endLength){if(0===this.ops.length)return!0;for(t=0,o=this.ops,n=0,r=o.length;r>n;n++){if(e=o[n],!i.isRetain(e))return!1;if(e.start!==t)return!1;if(!(0===e.numAttributes()||1===e.numAttributes()&&u.has(e.attributes,"authorId")))return!1;t=e.end}return t!==this.endLength?!1:!0}return!1},t.prototype.isInsertsOnly=function(){return u.every(this.ops,function(t){return i.isInsert(t)})},t.prototype.merge=function(e){var n,r=this;return n=u.map(e.ops,function(t){return i.isRetain(t)?new o(t.start+r.startLength,t.end+r.startLength,t.attributes):t}),n=this.ops.concat(n),new t(this.startLength+e.startLength,n)},t.prototype.split=function(e){var n,r;if(!this.isInsertsOnly())throw new Error("Split only implemented for inserts only");if(!(e>=0&&e<=this.endLength))throw new Error("Split at invalid index");return n=[],r=[],u.reduce(this.ops,function(t,i){var o,s,a;return t+i.getLength()<=e?n.push(i):t>=e?r.push(i):(a=i.split(e-t),o=a[0],s=a[1],n.push(o),r.push(s)),t+i.getLength()},0),[new t(0,n),new t(0,r)]},t.prototype.toString=function(){return"{("+this.startLength+"->"+this.endLength+") ["+this.ops.join(", ")+"]}"},t}(),e.exports=n}.call(this)},{"./diff_match_patch":4,"./insert":5,"./op":6,"./retain":7,lodash:!1}],3:[function(t,e){!function(){var n,r,i,o,s,a,u,l;u=t("lodash"),n=t("./delta"),i=t("./insert"),o=t("./retain"),l={alphabet:"abcdefghijklmnopqrstuvwxyz\n\n\n\n  ",booleanAttributes:{bold:[!0,!1],italic:[!0,!1],strike:[!0,!1]},nonBooleanAttributes:{"back-color":["white","black","red","blue","lime","teal","magenta","yellow"],"fore-color":["white","black","red","blue","lime","teal","magenta","yellow"],"font-name":["monospace","serif"],"font-size":["huge","large","small"]},defaultAttributeValue:{"back-color":"white","fore-color":"black","font-name":"san-serif","font-size":"normal"}},a=function(t){return null!=t?l=t:void 0},s=function(t){if(t=t||l,null==t)throw new Error("Must provide DeltaGenerator with a domain.");if(null==t.alphabet)throw new Error("Domain must define alphabet.");if(null==t.booleanAttributes)throw new Error("Domain must define booleanAttributes.");if(null==t.nonBooleanAttributes)throw new Error("Domain must define nonBooleanAttributes.");if(null==t.defaultAttributeValue)throw new Error("Domain must define defaultAttributeValue.");return{getDomain:function(){return l},getRandomString:function(e){var n;return u.map(function(){n=[];for(var t=0,r=e-1;r>=0?r>=t:t>=r;r>=0?t++:t--)n.push(t);return n}.apply(this),function(){return t.alphabet[u.random(0,t.alphabet.length-1)]}).join("")},getRandomLength:function(){var t;return t=Math.random(),.6>t?u.random(1,2):.8>t?u.random(3,4):.9>t?u.random(5,9):u.random(10,50)},insertAt:function(t,e,n){var r,o,s,a,u,l,c,f,h;for(r=a=0,f=t.ops,l=0,c=f.length;c>l&&(s=f[l],r!==e);l++){if(e<r+s.getLength()){h=s.split(e-r),o=h[0],u=h[1],t.ops.splice(a,1,o,u),a++;break}r+=s.getLength(),a++}return t.ops.splice(a,0,new i(n)),t.endLength+=n.length,t.compact()},deleteAt:function(t,e,n){var r,s,a,l,c,f,h,p,d,m,g;for(r=0,f=[],g=t.ops,d=0,m=g.length;m>d;d++){if(c=g[d],h=r===e||e<r+c.getLength(),n>0&&h){if(s=Math.min(n,c.getLength()-(e-r)),n-=s,i.isInsert(c))l=c.value.substring(0,e-r)+c.value.substring(e-r+s),l.length>0&&f.push(new i(l));else{if(!o.isRetain(c))throw new Error("Expected retain but got "+c);a=new o(c.start,c.start+e-r,u.clone(c.attributes)),p=new o(c.start+e-r+s,c.end,u.clone(c.attributes)),a.start<a.end&&f.push(a),p.start<p.end&&f.push(p)}e+=s}else f.push(c);r+=c.getLength()}return t.ops=f,t.endLength=u.reduce(f,function(t,e){return t+e.getLength()},0)},formatAt:function(e,n,r,s,a){var l,c,f,h,p,d,m,g,v,y,_,b,w,E,k,x,A,O,S;for(S=function(t,e,n,r){var s,a,l,c,f,h,p,d,m,g,v,y;if(i.isInsert(t))c=t.value.substring(0,e),l=new i(c,u.clone(t.attributes)),a=t.value.substring(e,e+n),s=new i(a,u.clone(t.attributes)),g=t.value.substring(e+n),m=new i(g,u.clone(t.attributes)),-1!==a.indexOf("\n")&&(h=a.substring(0,a.indexOf("\n")),g=a.substring(a.indexOf("\n"))+g,s=new i(h,u.clone(t.attributes)),m=new i(g,u.clone(t.attributes)));else{if(!o.isRetain(t))throw new Error("Expected retain but got "+t);if(l=new o(t.start,t.start+e,u.clone(t.attributes)),s=new o(l.end,l.end+n,u.clone(t.attributes)),m=new o(s.end,t.end,u.clone(t.attributes)),d=r.getOpsAt(s.start,s.getLength()),!u.every(d,function(t){return i.isInsert(t)}))throw new Error("Non insert op in backref");for(f=s.start,v=0,y=d.length;y>v;v++){if(p=d[v],!i.isInsert(p))throw new Error("Got retainOp in reference delta!");if(-1!==p.value.indexOf("\n")){s=new o(s.start,f+p.value.indexOf("\n"),u.clone(s.attributes)),m=new o(f+p.value.indexOf("\n"),m.end,u.clone(m.attributes));break}f+=p.getLength()}}return[l,s,m]},x=function(t,e,n,r){var i,o,s,a,u,l;for(i=0,s=r[0].attributes[n],l=[],a=0,u=r.length;u>a;a++){if(o=r[a],o.attributes[n]!==s){t.end=t.start+i,e.start=t.end;break}l.push(i+=o.getLength())}return l},y=function(t,e,n,r){var s;if(i.isInsert(t))return null!=t.attributes[n]?delete t.attributes[n]:t.attributes[n]=!0;if(!o.isRetain(t))throw new Error("Expected retain but got "+t);if(null!=t.attributes[n])return delete t.attributes[n];if(s=r.getOpsAt(t.start,t.getLength()),!u.every(s,function(t){return i.isInsert(t)}))throw new Error("Formatting a retain that does not refer to an insert.");if(s.length>0){if(x(t,e,n,s),null!=s[0].attributes[n]){if(!s[0].attributes[n])throw new Error("Boolean attribute on reference delta should only be true!");return t.attributes[n]=null}return t.attributes[n]=!0}},_=function(e,n,r,s){var a,l;if(a=function(e){return null!=e?u.first(u.shuffle(u.without(t.nonBooleanAttributes[r],e))):u.first(u.shuffle(u.without(t.nonBooleanAttributes[r],t.defaultAttributeValue[r])))},i.isInsert(e))return e.attributes[r]=a(r,e.attributes[r]);if(!o.isRetain(e))throw new Error("Expected retain but got "+e);if(l=s.getOpsAt(e.start,e.getLength()),!u.every(l,function(t){return i.isInsert(t)}))throw new Error("Formatting a retain that does not refer to an insert.");return l.length>0?(x(e,n,r,l),null!=e.attributes[r]&&Math.random()<.5?delete e.attributes[r]:e.attributes[r]=a(e.attributes[r])):void 0},c=0,m=[],A=e.ops,b=0,E=A.length;E>b;b++){if(d=A[b],g=c===n||c+d.getLength()>n,r>0&&g){for(h=Math.min(r,d.getLength()-(n-c)),r-=h,O=S(d,n-c,h,a),p=O[0],f=O[1],v=O[2],m.push(p),m.push(f),m.push(v),w=0,k=s.length;k>w;w++)if(l=s[w],u.has(t.booleanAttributes,l))y(f,v,l,a);else{if(!u.has(t.nonBooleanAttributes,l))throw new Error("Received unknown attribute: "+l);_(f,v,l,a)}n+=h}else m.push(d);c+=d.getLength()}return e.endLength=u.reduce(m,function(t,e){return t+e.getLength()},0),e.ops=m,e.compact()},addRandomOp:function(e,n){var r,i,o,s,a,l,c;if(i=n.endLength-1,s=u.random(0,i),l=Math.random(),.5>l)a=this.getRandomLength(),this.insertAt(e,s,this.getRandomString(a));else if(.75>l){if(n.endLength<=1)return e;s=u.random(0,i-1),a=u.random(1,i-s),this.deleteAt(e,s,a)}else c=u.shuffle(u.keys(t.booleanAttributes).concat(u.keys(t.nonBooleanAttributes))),o=u.random(1,c.length),r=c.slice(0,o),a=u.random(1,i-s),this.formatAt(e,s,a,r,n);return e},getRandomDelta:function(t,e){var r,i,s;for(i=new n(t.endLength,t.endLength,[new o(0,t.endLength)]),e||(e=u.random(1,10)),r=s=0;e>=0?e>s:s>e;r=e>=0?++s:--s)this.addRandomOp(i,t);return i}}},r={setDomain:a,getUtils:s},e.exports=r}.call(this)},{"./delta":2,"./insert":5,"./retain":7,lodash:!1}],4:[function(t,e){!function(){var n;n=t("googlediff"),n.DIFF_DELETE=-1,n.DIFF_INSERT=1,n.DIFF_EQUAL=0,e.exports=n}.call(this)},{googlediff:11}],5:[function(t,e){!function(){var n,r,i,o={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};i=t("lodash"),r=t("./op"),n=function(t){function e(t,e){this.value=t,null==e&&(e={}),this.attributes=i.clone(e)}return s(e,t),e.prototype.getAt=function(t,n){return new e(this.value.substr(t,n),this.attributes)},e.prototype.getLength=function(){return this.value.length},e.prototype.isEqual=function(t){return null!=t&&this.value===t.value&&i.isEqual(this.attributes,t.attributes)},e.prototype.join=function(t){if(i.isEqual(this.attributes,t.attributes))return new e(this.value+second.value,this.attributes);throw Error},e.prototype.split=function(t){var n,r;return n=new e(this.value.substr(0,t),this.attributes),r=new e(this.value.substr(t),this.attributes),[n,r]},e.prototype.toString=function(){return"{"+this.value+", "+this.printAttributes()+"}"},e}(r),e.exports=n}.call(this)},{"./op":6,lodash:!1}],6:[function(t,e){!function(){var n,r;r=t("lodash"),n=function(){function t(t){null==t&&(t={}),this.attributes=r.clone(t)}return t.isInsert=function(t){return null!=t&&"string"==typeof t.value},t.isRetain=function(t){return null!=t&&"number"==typeof t.start&&"number"==typeof t.end},t.prototype.addAttributes=function(t){var e,n,r;e={};for(n in t)r=t[n],void 0===this.attributes[n]&&(e[n]=r);return e},t.prototype.attributesMatch=function(t){var e;return e=t.attributes||{},r.isEqual(this.attributes,e)},t.prototype.composeAttributes=function(e){var n,i=this;return n=function(e,o){var s,a,u;if(!o)return e;a=r.clone(e);for(s in o)u=o[s],t.isInsert(i)&&null===u?delete a[s]:"undefined"!=typeof u&&(a[s]="object"==typeof a[s]&&"object"==typeof u&&r.all([a[s],o[s]],function(t){return null!==t})?n(a[s],u):u);return a},n(this.attributes,e)},t.prototype.numAttributes=function(){return r.keys(this.attributes).length},t.prototype.printAttributes=function(){return JSON.stringify(this.attributes)},t}(),e.exports=n}.call(this)},{lodash:!1}],7:[function(t,e){!function(){var n,r,i,o={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};i=t("lodash"),n=t("./op"),r=function(t){function e(t,e,n){this.start=t,this.end=e,null==n&&(n={}),this.attributes=i.clone(n)}return s(e,t),e.prototype.getAt=function(t,n){return new e(this.start+t,this.start+t+n,this.attributes)},e.prototype.getLength=function(){return this.end-this.start},e.prototype.isEqual=function(t){return null!=t&&this.start===t.start&&this.end===t.end&&i.isEqual(this.attributes,t.attributes)},e.prototype.split=function(t){var n,r;return n=new e(this.start,this.start+t,this.attributes),r=new e(this.start+t,this.end,this.attributes),[n,r]},e.prototype.toString=function(){return"{{"+this.start+" - "+this.end+"), "+this.printAttributes()+"}"},e}(n),e.exports=r}.call(this)},{"./op":6,lodash:!1}],8:[function(t,e){!function(){e.exports={Delta:t("./delta"),DeltaGen:t("./delta_generator"),Op:t("./op"),InsertOp:t("./insert"),RetainOp:t("./retain")}}.call(this)},{"./delta":2,"./delta_generator":3,"./insert":5,"./op":6,"./retain":7}],9:[function(t,e){e.exports=t("./build/delta.js")},{"./build/delta.js":2}],10:[function(t,e){e.exports=t("./build/tandem-core")},{"./build/tandem-core":8}],11:[function(t,e){e.exports=t("./javascript/diff_match_patch_uncompressed.js").diff_match_patch},{"./javascript/diff_match_patch_uncompressed.js":12}],12:[function(){function t(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32}var e=-1,n=1,r=0;t.Diff,t.prototype.diff_main=function(t,e,n,i){"undefined"==typeof i&&(i=this.Diff_Timeout<=0?Number.MAX_VALUE:(new Date).getTime()+1e3*this.Diff_Timeout);var o=i;if(null==t||null==e)throw new Error("Null input. (diff_main)");if(t==e)return t?[[r,t]]:[];"undefined"==typeof n&&(n=!0);var s=n,a=this.diff_commonPrefix(t,e),u=t.substring(0,a);t=t.substring(a),e=e.substring(a),a=this.diff_commonSuffix(t,e);var l=t.substring(t.length-a);t=t.substring(0,t.length-a),e=e.substring(0,e.length-a);var c=this.diff_compute_(t,e,s,o);return u&&c.unshift([r,u]),l&&c.push([r,l]),this.diff_cleanupMerge(c),c},t.prototype.diff_compute_=function(t,i,o,s){var a;if(!t)return[[n,i]];if(!i)return[[e,t]];var u=t.length>i.length?t:i,l=t.length>i.length?i:t,c=u.indexOf(l);if(-1!=c)return a=[[n,u.substring(0,c)],[r,l],[n,u.substring(c+l.length)]],t.length>i.length&&(a[0][0]=a[2][0]=e),a;if(1==l.length)return[[e,t],[n,i]];var f=this.diff_halfMatch_(t,i);if(f){var h=f[0],p=f[1],d=f[2],m=f[3],g=f[4],v=this.diff_main(h,d,o,s),y=this.diff_main(p,m,o,s);return v.concat([[r,g]],y)}return o&&t.length>100&&i.length>100?this.diff_lineMode_(t,i,s):this.diff_bisect_(t,i,s)},t.prototype.diff_lineMode_=function(t,i,o){var s=this.diff_linesToChars_(t,i);t=s.chars1,i=s.chars2;var a=s.lineArray,u=this.diff_main(t,i,!1,o);this.diff_charsToLines_(u,a),this.diff_cleanupSemantic(u),u.push([r,""]);for(var l=0,c=0,f=0,h="",p="";l<u.length;){switch(u[l][0]){case n:f++,p+=u[l][1];break;case e:c++,h+=u[l][1];break;case r:if(c>=1&&f>=1){u.splice(l-c-f,c+f),l=l-c-f;for(var s=this.diff_main(h,p,!1,o),d=s.length-1;d>=0;d--)u.splice(l,0,s[d]);l+=s.length}f=0,c=0,h="",p=""}l++}return u.pop(),u},t.prototype.diff_bisect_=function(t,r,i){for(var o=t.length,s=r.length,a=Math.ceil((o+s)/2),u=a,l=2*a,c=new Array(l),f=new Array(l),h=0;l>h;h++)c[h]=-1,f[h]=-1;c[u+1]=0,f[u+1]=0;for(var p=o-s,d=0!=p%2,m=0,g=0,v=0,y=0,_=0;a>_&&!((new Date).getTime()>i);_++){for(var b=-_+m;_-g>=b;b+=2){var w,E=u+b;w=b==-_||b!=_&&c[E-1]<c[E+1]?c[E+1]:c[E-1]+1;for(var k=w-b;o>w&&s>k&&t.charAt(w)==r.charAt(k);)w++,k++;if(c[E]=w,w>o)g+=2;else if(k>s)m+=2;else if(d){var x=u+p-b;if(x>=0&&l>x&&-1!=f[x]){var A=o-f[x];if(w>=A)return this.diff_bisectSplit_(t,r,w,k,i)}}}for(var O=-_+v;_-y>=O;O+=2){var A,x=u+O;A=O==-_||O!=_&&f[x-1]<f[x+1]?f[x+1]:f[x-1]+1;for(var S=A-O;o>A&&s>S&&t.charAt(o-A-1)==r.charAt(s-S-1);)A++,S++;if(f[x]=A,A>o)y+=2;else if(S>s)v+=2;else if(!d){var E=u+p-O;if(E>=0&&l>E&&-1!=c[E]){var w=c[E],k=u+w-E;if(A=o-A,w>=A)return this.diff_bisectSplit_(t,r,w,k,i)}}}}return[[e,t],[n,r]]},t.prototype.diff_bisectSplit_=function(t,e,n,r,i){var o=t.substring(0,n),s=e.substring(0,r),a=t.substring(n),u=e.substring(r),l=this.diff_main(o,s,!1,i),c=this.diff_main(a,u,!1,i);return l.concat(c)},t.prototype.diff_linesToChars_=function(t,e){function n(t){for(var e="",n=0,o=-1,s=r.length;o<t.length-1;){o=t.indexOf("\n",n),-1==o&&(o=t.length-1);var a=t.substring(n,o+1);n=o+1,(i.hasOwnProperty?i.hasOwnProperty(a):void 0!==i[a])?e+=String.fromCharCode(i[a]):(e+=String.fromCharCode(s),i[a]=s,r[s++]=a)}return e}var r=[],i={};r[0]="";var o=n(t),s=n(e);return{chars1:o,chars2:s,lineArray:r}},t.prototype.diff_charsToLines_=function(t,e){for(var n=0;n<t.length;n++){for(var r=t[n][1],i=[],o=0;o<r.length;o++)i[o]=e[r.charCodeAt(o)];t[n][1]=i.join("")}},t.prototype.diff_commonPrefix=function(t,e){if(!t||!e||t.charAt(0)!=e.charAt(0))return 0;for(var n=0,r=Math.min(t.length,e.length),i=r,o=0;i>n;)t.substring(o,i)==e.substring(o,i)?(n=i,o=n):r=i,i=Math.floor((r-n)/2+n);return i},t.prototype.diff_commonSuffix=function(t,e){if(!t||!e||t.charAt(t.length-1)!=e.charAt(e.length-1))return 0;for(var n=0,r=Math.min(t.length,e.length),i=r,o=0;i>n;)t.substring(t.length-i,t.length-o)==e.substring(e.length-i,e.length-o)?(n=i,o=n):r=i,i=Math.floor((r-n)/2+n);return i},t.prototype.diff_commonOverlap_=function(t,e){var n=t.length,r=e.length;if(0==n||0==r)return 0;n>r?t=t.substring(n-r):r>n&&(e=e.substring(0,n));var i=Math.min(n,r);if(t==e)return i;for(var o=0,s=1;;){var a=t.substring(i-s),u=e.indexOf(a);if(-1==u)return o;s+=u,(0==u||t.substring(i-s)==e.substring(0,s))&&(o=s,s++)}},t.prototype.diff_halfMatch_=function(t,e){function n(t,e,n){for(var r,i,o,a,u=t.substring(n,n+Math.floor(t.length/4)),l=-1,c="";-1!=(l=e.indexOf(u,l+1));){var f=s.diff_commonPrefix(t.substring(n),e.substring(l)),h=s.diff_commonSuffix(t.substring(0,n),e.substring(0,l));c.length<h+f&&(c=e.substring(l-h,l)+e.substring(l,l+f),r=t.substring(0,n-h),i=t.substring(n+f),o=e.substring(0,l-h),a=e.substring(l+f))}return 2*c.length>=t.length?[r,i,o,a,c]:null}if(this.Diff_Timeout<=0)return null;var r=t.length>e.length?t:e,i=t.length>e.length?e:t;if(r.length<4||2*i.length<r.length)return null;var o,s=this,a=n(r,i,Math.ceil(r.length/4)),u=n(r,i,Math.ceil(r.length/2));if(!a&&!u)return null;o=u?a?a[4].length>u[4].length?a:u:u:a;var l,c,f,h;t.length>e.length?(l=o[0],c=o[1],f=o[2],h=o[3]):(f=o[0],h=o[1],l=o[2],c=o[3]);var p=o[4];return[l,c,f,h,p]},t.prototype.diff_cleanupSemantic=function(t){for(var i=!1,o=[],s=0,a=null,u=0,l=0,c=0,f=0,h=0;u<t.length;)t[u][0]==r?(o[s++]=u,l=f,c=h,f=0,h=0,a=t[u][1]):(t[u][0]==n?f+=t[u][1].length:h+=t[u][1].length,a&&a.length<=Math.max(l,c)&&a.length<=Math.max(f,h)&&(t.splice(o[s-1],0,[e,a]),t[o[s-1]+1][0]=n,s--,s--,u=s>0?o[s-1]:-1,l=0,c=0,f=0,h=0,a=null,i=!0)),u++;for(i&&this.diff_cleanupMerge(t),this.diff_cleanupSemanticLossless(t),u=1;u<t.length;){if(t[u-1][0]==e&&t[u][0]==n){var p=t[u-1][1],d=t[u][1],m=this.diff_commonOverlap_(p,d),g=this.diff_commonOverlap_(d,p);m>=g?(m>=p.length/2||m>=d.length/2)&&(t.splice(u,0,[r,d.substring(0,m)]),t[u-1][1]=p.substring(0,p.length-m),t[u+1][1]=d.substring(m),u++):(g>=p.length/2||g>=d.length/2)&&(t.splice(u,0,[r,p.substring(0,g)]),t[u-1][0]=n,t[u-1][1]=d.substring(0,d.length-g),t[u+1][0]=e,t[u+1][1]=p.substring(g),u++),u++}u++}},t.prototype.diff_cleanupSemanticLossless=function(e){function n(e,n){if(!e||!n)return 6;
var r=e.charAt(e.length-1),i=n.charAt(0),o=r.match(t.nonAlphaNumericRegex_),s=i.match(t.nonAlphaNumericRegex_),a=o&&r.match(t.whitespaceRegex_),u=s&&i.match(t.whitespaceRegex_),l=a&&r.match(t.linebreakRegex_),c=u&&i.match(t.linebreakRegex_),f=l&&e.match(t.blanklineEndRegex_),h=c&&n.match(t.blanklineStartRegex_);return f||h?5:l||c?4:o&&!a&&u?3:a||u?2:o||s?1:0}for(var i=1;i<e.length-1;){if(e[i-1][0]==r&&e[i+1][0]==r){var o=e[i-1][1],s=e[i][1],a=e[i+1][1],u=this.diff_commonSuffix(o,s);if(u){var l=s.substring(s.length-u);o=o.substring(0,o.length-u),s=l+s.substring(0,s.length-u),a=l+a}for(var c=o,f=s,h=a,p=n(o,s)+n(s,a);s.charAt(0)===a.charAt(0);){o+=s.charAt(0),s=s.substring(1)+a.charAt(0),a=a.substring(1);var d=n(o,s)+n(s,a);d>=p&&(p=d,c=o,f=s,h=a)}e[i-1][1]!=c&&(c?e[i-1][1]=c:(e.splice(i-1,1),i--),e[i][1]=f,h?e[i+1][1]=h:(e.splice(i+1,1),i--))}i++}},t.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,t.whitespaceRegex_=/\s/,t.linebreakRegex_=/[\r\n]/,t.blanklineEndRegex_=/\n\r?\n$/,t.blanklineStartRegex_=/^\r?\n\r?\n/,t.prototype.diff_cleanupEfficiency=function(t){for(var i=!1,o=[],s=0,a=null,u=0,l=!1,c=!1,f=!1,h=!1;u<t.length;)t[u][0]==r?(t[u][1].length<this.Diff_EditCost&&(f||h)?(o[s++]=u,l=f,c=h,a=t[u][1]):(s=0,a=null),f=h=!1):(t[u][0]==e?h=!0:f=!0,a&&(l&&c&&f&&h||a.length<this.Diff_EditCost/2&&3==l+c+f+h)&&(t.splice(o[s-1],0,[e,a]),t[o[s-1]+1][0]=n,s--,a=null,l&&c?(f=h=!0,s=0):(s--,u=s>0?o[s-1]:-1,f=h=!1),i=!0)),u++;i&&this.diff_cleanupMerge(t)},t.prototype.diff_cleanupMerge=function(t){t.push([r,""]);for(var i,o=0,s=0,a=0,u="",l="";o<t.length;)switch(t[o][0]){case n:a++,l+=t[o][1],o++;break;case e:s++,u+=t[o][1],o++;break;case r:s+a>1?(0!==s&&0!==a&&(i=this.diff_commonPrefix(l,u),0!==i&&(o-s-a>0&&t[o-s-a-1][0]==r?t[o-s-a-1][1]+=l.substring(0,i):(t.splice(0,0,[r,l.substring(0,i)]),o++),l=l.substring(i),u=u.substring(i)),i=this.diff_commonSuffix(l,u),0!==i&&(t[o][1]=l.substring(l.length-i)+t[o][1],l=l.substring(0,l.length-i),u=u.substring(0,u.length-i))),0===s?t.splice(o-a,s+a,[n,l]):0===a?t.splice(o-s,s+a,[e,u]):t.splice(o-s-a,s+a,[e,u],[n,l]),o=o-s-a+(s?1:0)+(a?1:0)+1):0!==o&&t[o-1][0]==r?(t[o-1][1]+=t[o][1],t.splice(o,1)):o++,a=0,s=0,u="",l=""}""===t[t.length-1][1]&&t.pop();var c=!1;for(o=1;o<t.length-1;)t[o-1][0]==r&&t[o+1][0]==r&&(t[o][1].substring(t[o][1].length-t[o-1][1].length)==t[o-1][1]?(t[o][1]=t[o-1][1]+t[o][1].substring(0,t[o][1].length-t[o-1][1].length),t[o+1][1]=t[o-1][1]+t[o+1][1],t.splice(o-1,1),c=!0):t[o][1].substring(0,t[o+1][1].length)==t[o+1][1]&&(t[o-1][1]+=t[o+1][1],t[o][1]=t[o][1].substring(t[o+1][1].length)+t[o+1][1],t.splice(o+1,1),c=!0)),o++;c&&this.diff_cleanupMerge(t)},t.prototype.diff_xIndex=function(t,r){var i,o=0,s=0,a=0,u=0;for(i=0;i<t.length&&(t[i][0]!==n&&(o+=t[i][1].length),t[i][0]!==e&&(s+=t[i][1].length),!(o>r));i++)a=o,u=s;return t.length!=i&&t[i][0]===e?u:u+(r-a)},t.prototype.diff_prettyHtml=function(t){for(var i=[],o=/&/g,s=/</g,a=/>/g,u=/\n/g,l=0;l<t.length;l++){var c=t[l][0],f=t[l][1],h=f.replace(o,"&amp;").replace(s,"&lt;").replace(a,"&gt;").replace(u,"&para;<br>");switch(c){case n:i[l]='<ins style="background:#e6ffe6;">'+h+"</ins>";break;case e:i[l]='<del style="background:#ffe6e6;">'+h+"</del>";break;case r:i[l]="<span>"+h+"</span>"}}return i.join("")},t.prototype.diff_text1=function(t){for(var e=[],r=0;r<t.length;r++)t[r][0]!==n&&(e[r]=t[r][1]);return e.join("")},t.prototype.diff_text2=function(t){for(var n=[],r=0;r<t.length;r++)t[r][0]!==e&&(n[r]=t[r][1]);return n.join("")},t.prototype.diff_levenshtein=function(t){for(var i=0,o=0,s=0,a=0;a<t.length;a++){var u=t[a][0],l=t[a][1];switch(u){case n:o+=l.length;break;case e:s+=l.length;break;case r:i+=Math.max(o,s),o=0,s=0}}return i+=Math.max(o,s)},t.prototype.diff_toDelta=function(t){for(var i=[],o=0;o<t.length;o++)switch(t[o][0]){case n:i[o]="+"+encodeURI(t[o][1]);break;case e:i[o]="-"+t[o][1].length;break;case r:i[o]="="+t[o][1].length}return i.join("	").replace(/%20/g," ")},t.prototype.diff_fromDelta=function(t,i){for(var o=[],s=0,a=0,u=i.split(/\t/g),l=0;l<u.length;l++){var c=u[l].substring(1);switch(u[l].charAt(0)){case"+":try{o[s++]=[n,decodeURI(c)]}catch(f){throw new Error("Illegal escape in diff_fromDelta: "+c)}break;case"-":case"=":var h=parseInt(c,10);if(isNaN(h)||0>h)throw new Error("Invalid number in diff_fromDelta: "+c);var p=t.substring(a,a+=h);o[s++]="="==u[l].charAt(0)?[r,p]:[e,p];break;default:if(u[l])throw new Error("Invalid diff operation in diff_fromDelta: "+u[l])}}if(a!=t.length)throw new Error("Delta length ("+a+") does not equal source text length ("+t.length+").");return o},t.prototype.match_main=function(t,e,n){if(null==t||null==e||null==n)throw new Error("Null input. (match_main)");return n=Math.max(0,Math.min(n,t.length)),t==e?0:t.length?t.substring(n,n+e.length)==e?n:this.match_bitap_(t,e,n):-1},t.prototype.match_bitap_=function(t,e,n){function r(t,r){var i=t/e.length,s=Math.abs(n-r);return o.Match_Distance?i+s/o.Match_Distance:s?1:i}if(e.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var i=this.match_alphabet_(e),o=this,s=this.Match_Threshold,a=t.indexOf(e,n);-1!=a&&(s=Math.min(r(0,a),s),a=t.lastIndexOf(e,n+e.length),-1!=a&&(s=Math.min(r(0,a),s)));var u=1<<e.length-1;a=-1;for(var l,c,f,h=e.length+t.length,p=0;p<e.length;p++){for(l=0,c=h;c>l;)r(p,n+c)<=s?l=c:h=c,c=Math.floor((h-l)/2+l);h=c;var d=Math.max(1,n-c+1),m=Math.min(n+c,t.length)+e.length,g=Array(m+2);g[m+1]=(1<<p)-1;for(var v=m;v>=d;v--){var y=i[t.charAt(v-1)];if(g[v]=0===p?(1|g[v+1]<<1)&y:(1|g[v+1]<<1)&y|(1|(f[v+1]|f[v])<<1)|f[v+1],g[v]&u){var _=r(p,v-1);if(s>=_){if(s=_,a=v-1,!(a>n))break;d=Math.max(1,2*n-a)}}}if(r(p+1,n)>s)break;f=g}return a},t.prototype.match_alphabet_=function(t){for(var e={},n=0;n<t.length;n++)e[t.charAt(n)]=0;for(var n=0;n<t.length;n++)e[t.charAt(n)]|=1<<t.length-n-1;return e},t.prototype.patch_addContext_=function(t,e){if(0!=e.length){for(var n=e.substring(t.start2,t.start2+t.length1),i=0;e.indexOf(n)!=e.lastIndexOf(n)&&n.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)i+=this.Patch_Margin,n=e.substring(t.start2-i,t.start2+t.length1+i);i+=this.Patch_Margin;var o=e.substring(t.start2-i,t.start2);o&&t.diffs.unshift([r,o]);var s=e.substring(t.start2+t.length1,t.start2+t.length1+i);s&&t.diffs.push([r,s]),t.start1-=o.length,t.start2-=o.length,t.length1+=o.length+s.length,t.length2+=o.length+s.length}},t.prototype.patch_make=function(i,o,s){var a,u;if("string"==typeof i&&"string"==typeof o&&"undefined"==typeof s)a=i,u=this.diff_main(a,o,!0),u.length>2&&(this.diff_cleanupSemantic(u),this.diff_cleanupEfficiency(u));else if(i&&"object"==typeof i&&"undefined"==typeof o&&"undefined"==typeof s)u=i,a=this.diff_text1(u);else if("string"==typeof i&&o&&"object"==typeof o&&"undefined"==typeof s)a=i,u=o;else{if("string"!=typeof i||"string"!=typeof o||!s||"object"!=typeof s)throw new Error("Unknown call format to patch_make.");a=i,u=s}if(0===u.length)return[];for(var l=[],c=new t.patch_obj,f=0,h=0,p=0,d=a,m=a,g=0;g<u.length;g++){var v=u[g][0],y=u[g][1];switch(f||v===r||(c.start1=h,c.start2=p),v){case n:c.diffs[f++]=u[g],c.length2+=y.length,m=m.substring(0,p)+y+m.substring(p);break;case e:c.length1+=y.length,c.diffs[f++]=u[g],m=m.substring(0,p)+m.substring(p+y.length);break;case r:y.length<=2*this.Patch_Margin&&f&&u.length!=g+1?(c.diffs[f++]=u[g],c.length1+=y.length,c.length2+=y.length):y.length>=2*this.Patch_Margin&&f&&(this.patch_addContext_(c,d),l.push(c),c=new t.patch_obj,f=0,d=m,h=p)}v!==n&&(h+=y.length),v!==e&&(p+=y.length)}return f&&(this.patch_addContext_(c,d),l.push(c)),l},t.prototype.patch_deepCopy=function(e){for(var n=[],r=0;r<e.length;r++){var i=e[r],o=new t.patch_obj;o.diffs=[];for(var s=0;s<i.diffs.length;s++)o.diffs[s]=i.diffs[s].slice();o.start1=i.start1,o.start2=i.start2,o.length1=i.length1,o.length2=i.length2,n[r]=o}return n},t.prototype.patch_apply=function(t,i){if(0==t.length)return[i,[]];t=this.patch_deepCopy(t);var o=this.patch_addPadding(t);i=o+i+o,this.patch_splitMax(t);for(var s=0,a=[],u=0;u<t.length;u++){var l,c=t[u].start2+s,f=this.diff_text1(t[u].diffs),h=-1;if(f.length>this.Match_MaxBits?(l=this.match_main(i,f.substring(0,this.Match_MaxBits),c),-1!=l&&(h=this.match_main(i,f.substring(f.length-this.Match_MaxBits),c+f.length-this.Match_MaxBits),(-1==h||l>=h)&&(l=-1))):l=this.match_main(i,f,c),-1==l)a[u]=!1,s-=t[u].length2-t[u].length1;else{a[u]=!0,s=l-c;var p;if(p=-1==h?i.substring(l,l+f.length):i.substring(l,h+this.Match_MaxBits),f==p)i=i.substring(0,l)+this.diff_text2(t[u].diffs)+i.substring(l+f.length);else{var d=this.diff_main(f,p,!1);if(f.length>this.Match_MaxBits&&this.diff_levenshtein(d)/f.length>this.Patch_DeleteThreshold)a[u]=!1;else{this.diff_cleanupSemanticLossless(d);for(var m,g=0,v=0;v<t[u].diffs.length;v++){var y=t[u].diffs[v];y[0]!==r&&(m=this.diff_xIndex(d,g)),y[0]===n?i=i.substring(0,l+m)+y[1]+i.substring(l+m):y[0]===e&&(i=i.substring(0,l+m)+i.substring(l+this.diff_xIndex(d,g+y[1].length))),y[0]!==e&&(g+=y[1].length)}}}}}return i=i.substring(o.length,i.length-o.length),[i,a]},t.prototype.patch_addPadding=function(t){for(var e=this.Patch_Margin,n="",i=1;e>=i;i++)n+=String.fromCharCode(i);for(var i=0;i<t.length;i++)t[i].start1+=e,t[i].start2+=e;var o=t[0],s=o.diffs;if(0==s.length||s[0][0]!=r)s.unshift([r,n]),o.start1-=e,o.start2-=e,o.length1+=e,o.length2+=e;else if(e>s[0][1].length){var a=e-s[0][1].length;s[0][1]=n.substring(s[0][1].length)+s[0][1],o.start1-=a,o.start2-=a,o.length1+=a,o.length2+=a}if(o=t[t.length-1],s=o.diffs,0==s.length||s[s.length-1][0]!=r)s.push([r,n]),o.length1+=e,o.length2+=e;else if(e>s[s.length-1][1].length){var a=e-s[s.length-1][1].length;s[s.length-1][1]+=n.substring(0,a),o.length1+=a,o.length2+=a}return n},t.prototype.patch_splitMax=function(i){for(var o=this.Match_MaxBits,s=0;s<i.length;s++)if(!(i[s].length1<=o)){var a=i[s];i.splice(s--,1);for(var u=a.start1,l=a.start2,c="";0!==a.diffs.length;){var f=new t.patch_obj,h=!0;for(f.start1=u-c.length,f.start2=l-c.length,""!==c&&(f.length1=f.length2=c.length,f.diffs.push([r,c]));0!==a.diffs.length&&f.length1<o-this.Patch_Margin;){var p=a.diffs[0][0],d=a.diffs[0][1];p===n?(f.length2+=d.length,l+=d.length,f.diffs.push(a.diffs.shift()),h=!1):p===e&&1==f.diffs.length&&f.diffs[0][0]==r&&d.length>2*o?(f.length1+=d.length,u+=d.length,h=!1,f.diffs.push([p,d]),a.diffs.shift()):(d=d.substring(0,o-f.length1-this.Patch_Margin),f.length1+=d.length,u+=d.length,p===r?(f.length2+=d.length,l+=d.length):h=!1,f.diffs.push([p,d]),d==a.diffs[0][1]?a.diffs.shift():a.diffs[0][1]=a.diffs[0][1].substring(d.length))}c=this.diff_text2(f.diffs),c=c.substring(c.length-this.Patch_Margin);var m=this.diff_text1(a.diffs).substring(0,this.Patch_Margin);""!==m&&(f.length1+=m.length,f.length2+=m.length,0!==f.diffs.length&&f.diffs[f.diffs.length-1][0]===r?f.diffs[f.diffs.length-1][1]+=m:f.diffs.push([r,m])),h||i.splice(++s,0,f)}}},t.prototype.patch_toText=function(t){for(var e=[],n=0;n<t.length;n++)e[n]=t[n];return e.join("")},t.prototype.patch_fromText=function(i){var o=[];if(!i)return o;for(var s=i.split("\n"),a=0,u=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;a<s.length;){var l=s[a].match(u);if(!l)throw new Error("Invalid patch string: "+s[a]);var c=new t.patch_obj;for(o.push(c),c.start1=parseInt(l[1],10),""===l[2]?(c.start1--,c.length1=1):"0"==l[2]?c.length1=0:(c.start1--,c.length1=parseInt(l[2],10)),c.start2=parseInt(l[3],10),""===l[4]?(c.start2--,c.length2=1):"0"==l[4]?c.length2=0:(c.start2--,c.length2=parseInt(l[4],10)),a++;a<s.length;){var f=s[a].charAt(0);try{var h=decodeURI(s[a].substring(1))}catch(p){throw new Error("Illegal escape in patch_fromText: "+h)}if("-"==f)c.diffs.push([e,h]);else if("+"==f)c.diffs.push([n,h]);else if(" "==f)c.diffs.push([r,h]);else{if("@"==f)break;if(""!==f)throw new Error('Invalid patch mode "'+f+'" in: '+h)}a++}}return o},t.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0},t.patch_obj.prototype.toString=function(){var t,i;t=0===this.length1?this.start1+",0":1==this.length1?this.start1+1:this.start1+1+","+this.length1,i=0===this.length2?this.start2+",0":1==this.length2?this.start2+1:this.start2+1+","+this.length2;for(var o,s=["@@ -"+t+" +"+i+" @@\n"],a=0;a<this.diffs.length;a++){switch(this.diffs[a][0]){case n:o="+";break;case e:o="-";break;case r:o=" "}s[a+1]=o+encodeURI(this.diffs[a][1])+"\n"}return s.join("").replace(/%20/g," ")},this.diff_match_patch=t,this.DIFF_DELETE=e,this.DIFF_INSERT=n,this.DIFF_EQUAL=r},{}],13:[function(t,e){var n,r,i,o,s,a,u,l,c,f,h,p,d,m,g=[].slice,v={}.hasOwnProperty,y=function(t,e){function n(){this.constructor=t}for(var r in e)v.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};m=t("lodash"),r=t("eventemitter2"),n=t("tandem-core/delta"),null!=r.EventEmitter2&&(r=r.EventEmitter2),d=function(){var t;return t=1<=arguments.length?g.call(arguments,0):[],null!=("undefined"!=typeof console&&null!==console?console.warn:void 0)?m.isFunction(console.warn.apply)?console.warn.apply(console,t):console.warn(t):void 0},o=function(){var t=this;return this.adapter.listen(i.routes.UPDATE,function(e){return t.ready?e.fileId!==t.fileId?d("Got update for other file",e.fileId):t.remoteUpdate(e.delta,e.version)?void 0:(d("Remote update failed, requesting resync"),c.call(t)):void 0})},s=function(){var t=this;return this.adapter.on(this.adapter.constructor.events.READY,function(){return t.emit(i.events.HEALTH,i.health.HEALTHY,t.health),f.call(t)}).on(this.adapter.constructor.events.RECONNECT,function(){return f.call(t)}).on(this.adapter.constructor.events.RECONNECTING,function(e,n){return 1===n?t.emit(i.events.HEALTH,i.health.ERROR,t.health):void 0}).on(this.adapter.constructor.events.DISCONNECT,function(){return t.emit(i.events.HEALTH,i.health.ERROR,t.health)}).on(this.adapter.constructor.events.ERROR,function(){var e;return e=1<=arguments.length?g.call(arguments,0):[],t.emit.apply(t,[i.events.ERROR].concat(g.call(e))),t.emit(i.events.HEALTH,i.health.ERROR,t.health)}),this.on(i.events.HEALTH,function(e){return t.health=e})},a=function(){return o.call(this),s.call(this)},u=function(t){var e,r;return r=n.makeDelta(t.head),e=r.decompose(this.arrived),this.remoteUpdate(e,t.version),this.emit(i.events.HEALTH,i.health.HEALTHY,this.health)},l=function(t){return this.version=t.version,this.arrived=this.arrived.compose(this.inFlight),this.inFlight=n.getIdentity(this.arrived.endLength),sendUpdateIfReady.call(this)},c=function(t){var e=this;return this.emit(i.events.HEALTH,i.health.WARNING,this.health),this.send(i.routes.RESYNC,{},function(n){return u.call(e,n),null!=t?t():void 0})},f=function(){var t=this;return this.send(i.routes.SYNC,{version:this.version},function(e){return t.emit(i.events.HEALTH,i.health.HEALTHY,t.health),e.resync?(t.ready=!1,d("Sync requesting resync"),u.call(t,e)):t.remoteUpdate(e.delta,e.version)?p.call(t,e.delta,e.version,!1):(d("Remote update failed on sync, requesting resync"),c.call(t,function(){return p.call(t,e.delta,e.version,!0)}))},!0)},h=function(){var t,e,r,o=this;return e={delta:this.inFlight,version:this.version},r=setTimeout(function(){return d("Update taking over 10s to respond"),o.emit(i.events.HEALTH,i.health.WARNING,o.health)},1e4),t=this.updateCallbacks,this.updateCallbacks=[],this.send(i.routes.UPDATE,e,function(s){return clearTimeout(r),o.health!==i.health.HEALTHY&&o.emit(i.events.HEALTH,i.health.HEALTHY,o.health),s.resync?(d("Update requesting resync",o.id,e,s),u.call(o,s),h.call(o)):(o.version=s.version,o.arrived=o.arrived.compose(o.inFlight),o.inFlight=n.getIdentity(o.arrived.endLength),m.each(t,function(t){return t.call(o,null,o.arrived)}),o.sendIfReady())})},p=function(t,e,n){return null==n&&(n=!1),this.ready=!0,n&&!this.inFlight.isIdentity()&&h.call(this),this.emit(i.events.READY,t,e)},i=function(t){function e(t,r,i){this.fileId=t,this.adapter=r,null==i&&(i={}),this.id=m.uniqueId("file-"),this.health=e.health.WARNING,this.ready=!1,this.version=i.version||0,this.arrived=i.head||n.getInitial(""),this.inFlight=n.getIdentity(this.arrived.endLength),this.inLine=n.getIdentity(this.arrived.endLength),this.updateCallbacks=[],this.adapter.ready&&(this.emit(e.events.HEALTH,e.health.HEALTHY,this.health),f.call(this)),a.call(this)}return y(e,t),e.events={ERROR:"file-error",HEALTH:"file-health",READY:"file-ready",UPDATE:"file-update"},e.health={HEALTHY:"healthy",WARNING:"warning",ERROR:"error"},e.routes={BROADCAST:"broadcast",RESYNC:"ot/resync",SYNC:"ot/sync",UPDATE:"ot/update"},e.prototype.broadcast=function(t,n,r){return n=m.clone(n),n.type=t,this.adapter.send(e.routes.BROADCAST,n,r)},e.prototype.close=function(){return this.adapter.close(),this.removeAllListeners()},e.prototype.isDirty=function(){return!this.inFlight.isIdentity()||!this.inLine.isIdentity()},e.prototype.remoteUpdate=function(t,r){var i,o;return this.version=r,t=n.makeDelta(t),this.arrived.canCompose(t)?(this.arrived=this.arrived.compose(t),i=t.transform(this.inFlight,!1),o=i.transform(this.inLine,!1),this.inFlight=this.inFlight.transform(t,!0),this.inLine=this.inLine.transform(i,!0),this.emit(e.events.UPDATE,o),!0):!1},e.prototype.update=function(t,n){return this.inLine.canCompose(t)?(this.inLine=this.inLine.compose(t),this.sendIfReady(n)):(this.emit(e.events.ERROR,"Cannot compose inLine with local delta",this.inLine,t),d("Local update error, attempting resync",this.id,this.inLine,this.delta),c.call(this))},e.prototype.send=function(t,n,r,i){var o=this;return null==r&&(r=null),null==i&&(i=!1),null!=r?this.adapter.send(t,n,function(t){return null!=t.error?o.emit(e.events.ERROR,t.error):null!=r?r(t):void 0},i):this.adapter.send(t,n)},e.prototype.sendIfReady=function(t){return null!=t&&this.updateCallbacks.push(t),this.inFlight.isIdentity()&&!this.inLine.isIdentity()?(this.inFlight=this.inLine,this.inLine=n.getIdentity(this.inFlight.endLength),h.call(this),!0):!1},e.prototype.transform=function(){},e}(r),e.exports=i},{eventemitter2:!1,lodash:!1,"tandem-core/delta":9}],14:[function(t,e){var n,r,i,o={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a=[].slice;i=t("async"),n=t("eventemitter2"),null!=n.EventEmitter2&&(n=n.EventEmitter2),r=function(t){function e(){this.ready=!1,this.sendQueue=[]}return s(e,t),e.events={DISCONNECT:"adapter-disconnect",ERROR:"adapter-error",READY:"adapter-ready",RECONNECT:"adapter-reconnect",RECONNECTING:"adapter-reconnecting"},e.prototype.close=function(){return this.removeAllListeners()},e.prototype.listen=function(){return console.warn("Should be overwritten by descendant"),this},e.prototype.send=function(t,e,n,r){return null==r&&(r=!1),this.ready?this._send(t,e,n,r):r?this.sendQueue.unshift([t,e,n]):this.sendQueue.push([t,e,n])},e.prototype.setReady=function(){var t=this;return this.emit(e.events.READY),i.until(function(){return 0===t.sendQueue.length},function(e){var n,r,i,o;return n=t.sendQueue.shift(),i=n[0],r=n[1],o=n[2],t._send(i,r,function(){var n;return n=1<=arguments.length?a.call(arguments,0):[],null!=o&&o.apply(t,n),e()})},function(){return t.ready=!0})},e.prototype._send=function(){return console.warn("Should be overwritten by descendant")},e}(n),e.exports=r},{async:!1,eventemitter2:!1}],15:[function(t,e){var n,r,i,o;o=t("lodash"),i=t("./file"),n=t("./network/adapter"),r=function(){function t(e,n){this.endpointUrl=e,this.options=null!=n?n:{},n=o.pick(this.options,o.keys(t.DEFAULTS)),this.settings=o.extend({},t.DEFAULTS,n),null==this.settings.userId&&(this.settings.userId="anonymous-"+o.random(1e6))}return t.DEFAULTS={userId:null,network:n},t.prototype.open=function(t,e,n){return this.adapter=o.isFunction(this.settings.network)?new this.settings.network(this.endpointUrl,t,this.settings.userId,e,this.options):this.settings.network,new i(t,this.adapter,n)},t}(),e.exports=r},{"./file":13,"./network/adapter":14,lodash:!1}]},{},[1])(1)}),define("util/tandem_adapter",["lodash","./inherits","tandem"],function(t,e,n){function r(t,e){this._room=t,this._name=e,n.Network.Adapter.call(this),this.setReady(),this.err=null,this.context=null}return e(r,n.Network.Adapter),r.prototype.listen=function(e,r){var i=function(e){t.isNull(r)||t.isUndefined(r)||r.call(this,e)};return this._room._on(this._name,n.File.routes,e,i),this},r.prototype._send=function(t,e,n){var r=this,i=function(t,e,i){r.err=t,r.context=i,e.error=t,n(e)},o={text:this._name,packet:e,fileId:this._name};this._room._request(t,o,i)},r.prototype.setTandemFile=function(t){this.file=t},r.prototype.getError=function(){var t=this.err;return this.err=null,t},r.prototype.getContext=function(){var t=this.context;return this.context=null,t},r}),define("platform/text",["eventemitter2","lodash","async","util/inherits","util/resolver","util/validation","common/key_name","platform/watch_registry","platform/query","common/errors","util/tandem_adapter","tandem"],function(t,e,n,r,i,o,s,a,Query,u,l,c){function f(t,n){var r=new l(t,n);this.tandem=new c.Client("none",{network:r}),this.name=n,this.file=this.tandem.open(this.name),r.setTandemFile(this.file);var i=this;this.file.on("file-update",function(t){i.emit("update",t);var n=i._deltaToApiOps(t);e.each(n,function(t){t instanceof f._InsertOp?i.emit("insert",t):t instanceof f._DeleteOp?i.emit("delete",t):t instanceof f._FormatOp&&i.emit("format",t)})})}function h(t){return e.isNull(t)||e.isUndefined(t)?"Text#insert cannot be passed null or undefined.":void 0}return r(f,t),f.COMMANDS={insert:"INSERT","delete":"DELETE",format:"FORMAT",update:"UPDATE"},f.DEFAULT_COMMAND_OPTIONS={bubble:!1,local:!1},f.prototype._sanitizeExpire=function(t){return e.has(t,"expire")?((e.isNull(t.expire)||e.isUndefined(t.expire))&&delete t.expire,t):t},f.prototype._resolveOptionsAndCallback=function(t,n){return e.isPlainObject(t)?t=e.defaults(t,f.DEFAULT_COMMAND_OPTIONS):(n=n||t,t={}),t=this._sanitizeExpire(t),{options:t,cb:n}},f._InsertOp=function(t,e,n){this.index=t,this.text=e,this.attributes=n},f._DeleteOp=function(t,e){this.index=t,this.length=e},f._FormatOp=function(t,e,n){this.index=t,this.length=e,this.attributes=n},f.prototype._deltaToApiOps=function(t){var n=0,r=0,i=0,o=[],s=[],a=[],u=e.each(t.ops,function(u){var l,h;if(c.Op.isInsert(u))l=new f._InsertOp(r,u.value,e.clone(u.attributes)),h=e.sortedIndex(o,l,"index"),o.splice(h,0,l);else if(c.Op.isRetain(u)){u.start>n?(l=new f._DeleteOp(n,u.start-n),h=e.sortedIndex(s,l,"index"),s.splice(h,0,l)):i==t.ops.length-1&&u.end<t.startLength&&(l=new f._DeleteOp(u.end,t.startLength-u.end),h=e.sortedIndex(s,l,"index"),s.splice(h,0,l));var p=u.attributes;e.isNull(p)||e.isUndefined(p)||e.isEmpty(p)||(l=new f._FormatOp(u.start,u.getLength(),e.clone(p)),h=e.sortedIndex(a,l,"index"),a.splice(h,0,l)),n=u.end}r+=u.getLength(),i++});return 0===u.length&&t.startLength>0&&0===t.endLength&&u.push(new f._DeleteOp(0,t.startLength-t.endLength)),a.concat(s).concat(o)},f.prototype._apiOpToDelta=function(t,e){var n=this.file,r=n.arrived.compose(n.inFlight).compose(n.inLine);return t===f.COMMANDS.insert?c.Delta.makeInsertDelta(r.endLength,e.index,e.text,e.attributes):t===f.COMMANDS["delete"]?c.Delta.makeDeleteDelta(r.endLength,e.index,e.length):t===f.COMMANDS.format?c.Delta.makeRetainDelta(r.endLength,e.index,e.length,e.attributes):void 0},f.prototype._wrapClientCallback=function(t){var e=this,n=function(n,r){var i=e.tandem.adapter.getContext();return n?t(n,r,i):(n=e.tandem.adapter.getError(),t(n,r,i),void 0)};return n},f.prototype._handleOperation=function(t,n,r,i){var o=this._resolveOptionsAndCallback(r,i);r=o.options,e.isNull(o.cb)||e.isUndefined(o.cb)||(i=this._wrapClientCallback(o.cb));var s=h(n);if(s)throw new Error(s);var a;a=t!=f.COMMANDS.update?this._apiOpToDelta(t,n):n,this.file.update(a,i)},f.prototype.get=function(t){t(null,c.Delta.makeDelta(this.file.arrived),null)},f.prototype.insert=function(t,e,n){this._handleOperation(f.COMMANDS.insert,t,e,n)},f.prototype.del=function(t,e,n){this._handleOperation(f.COMMANDS["delete"],t,e,n)},f.prototype["delete"]=f.prototype.del,f.prototype.format=function(t,e,n){this._handleOperation(f.COMMANDS.format,t,e,n)},f.prototype.update=function(t,e,n){this._handleOperation(f.COMMANDS.update,t,e,n)},f}),define("platform/key",["lodash","async","util/resolver","util/validation","util/deprecate","common/key_name","platform/watch_registry","platform/query","platform/text","common/errors"],function(t,e,n,r,i,o,s,Query,a,u){function Key(t,e){this._room=t,this.name=l(e),this._watchRegistry=new s}function l(t){var e=o.clean(t);if(null===e)throw new u.KeyNameError("Invalid key name: "+t);return e}function c(t,e){return r.optionalCallback(e)?void 0:"Key#"+t+" requires the callback to be a function if it is provided"}return Key.COMMANDS={get:"GET",set:"SET",remove:"REMOVE",add:"ADD"},Key.VALID_EVENTS=["set","remove","add"],Key.DEFAULT_COMMAND_OPTIONS={bubble:!0,local:!0},Key.DEFAULT_SET_OPTIONS={overwrite:!0},Key._Resolver=n,Key.prototype._childName=function(t){return this.name+l(t)},Key.prototype._parentName=function(){var t=this.name.split("/").slice(1,-1);return"/"+t.join("/")},Key.prototype.key=function(t){return new Key(this._room,this._childName(t))},Key.prototype.text=function(t){return new a(this._room,this._childName(t))},Key.prototype.parent=function(){var t=this._parentName();return this.name==t?this:new Key(this._room,t)},Key.prototype.room=function(){return this._room},Key.prototype._sanitizeExpire=function(e){return t.has(e,"expire")?((null===e.expire||void 0===e.expire)&&delete e.expire,e):e},Key.prototype._resolveOptionsAndCallback=function(e,n){return t.isPlainObject(e)?e=t.defaults(e,Key.DEFAULT_COMMAND_OPTIONS):(n=n||e,e=Key.DEFAULT_COMMAND_OPTIONS),e=this._sanitizeExpire(e),{options:e,cb:n}},Key.prototype._cascade=function(e){e=t.isArray(e)?e:[e],e=t.map(e,function(t){return t instanceof Key?t.name:new Error("non-key")});var n=t.any(e,function(t){return t instanceof Error});return n?new Error("Non-key passed to cascade"):e},Key.prototype.set=function(e,n,r){if(t.isNull(e)||t.isUndefined(e))throw new Error("Key#set cannot be passed null or undefined. Use remove instead.");var i=this._resolveOptionsAndCallback(n,r),o=c("set",i.cb);if(o)throw new Error(o);var s=new Key._Resolver(i.cb,this,["value","context"]);if(n=i.options,r=s.cb,n=t.defaults(n,Key.DEFAULT_SET_OPTIONS),n.cascade&&(n.cascade=this._cascade(n.cascade),n.cascade instanceof Error))throw n.cascade;var a={key:this.name,value:e,options:n};return this._room._request(Key.COMMANDS.set,a,r),s.promise},Key.prototype.add=function(e,n,r){var i=this._resolveOptionsAndCallback(n,r),o=c("add",i.cb);if(o)throw new Error(o);var s=new Key._Resolver(i.cb,this,["value","context"]);if(n=i.options,r=s.cb,t.isNull(e)||t.isUndefined(e))throw new Error("Key#add cannot be passed null or undefined.");if(n.cascade&&(n.cascade=this._cascade(n.cascade),n.cascade instanceof Error))throw new Error(n.cascade);var a={key:this.name,value:e,options:n};return this._room._request(Key.COMMANDS.add,a,r),s.promise},Key.prototype.get=function(t){var e=c("get",t);if(e)throw new Error(e);var n=new Key._Resolver(t,this,["value","context"]);t=n.cb;var r={key:this.name};return this._room._request(Key.COMMANDS.get,r,t),n.promise},Key.prototype.remove=function(t,e){var n=this._resolveOptionsAndCallback(t,e),r=c("remove",n.cb);if(r)throw new Error(r);var i=new Key._Resolver(n.cb,this,["value","context"]);t=n.options,e=i.cb;var o={key:this.name,options:t};return this._room._request(Key.COMMANDS.remove,o,e),i.promise},Key.prototype.on=function(t,e,n){this._room._on(this.name,Key.VALID_EVENTS,t,e,n)},Key.prototype.off=function(t,e,n){this._room._off(this.name,Key.VALID_EVENTS,t,e,n)},Key.prototype.query=function(t,e){return new Query(this,t,e)},Key.prototype.watch=function(e,n){if(i.warn({name:"Key#watch",date:new Date(2014,3,1),url:"https://developers.goinstant.com/v1/javascript_api/key/watch.html"}),!t.isFunction(e))throw new Error("Key#watch listener must be a function");if(!r.optionalCallback(n))throw new Error("Key#watch optional callback must be a function");var o=this._watchRegistry.add(e),s={local:!0,bubble:!0},a=this;a.get(function(e){if(!e){var r=Array.prototype.slice.call(arguments,1);o.apply(this,r),t.each(Key.VALID_EVENTS,function(t){a.on(t,s,o)})}n&&n(e)})},Key.prototype.unwatch=function(e,n){i.warn({name:"Key#unwatch",date:new Date(2014,3,1),url:"https://developers.goinstant.com/v1/javascript_api/key/unwatch.html"});var o;if(r.optionalCallback(e)?r.optionalCallback(n)||(o=new Error("Key#unwatch optional callback must be a function")):o=new Error("Key#unwatch optional listener must be a function"),o)return r.throwOrCallback(o,n);var s;if(t.isFunction(e)){var a=this._watchRegistry.remove(e);if(!a)return o=new Error("Key#unwatch listener is not a watch function"),r.throwOrCallback(o,n);s=[a]}else s=this._watchRegistry.clear();var u=this;t.each(s,function(e){t.each(Key.VALID_EVENTS,function(t){u.off(t,e)})}),n&&n()},Key.prototype.equals=function(t){return t instanceof this.constructor?this.name!==t.name?!1:this._room.equals(t._room)?!0:!1:!1},Key}),define("platform/room",["lodash","async","util/resolver","platform/channel","platform/key","platform/text","common/constants","common/errors","util/validation"],function(t,e,n,Channel,Key,r,i,o,s){function Room(e,n){if(!t.isString(n)||!i.NAME_REGEX.test(n))throw new Error(f+" Invalid room: "+n);this.name=n,this._connection=e,this.users=this.key("/.users")}var a=o.NotMemberError,u=o.NotConnectedError,l=s.throwOrCallback,c="You must connect to GoInstant before you can perform operations on a key or room",f="Room"+i.NAME_RULES_ENGLISH;Room.VALID_EVENTS=["join","leave"],Room.COMMANDS={join:"JOIN",leave:"LEAVE"};var h={local:!1,bubble:!1},p={local:!0,bubble:!1},d=[!0,!1],m=["local","bubble","listener","lastValue"];return Room._Resolver=n,Room.prototype.connection=function(){return this._connection},Room.prototype.join=function(n,r,i){function o(t){var e=s.self();e.get(function(e,n){return e?t(e):(t(null,s,n),void 0)})}var s=this;if(t.isFunction(r)&&(i=r,r=null),t.isFunction(i)&&!t.isPlainObject(n)&&!t.isNull(n))throw new Error("userObject must be an object");if(t.isFunction(n)&&(i=n,n=null),t.isUndefined(i)&&(i=function(){}),r&&!t.isPlainObject(r))throw new Error("opts must be an object");var a=new Room._Resolver(i,s,["room","user"]);i=a.cb;var u={key:"/.users",options:p};if(r&&t.has(r,"visible")){if(!t.isBoolean(r.visible))throw new Error("opts.visible must be a boolean");u.options=t.merge({visible:r.visible},u.options)}return this._request(Room.COMMANDS.join,u,function(r){if(r)return i(r);if(s._connection._joined(s),n){var a=s.key("/.users/"+s._connection._user.id);e.each(t.keys(n),function(t,e){a.key(t).set(n[t],e)},function(t){t?s.leave(function(){return i(t)}):o(i)})}else o(i)}),a.promise},Room.prototype.leave=function(e){var n=this;if(e||(e=function(){}),e&&!t.isFunction(e))throw new Error("callback must be a function");var r=new Room._Resolver(e,n);if(e=r.cb,!this._connection._socket)return l(new u(c),e);var i={key:"/.users",options:p};return this._request(Room.COMMANDS.leave,i,function(r,i,o){if(r)return e(r);if(n._connection._left(n),i){var s=t.cloneDeep(o||{});s.context=t.cloneDeep(o||{}),s.options={bubble:!1,local:!0},s.local=!0,n._connection._registry.emit(s)}n._off(),e()}),r.promise},Room.prototype.joined=function(){return this._connection._isJoined(this)},Room.prototype.user=function(e){if(!t.isString(e))throw new o.ArgumentError("You must pass a string for a userId");return this.key("/.users/"+e)},Room.prototype.self=function(){if(!this._connection._socket||!this._connection._user)throw new u(c);return this.user(this._connection._user.id)},Room.prototype.on=function(t,e,n){this._on("/.users",Room.VALID_EVENTS,t,e,n)},Room.prototype.off=function(t,e,n){this._off("/.users",Room.VALID_EVENTS,t,e,n)},Room.prototype.key=function(t){return new Key(this,t)},Room.prototype.text=function(t){return new r(this,t)},Room.prototype.channel=function(t){return new Channel(this,t)},Room.prototype._request=function(e,n,r){function i(t){return function(e,n,r){r&&(r.value=null),t(e,null,r)
}}if(!this._connection._socket)return l(new u(c),r);var o=["JOIN","LEAVE"],s=t.pluck(this._connection._joinedRooms,"name");if(!t.contains(o,e)&&!t.contains(s,this.name)){var f='You must join the room "'+this.name+'" '+"before you can perform any operations on this key";return l(new a(f),r)}n.room=this.name;var h=n.options&&n.options.lastValue;"REMOVE"!==e||h||(r=i(r)),n.options&&delete n.options.lastValue,this._connection._request(e,n,r)},Room.prototype._on=function(e,n,r,i,o){function a(t){if(t.__wrapperFn)return t.__wrapperFn;var e=function(e,n){n&&(n.value=null),t(null,n)};return t.__wrapperFn=e,e}var u={};t.isFunction(i)?(o=i,i=null):i&&(i.listener&&(o=i.listener),u.local=i.local,u.bubble=i.bubble,i.lastValue&&(u.lastValue=!0)),t.defaults(u,h);var l;if(t.isString(r)?t.isString(e)?s.isFunction(o)?s.contained(n,r)?i&&!s.subset(t.keys(i),m)?l="on: options can only contain keys: "+m.join(",")+" but was passed keys: "+t.keys(i):s.subset(t.values(u),d)||(l="on: options.local, options.bubble, and options.lastValue must be booleans."):l='on: event passed: "'+r+'"'+" is not one of "+n.join(", "):l="on: listener must be a function":l="on: key name passed must be a string":l="on: command passed must be a string",l)throw new Error(l);r=r.toUpperCase(),"REMOVE"!==r||u.lastValue||(o=a(o)),this._connection._on(this.name,e,r,u,o)},Room.prototype._off=function(e,n,r,i,o){t.isUndefined(r)&&(r=null),t.isUndefined(i)&&(i=null),t.isUndefined(o)&&(o=null);var a=null;t.isFunction(i)?(o=i,i=null):t.isObject(i)&&(i.listener&&(o=i.listener),("local"in i||"bubble"in i)&&(a={},"local"in i&&(a.local=i.local),"bubble"in i&&(a.bubble=i.bubble)));var u,l=s.subset(t.values(a),d),c=s.contained(n,r);if(r&&!t.isString(r)?u="off: optional command must be a string":s.optionalCallback(o)?!r&&o?u="off: requires command if listener is passed":r&&!c?u='off: command passed: "'+r+'" is not one of '+n.join(", "):i&&!s.subset(t.keys(i),m)?u="off: options can only contain keys: "+m.join(", ")+" but was passed keys: "+t.keys(i):a&&!l&&(u="off: options.local and options.bubble must be booleans."):u="off: optional listener must be a function",u)throw new Error(u);r&&(r=r.toUpperCase()),o&&o.__wrapperFn&&(o=o.__wrapperFn),this._connection._off(this.name,e,r,i,o)},Room.prototype.equals=function(t){return t instanceof this.constructor?this.name===t.name:!1},Room}),define("platform/registry",["eventemitter2","lodash","common/obj"],function(t,e,n){function r(){this._rooms={}}function i(t,e,n){return t.length>n.length&&t.substring(0,n.length)==n}function o(t,e,n){if(t&&e){n.removeListener(t,e);var r=0===n.listeners(t).length;return r}return t?n.removeAllListeners(t):n.removeAllListeners(),!0}function s(t){return e.all(t._events,function(t){return!t||e.isArray(t)&&0===t.length})}var a=["JOIN","LEAVE"],u=["command","key","addedKey","value","room","userId","local","overwritten","expired","expire","cascaded","cascade"];return r.prototype.on=function(t,e){var n=t.room,r=t.key,i=t.opts,o=this._findEmitter(n,r,i),s=t.command;o.on(s,e)},r.prototype.off=function(t,e){var n=t.room,r=t.key,i=!1;return i=r?this._offKey(t,e):this._offRoom(n),this._deleteEmptyEmitter(n,r),i},r.prototype.emit=function(t){var r=this._findSubscribingEmitters(t);if(e.contains(a,t.command))return e.each(r,function(e){e.emit(t.command,t.value)}),void 0;var i=this._findChildEmitters(t);e.each(i,function(r){var i=e.pick(t,u);if(i.key=r.name,i.targetKey=t.key,i.currentKey=r.name,i.bubble=!1,"REMOVE"===i.command)return i.value=null,r.emit(i.command,i.value,i);var o=r.name.replace(i.targetKey,""),s=n.pick(i.value,o);return void 0===s?(i.command="REMOVE",i.value=null,r.emit(i.command,i.value,i)):(i.value=s,r.emit(i.command,i.value,i),void 0)}),e.each(r,function(n){var r=e.pick(t,u);r.targetKey=t.key,r.currentKey=n.name,r.bubble=r.currentKey!==t.key,n.emit(r.command,r.value,r)})},r.prototype._findEmitters=function(t,e){this._rooms[t]||(this._rooms[t]={});var n=this._rooms[t],r=n[e];return r?[r.bubble.local,r.bubble.remote,r.noBubble.local,r.noBubble.remote]:[]},r.prototype._findEmitter=function(n,r,i){this._rooms[n]||(this._rooms[n]={});var o=this._rooms[n];o[r]||(o[r]={name:r,bubble:{local:new t,remote:new t},noBubble:{local:new t,remote:new t}},e.each(this._findEmitters(n,r),function(t){t.name=r}));var s=o[r];return i.local&&i.bubble?s.bubble.local:i.bubble?s.bubble.remote:i.local?s.noBubble.local:s.noBubble.remote},r.prototype._findSubscribingEmitters=function(t){var e=t.room,n=t.key;this._rooms[e]||(this._rooms[e]={});var r=this._rooms[e],i=[];if(t.options.bubble){var o=this._findBubblingEmitters(t);i=i.concat(o)}var s=r[n];return s?(t.local?(i.unshift(s.noBubble.local),i.unshift(s.bubble.local)):(i.unshift(s.noBubble.remote),i.unshift(s.noBubble.local),i.unshift(s.bubble.remote),i.unshift(s.bubble.local)),i):i},r.prototype._findBubblingEmitters=function(t){var n=t.room,r=t.key,o=this._rooms[n],s=e.filter(o,e.partial(i,r));s=s.sort(function(t,e){return t.name.length<e.name.length});var a=[];return e.each(s,function(e){t.local?a.push(e.bubble.local):(a.push(e.bubble.remote),a.push(e.bubble.local))}),a},r.prototype._findChildEmitters=function(t){var n=t.room,r=this._rooms[n],i=t.addedKey?t.addedKey:t.key,o=e.filter(r,function(t,e){var n=e.substring(0,i.length);return n===i&&"/"===e[i.length]});o=o.sort(function(t,e){return t.length>e.length?1:e.length>t.length?-1:0});var s=[];return e.each(o,function(e){t.local?(s.unshift(e.noBubble.local),s.unshift(e.bubble.local)):(s.unshift(e.noBubble.remote),s.unshift(e.noBubble.local),s.unshift(e.bubble.remote),s.unshift(e.bubble.local))}),s},r.prototype._offRoom=function(t){var n=this._rooms[t];return e.each(n,function(t){e.each([t.bubble.local,t.bubble.remote,t.noBubble.local,t.noBubble.remote],e.partial(o,null,null))}),delete this._rooms[t],!0},r.prototype._offKey=function(t,n){var r=t.room,i=t.command,s=t.key,a=t.opts;if(a){var u=this._findEmitter(r,s,a);return o(i,n,u)}var l=this._findEmitters(r,s),c=e.map(l,e.partial(o,i,n));return e.all(c)},r.prototype._deleteEmptyEmitter=function(t,n){if(n){var r=this._findEmitters(t,n);if(r){var i=e.all(r,s);if(i){var o=this._rooms[t];delete o[n],0===e.size(this._rooms)&&delete this._rooms[t]}}}},r}),define("util/timeouts",["eventemitter2","lodash","global/window"],function(t,e,n){function r(n){this._emitter=new t,this._timeout=n,this._timer=null,this._timeouts=[],e.bindAll(this,"_handleExpiry")}return r.prototype.add=function(t){this._timeouts.push({item:t,when:+new Date+this._timeout}),1===this._timeouts.length&&this._start()},r.prototype.clear=function(t){var n=e.findIndex(this._timeouts,{item:t});if(-1!==n){var r=this._timeouts.splice(n,1)[0];this._timeouts.length<=0?this._stop():0===n&&this._timeouts[0].when!==r.when&&(this._stop(),this._start())}},r.prototype.on=function(t,e){this._emitter.on(t,e)},r.prototype.off=function(t,e){this._emitter.off(t,e)},r.prototype._start=function(){var t=+new Date,e=this._timeouts[0].when-t;this._timer=n.setTimeout(this._handleExpiry,e)},r.prototype._stop=function(){n.clearTimeout(this._timer),this._timer=null},r.prototype._handleExpiry=function(){for(var t=this._timeouts[0].when;this._timeouts.length>0&&this._timeouts[0].when===t;){var e=this._timeouts.shift();this._emitter.emit("expiry",e.item)}this._timeouts.length>0&&this._start()},r}),define("platform/room_collection",["lodash","common/errors","util/resolver"],function(t,e,n){function r(t){this._connection=t}var i=e.NotConnectedError,o="You must connect to Platform before you can perform operations on rooms";return r._Resolver=n,r.prototype.get=function(e){if(!this._connection._socket)return e(new i(o));if(e&&!t.isFunction(e))throw new Error("A callback if provided, must be a function.");var n=new r._Resolver(e,this);e=n.cb;var s=this;return this._connection._request("ROOMS",{},function(n,r){if(n)return e(n);var i=[];t.each(r,function(t){i.push(s._connection.room(t))}),e(null,i)}),n.promise},r}),"undefined"==typeof define&&module&&module.exports)var define=require("../lib/common_loader")(module);if(define("common/path",["lodash"],function(t){function e(t){return""===t[0]&&t.shift(),t}function n(t){return""===t[0]}var r={};return r.rInsert=function(t,r,i){var o=t.split("/"),s=n(o);o=e(o),i||(i={});var a=[];i.front&&a.push(r);for(var u=0;u<o.length;++u){a.push(o[u]);var l=u===o.length-1;if(l&&!i.rear)break;a.push(r)}return s&&a.unshift(""),a.join("/")},r.rStrip=function(e,n){var r=e.split("/"),i=t.filter(r,function(t){return t!=n});return i.join("/")},r}),"undefined"==typeof define&&module&&module.exports)var define=require("../lib/common_loader")(module);if(define("common/cascade",["common/obj","lodash","common/path"],function(t,e,n){var r={};return r.get=function(r,i){function o(t){return e.map(t,function(t){return n.rInsert(t,".value",{front:!0})})}var s,a=[],u=[],l=[];u.push(i);do{var c=u.shift();if(c){if(s=t.pick(r,c)){var f=s[".meta"];if(f){var h=f.cascade;e.isString(h)&&(h=[h]),h=o(h),u=e.union(u,h),u=e.difference(u,l),a=e.union(a,h),l.push(c)}}}else s=void 0}while(s);return e.without(a,i)},r}),"undefined"==typeof define&&module&&module.exports)var define=require("../lib/common_loader")(module);define("common/command_operator",["lodash","common/obj","common/path","common/cascade"],function(t,e,n,r){function i(){for(var e=[],n=0;n<arguments.length;n++)e=e.concat(arguments[n].split("/"));return e=t.transform(e,function(t,e){return t.push(e+"/.value")}),e.join("/")}function o(t,n,r,i){e.rZip(t,n,r,function(t,e){".value"!==e&&".meta"!==e&&(t[".version"]=i)})}var s={},a={};return a.SET=function(r,s){var a=[s.key,s.value];t.isPlainObject(s.value)&&(a=e.compose(s.key,s.value));var u=n.rInsert(s.key,".value",{front:!0}),l=!!s.value[".meta"];l||(r=e.remove(r,u,{"throws":!1,ignore:".meta"}));for(var c=r[".version"]+1,f=0;f<a.length-1;f+=2){var h,p=t.isPlainObject(s.value),d=1==t.size(s.value);p&&d&&l?(h=".value"+a[f],o(r,h,a[f+1],c)):(h=i(a[f]),o(r,h,a[f+1],c))}},a.SETNX=a.SET,a.ADD=function(t,e){var n=i(e.key,e.addedKey),r=t[".version"]+1;o(t,n,e.value,r)},a.REMOVE=function(o,s,a,u){var l=o[".version"]+1,c=i(s.key);c=c.substring(0,c.length-7);var f=r.get(o,c);f.unshift(c),t.each(f,function(r,i){if(e.remove(o,r,{"throws":!1},function(e){e!==o&&t.has(e,".version")&&!t.has(e,".value")&&(delete e[".version"],delete e[".meta"]),e[".version"]&&(e[".version"]=l)}),u&&a){var s=t.cloneDeep(a);s.key=n.rStrip(r,".value"),delete s.meta,delete s.tree,delete s.commands,delete s.callbackId,delete s.version,s.cascaded=i>0,u(s)}})},s.apply=function(e,n,r,i){return t.isArray(n)||(n=[n]),t.each(n,function(t){var n=a[t.cmd];if(!n)throw new Error("Unknown command: "+t.cmd);n(e,t,r,i)}),e},s}),define("protocol/storagev1",[],function(){function t(){}function e(){}return e.prototype.request=t,e.prototype.response=t,e.prototype.notify=t,e}),define("protocol/storagev2",["lodash","common/obj","common/command_operator","common/path"],function(t,e,n,r){function i(){this._trees={}}function o(n,i){var o=r.rInsert(i,".value",{front:!0}),s=e.pick(n,o);return t.isUndefined(s)?null:e.undecorate(s,["!.value",".meta",".version"],!0)}return i.prototype.request=function(e){t.has(this._trees,e.room)||(this._trees[e.room]={".version":0}),e.version=this._trees[e.room][".version"]},i.prototype.response=function(e,r){e.tree&&(this._trees[e.room]=e.tree);var i=this._trees[e.room];if(e.options=e.options||{},"SET"===e.command&&(e.overwritten=null!==o(i,e.key)),"REMOVE"===e.command&&(e.value=o(i,e.key)),"LEAVE"===e.command){var s="/.users/"+(e.userId||e.context.user.id);e.value=o(i,s)}if(e.commands&&e.commands.length>0){var a=e.commands[0].version-(i[".version"]+1),u=e.commands.slice(a);n.apply(i,u,e,r)}if("GET"===e.command)e.value=o(i,e.key);else if(e.version===i[".version"]+1){var l=t.omit(e,"command");l.cmd=e.command,("LEAVE"===e.command||"JOIN"===e.command)&&(l.key="/.users/"+(e.userId||e.context.user.id),l.cmd="LEAVE"===e.command?"REMOVE":"SET"),n.apply(i,l,e,r)}delete e.version,delete e.tree,delete e.commands},i.prototype.notify=function(t,e){this.response(t,e),t.options=t.options||{}},i}),define("protocol/factory",["protocol/storagev1","protocol/storagev2"],function(t,e){function n(n){return 2===n?new e:new t}return n}),define("connection",["eventemitter2","eventutil","global/json","global/window","lodash","async","util/resolver","sharedConfig","util/guard","platform/socket","platform/room","platform/registry","util/validation","util/timeouts","platform/room_collection","common/command_operator","common/obj","common/constants","common/errors","protocol/factory"],function(t,e,n,r,i,o,s,a,u,l,Room,c,f,h,p,d,m,g,v,y){function Connection(e,n){i.bindAll(this,"_onTimeout"),this._validateUrl(e),this._validateOpts(n),this._opts=n,this._socket=null,this._socketCleanup=function(){},this._user=null,this._joinedRooms=[],this.rooms=new p(this),this._registry=new c,this._emitter=new t,this._requestCallbackEmitter=new t,this._currentCallbackId=0,this._protocolStrategy=y(1),this._timeouts=new h(j),this._timeouts.on("expiry",this._onTimeout),u.all(this,L)}function _(){return a.authServerUrl||a.serverUrl.replace("://","://auth.")}var b="[\\d\\w][\\d\\w\\-]*",w="\\/(.+?)",E="(?:"+b+"\\.)*",k="(?:goinstant\\.(?:com|org|net))",x="(?::\\d{1,5})?",A="(?:$|\\/)",O="^((https?)://(?:"+E+k+"|"+"127\\.0\\.0\\.1"+"|"+"localhost(?:\\.localdomain)?"+")"+"("+x+")"+")",S=new RegExp(O+A),I=new RegExp(O+w+w+A),j=5e3,L=["_onMessage","_onError","_onConnect","_onDisconnect"];Connection.REQUEST_EXPIRY_TIME=j,Connection._Resolver=s,Connection.prototype._validateUrl=function(t){var e,n,r=!!t&&t.match(a.serverUrl)&&S.test(t);if(r&&(n=t.match(I),r=!!n),!r)throw e='Cannot connect to "'+t+'". The url must be a '+'registered application URL (e.g. "'+a.serverUrl+'/MYACCOUNT/MYAPP").',new v.ArgumentError(e);var i=n[1],o=n[2],s=n[3];if(this._account=n[4],this._application=n[5],a.httpsOnly&&(r="https"===o&&(!s||":443"===s)),!r)throw e='Cannot connect to "'+t+'". '+"The url must be an HTTPS url on the standard port (443).",new v.ArgumentError(e);/:\d+$/.test(i)||(i+=":443"),this._connectUrl=i},Connection.prototype._validateOpts=function(t){if(t){if(!i.isObject(t))throw new Error("opts, if provided, must be an object");delete t.sessionId;var e=i.difference(i.keys(t),["guestId"]);if(e.length>0)throw new Error("unknown option(s): "+e.join(", "));if(i.has(t,"guestId")&&!i.isString(t.guestId)&&t.guestId)throw new Error("opts.guestId must be a string or falsey value")}},Connection.prototype._createCallbackId=function(){return this._currentCallbackId++},Connection.prototype._request=function(t,e,n){n=n||function(){};var r=this._createCallbackId();this._requestCallbackEmitter.once(r,n),this._timeouts.add(r);var o=e.options||{},s={command:t,room:e.room,options:o,callbackId:r};i.contains(["ot/resync","ot/sync","ot/update"],t)?(s.text=e.text,s.packet=e.packet):(s.key=e.key,s.value=e.value),this._protocolStrategy.request(s);try{this._socket.send(s)}catch(a){this._timeouts.clear(r),this._requestCallbackEmitter.emit(r,a)}},Connection.prototype._onResponse=function(t,e){var n=e.callbackId,r=null;return t&&(r=v.build(t,e)),"OFF"===e.command||"ON"===e.command?this._requestCallbackEmitter.emit(n,r):(this._protocolStrategy.response(e,i.bind(this._registry.emit,this._registry)),delete e.callbackId,delete e.meta,this._timeouts.clear(n),this._requestCallbackEmitter.emit(n,r,e.value,e),void 0)},Connection.prototype._onNotify=function(t){this._protocolStrategy.notify(t,i.bind(this._registry.emit,this._registry)),("REMOVE"!==t.command||1===this._socket.storageVersion)&&this._registry.emit(t)},Connection.prototype.connect=function(t,n){var r=this;(i.isFunction(t)||i.isUndefined(t))&&(n=t||function(){},t=null),n=u.one(n,r);var o=new Connection._Resolver(n,r);n=o.cb;var s=new l(r._connectUrl,r._account,r._application,t,this._opts);return s.connect(function(t,o){return t?n(t):(r._user=o,r._socket=s,r._socketCleanup=e.register(s,"message",i.bind(r._onMessage,r),s,"error",i.bind(r._onError,r),s,"disconnect",i.bind(r._onDisconnect,r),s,"connect",i.bind(r._onConnect,r)),r._onConnect(),n(null,r),void 0)}),o.promise},Connection.prototype.disconnect=function(t){var n=this,r=new Connection._Resolver(t,n);return t=r.cb,n._socket?(n._leaveAllRooms(function(r){function i(){t(r,n),n._onDisconnect()}function o(){t(new Error("Error during disconnect"),n)}n._socketCleanup(),e.register(n._socket,"!disconnect",i,n._socket,"!error",o),n._socket.close(),n._socket=null}),r.promise):t(null,n)},Connection.prototype._leaveAllRooms=function(t){var e=[],n=i.map(this._joinedRooms,function(t){return function(n){t.leave(function(r){r&&"User not in room"!==r.message&&e.push({name:t.name,err:r}),n()})}});o.parallel(n,function(){return e.length>0?t(new v.RoomSessionStateError("Failed to leave room(s).")):(t(),void 0)})},Connection.prototype.room=function(t){return new Room(this,t)},Connection.prototype._joined=function(t){var e=this._isJoined(t);e||this._joinedRooms.push(t)},Connection.prototype._isJoined=function(t){return i.any(this._joinedRooms,function(e){return t.name===e.name})},Connection.prototype._left=function(t){this._joinedRooms=i.without(this._joinedRooms,t)};var R=["connect","disconnect","error"];return Connection.prototype.on=function(t,e){if(!f.contained(R,t))throw new Error("Invalid event provided:"+t);this._emitter.on(t,e)},Connection.prototype.off=function(t,e){if(!f.contained(R,t))throw new Error("Invalid event provided:"+t);this._emitter.off(t,e)},Connection.prototype._on=function(t,e,n,r,i){this._registry.on({room:t,key:e,command:n,opts:r},i)},Connection.prototype._off=function(t,e,n,r,i){this._registry.off({room:t,key:e,command:n,opts:r},i)},Connection.prototype._rejoinRooms=function(t){var e=this;o.each(this._joinedRooms,function(t,e){t.join(e)},function(n){return n?e.disconnect(i.bind(t,null,n)):t()})},Connection.prototype._onConnect=function(){this.guestId=this._socket.guestId,this._protocolStrategy=y(this._socket.storageVersion);var t=this;this._rejoinRooms(function(e){return e?t._emitter.emit("error",e):(t._emitter.emit("connect"),void 0)})},Connection.prototype._onDisconnect=function(){this._emitter.emit("disconnect")},Connection.prototype._onError=function(t,e){var n=v.build(t,0+e);if(0===this._emitter.listeners("error").length)throw n;this._emitter.emit("error",n)},Connection.prototype._onMessage=function(t){var e=n.parse(t),r=e.shift();switch(r){case"RESPONSE":this._onResponse.apply(this,e);break;case"NOTIFY":this._onNotify.apply(this,e);break;case"ERROR":this._onError(e[1],e[2]);break;case"USER":break;default:this._onError('Unknown message type "'+r+'": '+t)}},Connection.prototype._onTimeout=function(t){var e=new Error("Request timed out");this._requestCallbackEmitter.emit(t,e)},Connection.prototype.loginUrl=function(t,e){if(t=t||null,e=e||r.location.href,t&&!g.PROVIDER_NAME_REGEX.test(t))throw new Error("Malformed providerName name");var n=["account="+encodeURIComponent(this._account),"app="+encodeURIComponent(this._application),"returnTo="+encodeURIComponent(e)];return t&&n.push("providerName="+encodeURIComponent(t)),_()+"/begin?"+n.join("&")},Connection.prototype.logoutUrl=function(t){t=t||r.location.href;var e=["account="+encodeURIComponent(this._account),"app="+encodeURIComponent(this._application),"returnTo="+encodeURIComponent(t)];return _()+"/logout?"+e.join("&")},Connection}),define("connect",["lodash","async","util/resolver","connection","util/validation","common/errors"],function(t,e,n,Connection,r,i){var o={};o._Connection=Connection,o._Resolver=n;var s=["room","rooms","user","guestId","visible"];return o.start=function(n,a,u){function l(e){var r=a.user?a.user:null,i=t.pick(a,["guestId"]);try{f=new o._Connection(n,i),f.connect(r,e)}catch(s){e(s)}}function c(t,e){try{var n=f.room(t);if(m.isOpt){var r={visible:a.visible};return n.join(null,r,e)}n.join(e)}catch(i){e(i)}}var f;if(!t.isString(n))throw i.build("url must be a valid string",303);if(!r.optionalCallback(u))throw i.build("cb, if provided, must be valid",303);if(!u&&t.isFunction(a)&&(u=a,a={}),a=a||{},delete a.sessionId,!t.isFunction(a)&&!t.isPlainObject(a))throw i.build("opts if provided must be an object",303);var h={isOpt:t.has(a,"user"),isString:t.isString(a.user),isPlain:t.isPlainObject(a.user)};if(h.isOpt&&!h.isString&&!h.isPlain)throw i.build("opts.user if provided must be a jwt string or object",303);if(t.has(a,"room")&&t.has(a,"rooms"))throw i.build("opts can specify room or rooms, not both",303);var p={isOpt:t.has(a,"room"),isString:t.isString(a.room),isArray:t.isArray(a.room),allStrings:t.isArray(a.room)&&t.all(a.room,t.isString)};if(!(!p.isOpt||p.isString||p.isArray&&p.allStrings))throw i.build("room must be a string or an array of strings",303);var d={isOpt:t.has(a,"rooms"),isString:t.isString(a.rooms),isArray:t.isArray(a.rooms),allStrings:t.isArray(a.rooms)&&t.all(a.rooms,t.isString)};if(!(!d.isOpt||d.isString||d.isArray&&d.allStrings))throw i.build("rooms must be a string or an array of strings",303);var m={isOpt:t.has(a,"visible"),isBoolean:t.isBoolean(a.visible)};if(m.isOpt&&!m.isBoolean)throw i.build("visible must be a boolean",303);var g=t.keys(a),v=t.difference(g,s);if(v.length)throw i.build("invalid option(s) provided: "+v.join(", "),303);var y=new o._Resolver(u,this,["connection","rooms..."]);u=y.cb;var _;if(_=a.room?a.room:a.rooms?a.rooms:["lobby"],t.isString(_)&&(_=[_]),!_.length)throw i.build("room(s) can not be an empty array",303);return e.series({connection:l,rooms:e.apply(e.map,_,c)},function(t,e){if(t)return f?f.disconnect(function(){return u(t)}):u(t);var n=e.rooms;n.unshift(f),n.unshift(null),u.apply(u,n)}),y.promise},o}),define("prod/main",["hide_lodash","iefix","global/window","connection","connect","common/errors","platform/room","platform/key","platform/channel","platform/query","sharedConfig"],function(t,e,n,Connection,r,i,Room,Key,Channel,Query,o){n.goinstant=n.goinstant||{},n.goinstant.Connection=Connection,n.goinstant.connect=r.start,n.goinstant.errors=i,n.goinstant.Room=Room,n.goinstant.Key=Key,n.goinstant.Channel=Channel,n.goinstant.Query=Query,n.goinstant.sharedConfig=o}),require("prod/main")}();
